<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scofield Analista V4 PRO ⚪</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: 'Segoe UI', sans-serif;
      padding: 15px;
    }
    h1 {
      text-align: center;
      color: #ff4747;
    }
    textarea,
    input,
    button {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      box-sizing: border-box;
    }
    textarea,
    input {
      background: #222;
      color: #eee;
      border: 1px solid #555;
    }
    button {
      background: #ff4747;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background: #e53e3e;
    }
    .secao {
      margin-top: 25px;
    }
    .sinal {
      background: #222;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
    }
    .sinal button {
      width: 48%;
      margin: 2px 1%;
      font-weight: bold;
    }
    .estatisticas {
      white-space: pre-line;
      background: #222;
      padding: 10px;
      border-radius: 5px;
      margin-top: 15px;
      font-size: 1em;
    }
    #avisoRecChuva {
      background: #440000;
      color: #ff5555;
      padding: 10px;
      text-align: center;
      border-radius: 5px;
      font-weight: bold;
      margin-bottom: 15px;
    }
    #proximaPrevisao {
      background: #330000;
      color: #ff4747;
      padding: 10px;
      text-align: center;
      border-radius: 5px;
      font-weight: bold;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <h1>Scofield Analista V4 PRO ⚪</h1>

  <div id="proximaPrevisao">Próxima previsão forte: --:--:--</div>
  <div id="avisoRecChuva"></div>

  <div class="secao">
    <h3>🧠 Histórico Cérebro</h3>
    <textarea id="historicoCerebro" rows="8" placeholder="Cole aqui o histórico completo com horários, números e cores..."></textarea>
    <button onclick="enviarCerebro()">📤 Enviar Histórico</button>
    <div id="mensagemCerebro" style="color:#8f8; margin-top:6px;"></div>
    <div>Estratégias criadas: <span id="numEstrategias">0</span></div>
  </div>

  <div class="secao">
    <h3>⏱️ Começar Análise</h3>
    <textarea id="historicoAtual" rows="6" placeholder="Cole aqui as últimas jogadas para prever os brancos..."></textarea>
    <button onclick="analisarAgora()">🔍 Analisar</button>
    <div id="previsoes"></div>
    <button onclick="mostrarMinutosQuentes()" style="margin-top:10px;">📈 Ver Minutos Quentes</button>
    <div id="minutosQuentes" style="margin-top:10px; background:#222; padding:10px; border-radius:5px; max-height:150px; overflow:auto;"></div>
  </div>

  <div class="secao">
    <h3>📊 Estatísticas</h3>
    <div id="estatisticas" class="estatisticas">Nenhuma estatística registrada.</div>
    <button onclick="limparEstatisticas()">🧹 Limpar Estatísticas</button>
  </div>

  <div class="secao">
    <h3>🧹 Limpar Histórico</h3>
    <button onclick="limparHistorico()">🧼 Limpar Campos de Histórico</button>
    <div id="mensagemHistorico" style="margin-top:10px;color:#8f8;"></div>
  </div>
// Cores por faixa numérica
const VERMELHAS = new Set(['1','2','3','4','5','6','7']);
const PRETAS = new Set(['8','9','10','11','12','13','14']);

// Memória local
let estrategias = JSON.parse(localStorage.getItem("estrategias") || "[]");
let estatisticas = JSON.parse(localStorage.getItem("estatisticas") || "[]");
let historicosMemorizados = JSON.parse(localStorage.getItem("historicosMemorizados") || "[]");

// Atualiza contador de estratégias
function atualizarContadorEstrategias() {
  document.getElementById("numEstrategias").innerText = estrategias.length;
}

// Atualiza estatísticas na tela
function atualizarEstatisticas() {
  const div = document.getElementById("estatisticas");
  if (estatisticas.length === 0) {
    div.innerText = "Nenhuma estatística registrada.";
    return;
  }
  let linhas = estatisticas.map(e => {
    let status = e.acerto ? "✅" : "❌";
    let d = new Date(e.data);
    return `${e.horario} ${status} - ${d.toLocaleString()}`;
  });
  div.innerText = linhas.join('\n');
}

// Salvar memória local
function salvarDados() {
  localStorage.setItem("estrategias", JSON.stringify(estrategias));
  localStorage.setItem("estatisticas", JSON.stringify(estatisticas));
  localStorage.setItem("historicosMemorizados", JSON.stringify(historicosMemorizados));
  atualizarEstatisticas();
  atualizarContadorEstrategias();
}

// 📌 Parseia o histórico colado (cérebro e análise)
function parsearHistorico(texto) {
  let linhas = texto.trim().split(/\r?\n/).map(l => l.trim()).filter(l => l !== '');
  let resultado = [];
  for (let i = 0; i < linhas.length;) {
    let num = linhas[i];
    let hora = linhas[i + 1] || '';

    if (/^\d{2}:\d{2}:\d{2}$/.test(hora)) {
      let cor = 'branco';
      if (num === '0' || num === '') {
        cor = 'branco';
        num = null;
      } else if (VERMELHAS.has(num)) {
        cor = 'vermelha';
      } else if (PRETAS.has(num)) {
        cor = 'preta';
      } else {
        cor = 'desconhecida';
      }

      resultado.push({ num: num, hora: hora, cor: cor });
      i += 2;
    } else {
      i++;
    }
  }
  return resultado;
}
// Cria estratégias reais baseadas nos brancos do histórico
function criarOuAtualizarEstrategias(historico) {
  let brancos = historico.filter(e => e.cor === 'branco');

  if (brancos.length === 0) return 0;

  let novas = 0;

  brancos.forEach((branco, index) => {
    // Verifica se há anterior e posterior
    const anterior = historico[index - 1];
    const posterior = historico[index + 1];

    if (!anterior || !posterior || !anterior.num || !posterior.num) return;

    const soma = parseInt(anterior.num) + parseInt(posterior.num);
    const minuto = branco.hora.slice(3, 5);

    const padrao = {
      anterior: anterior.num,
      posterior: posterior.num,
      soma: soma,
      minuto: minuto,
      horaCompleta: branco.hora
    };

    const jaExiste = estrategias.some(est => {
      return (
        est.soma === padrao.soma &&
        est.minuto === padrao.minuto &&
        est.anterior === padrao.anterior &&
        est.posterior === padrao.posterior
      );
    });

    if (!jaExiste) {
      estrategias.push({
        ...padrao,
        peso: 1,
        aprendidoEm: Date.now()
      });
      novas++;
    }
  });

  return novas;
}

// Função chamada ao clicar em "📤 Enviar Histórico"
function enviarCerebro() {
  const texto = document.getElementById("historicoCerebro").value;
  if (texto.trim().length < 10) {
    alert("Histórico muito curto.");
    return;
  }

  const parseado = parsearHistorico(texto);
  if (parseado.length === 0) {
    alert("Não foi possível interpretar o histórico.");
    return;
  }

  historicosMemorizados.push({
    data: Date.now(),
    itens: parseado
  });

  const novas = criarOuAtualizarEstrategias(parseado);
  document.getElementById("mensagemCerebro").innerText =
    `✅ Histórico enviado! ${novas} estratégia(s) criada(s).`;

  salvarDados();
}
