<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scofield Analista PRO - Ultimate</title>
  <style>
    /* Reset e estilo geral */
    body {
      background-color: #111;
      color: #eee;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 15px;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    h1, h2, h3, h4 {
      text-align: center;
      margin: 10px 0;
      color: #ff4747;
      user-select: text;
    }
    textarea, input {
      width: 100%;
      padding: 10px;
      margin: 5px 0 15px 0;
      background: #222;
      border: 1px solid #555;
      border-radius: 5px;
      color: #eee;
      font-size: 1em;
      font-family: monospace;
      resize: vertical;
    }
    button {
      background-color: #ff4747;
      border: none;
      color: white;
      padding: 12px;
      margin: 5px 0 20px 0;
      width: 100%;
      border-radius: 5px;
      font-weight: 700;
      font-size: 1.1em;
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:hover {
      background-color: #e53e3e;
    }
    .secao {
      max-width: 700px;
      margin: 0 auto 30px auto;
      padding: 10px;
      border-radius: 8px;
      background-color: #222;
      box-shadow: 0 0 10px #ff4747aa;
    }
    .sinal {
      background-color: #222;
      border-radius: 5px;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid #ff4747;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: text;
    }
    .sinal strong {
      font-size: 1.1em;
    }
    .sinal button {
      width: 48%;
      padding: 8px;
      font-weight: 700;
      font-size: 1em;
    }
    .estatisticas {
      white-space: pre-wrap;
      background-color: #222;
      border-radius: 5px;
      padding: 10px;
      font-size: 1em;
      max-height: 150px;
      overflow-y: auto;
      user-select: text;
    }
    .info {
      font-size: 1em;
      font-weight: 700;
      text-align: center;
      margin: 10px 0;
      color: #ff4747;
      user-select: text;
    }
    .status-alert {
      color: #ff3333;
      font-weight: 900;
      text-align: center;
      margin-top: 5px;
      user-select: text;
    }
    .status-info {
      color: #ffa07a;
      font-weight: 700;
      text-align: center;
      margin-top: 5px;
      user-select: text;
    }
  </style>
</head>
<body>
  <h1>Scofield Analista PRO ‚ö™üî• Ultimate Edition</h1>

  <!-- √Årea Hist√≥rico C√©rebro -->
  <div class="secao" id="secao-cerebro">
    <h3>üß† Hist√≥rico C√©rebro</h3>
    <textarea id="historicoCerebro" rows="8" placeholder="Cole aqui o hist√≥rico completo com n√∫meros, hor√°rios e cores..."></textarea>
    <button onclick="enviarCerebro()">üì§ Enviar Hist√≥rico</button>
    <div id="msgCerebro" class="info"></div>
    <div id="contadorEstrategias" class="info">0 estrat√©gias criadas e mantidas</div>
  </div>

  <!-- √Årea Hist√≥rico Atual -->
  <div class="secao" id="secao-atual">
    <h3>‚è±Ô∏è Hist√≥rico Atual (√∫ltimas jogadas)</h3>
    <textarea id="historicoAtual" rows="6" placeholder="Cole aqui as √∫ltimas jogadas para an√°lise e previs√£o..."></textarea>
    <button onclick="analisarAgora()">üîç Analisar</button>
    <div id="previsoes"></div>
    <div id="alertaPadr√£o" class="status-alert"></div>
    <div id="alertaRec" class="status-info"></div>
    <div id="alertaChuva" class="status-info"></div>
  </div>

  <!-- √Årea Estat√≠sticas -->
  <div class="secao" id="secao-estatisticas">
    <h3>üìä Estat√≠sticas e Resultados</h3>
    <div id="estatisticas" class="estatisticas"></div>
    <button onclick="limparEstatisticas()">üßπ Limpar Estat√≠sticas</button>
  </div>

  <!-- √Årea Limpar Hist√≥rico -->
  <div class="secao" id="secao-limpar">
    <h3>üßπ Limpar Hist√≥rico</h3>
    <button onclick="limparHistorico()">üßº Limpar Campos de Hist√≥rico</button>
    <div id="mensagemHistorico" class="info"></div>
  </div>

<script>
  // === Vari√°veis e armazenamento local ===
  let estrategias = JSON.parse(localStorage.getItem("estrategias") || "[]"); // Lista de estrat√©gias/padr√µes
  let estatisticas = JSON.parse(localStorage.getItem("estatisticas") || "[]"); // Hist√≥rico de acertos/erros

  // Atualiza o contador vis√≠vel de estrat√©gias
  function atualizarContadorEstrategias() {
    document.getElementById("contadorEstrategias").innerText = `${estrategias.length} estrat√©gias criadas e mantidas`;
  }

  // Salva dados no localStorage e atualiza contadores e estat√≠sticas na interface
  function salvarDados() {
    localStorage.setItem("estrategias", JSON.stringify(estrategias));
    localStorage.setItem("estatisticas", JSON.stringify(estatisticas));
    atualizarContadorEstrategias();
    atualizarEstatisticas();
  }

  // === Fun√ß√£o para interpretar e organizar o hist√≥rico em array de objetos com n√∫mero e hor√°rio ===
  function parseHistorico(texto) {
    // Formato esperado:
    // n√∫mero linha 1
    // hor√°rio linha 2
    // n√∫mero linha 3
    // hor√°rio linha 4
    // ...
    // A fun√ß√£o aceita formatos simples: n√∫meros e hor√°rios alternados linha a linha
    const linhas = texto.trim().split(/\r?\n/).filter(l => l.trim() !== "");
    let registros = [];
    for (let i = 0; i < linhas.length; i += 2) {
      const numeroStr = linhas[i].trim();
      const horarioStr = linhas[i + 1] ? linhas[i + 1].trim() : null;
      if (!numeroStr || !horarioStr) continue;
      const numero = parseInt(numeroStr);
      if (isNaN(numero)) continue;
      // Validar hor√°rio formato HH:mm:ss
      if (!/^\d{2}:\d{2}:\d{2}$/.test(horarioStr)) continue;
      registros.push({ numero, horario: horarioStr });
    }
    return registros;
  }

  // === Fun√ß√£o para salvar novo hist√≥rico c√©rebro, criar estrat√©gias/padr√µes ===
  function enviarCerebro() {
    const texto = document.getElementById("historicoCerebro").value;
    if (texto.trim().length < 10) {
      alert("Hist√≥rico muito curto.");
      return;
    }
    let registros = parseHistorico(texto);
    if (registros.length < 5) {
      alert("Hist√≥rico insuficiente para an√°lise.");
      return;
    }
    // Criar um novo padr√£o (estrat√©gia) com sequ√™ncia e hor√°rios dos brancos
    // Para simplicidade aqui, vamos guardar o padr√£o completo (sequ√™ncia n√∫meros + hor√°rios)
    let numerosSeq = registros.map(r => r.numero);
    let horariosBrancos = registros.map(r => r.horario);

    // Detectar REC e CHUVA no padr√£o antes de salvar
    const infoRecChuva = detectarRecChuva(registros);

    // Criar o objeto da estrat√©gia
    let novaEstrategia = {
      id: Date.now(),
      numerosSeq,
      horariosBrancos,
      infoRecChuva, // objeto com flags rec e chuva e m√©tricas
      criadoEm: new Date().toISOString()
    };

    // Verificar se j√° existe padr√£o igual para n√£o duplicar (comparando sequ√™ncia)
    let existe = estrategias.some(e => compararArrays(e.numerosSeq, novaEstrategia.numerosSeq));
    if (!existe) {
      estrategias.push(novaEstrategia);
      document.getElementById("msgCerebro").innerText = "‚úÖ Hist√≥rico analisado com sucesso! Nova estrat√©gia criada.";
    } else {
      document.getElementById("msgCerebro").innerText = "‚ö†Ô∏è Padr√£o j√° existente no c√©rebro. Nenhuma estrat√©gia nova criada.";
    }
    salvarDados();
  }

  // === Fun√ß√£o para comparar arrays simples ===
  function compararArrays(arr1, arr2) {
    if (arr1.length !== arr2.length) return false;
    for(let i=0; i<arr1.length; i++) {
      if (arr1[i] !== arr2[i]) return false;
    }
    return true;
  }

  // === Detectar padr√£o REC e CHUVA baseado em intervalos e frequ√™ncia de brancos ===
  // Retorna um objeto: { rec: bool, chuva: bool, intervaloMedio: number (segundos), maxIntervalo: number (segundos), qtdBrancos: number }
  function detectarRecChuva(registros) {
    // Calcular intervalos entre hor√°rios dos registros (em segundos)
    let tempos = registros.map(r => parseHorarioToSeconds(r.horario));
    let intervalos = [];
    for(let i=1; i<tempos.length; i++) {
      intervalos.push(tempos[i] - tempos[i-1]);
    }
    if (intervalos.length === 0) return { rec:false, chuva:false, intervaloMedio:0, maxIntervalo:0, qtdBrancos: registros.length };

    // Estat√≠sticas
    let somaIntervalos = intervalos.reduce((a,b) => a+b, 0);
    let intervaloMedio = somaIntervalos / intervalos.length;
    let maxIntervalo = Math.max(...intervalos);
    let qtdBrancos = registros.length;

    // Crit√©rios para REC (longos intervalos, poucos brancos)
    let rec = (intervaloMedio > 120 && qtdBrancos < 10); // > 2 minutos em m√©dia e pouco branco
    // Crit√©rios para CHUVA (muitos brancos seguidos, intervalos curtos)
    let chuva = (intervaloMedio < 45 && qtdBrancos > 12); // menos de 45s e muitos brancos

    return { rec, chuva, intervaloMedio, maxIntervalo, qtdBrancos };
  }

  // === Converter hor√°rio HH:mm:ss para segundos desde meia-noite ===
  function parseHorarioToSeconds(horario) {
    const partes = horario.split(":");
    return (+partes[0]) * 3600 + (+partes[1]) * 60 + (+partes[2]);
  }

  // === Fun√ß√£o para analisar o hist√≥rico atual e gerar previs√µes ===
  function analisarAgora() {
    const texto = document.getElementById("historicoAtual").value;
    const divPrevisoes = document.getElementById("previsoes");
    const alertaPadrao = document.getElementById("alertaPadr√£o");
    const alertaRec = document.getElementById("alertaRec");
    const alertaChuva = document.getElementById("alertaChuva");

    divPrevisoes.innerHTML = "";
    alertaPadrao.innerText = "";
    alertaRec.innerText = "";
    alertaChuva.innerText = "";

    if (texto.trim().length < 5) {
      alert("Cole o hist√≥rico atual para analisar.");
      return;
    }

    let registros = parseHistorico(texto);
    if (registros.length < 3) {
      alert("Hist√≥rico atual insuficiente para an√°lise.");
      return;
    }

    // Primeiro: verificar se padr√£o atual existe no c√©rebro (estrat√©gias)
    let padraoEncontrado = null;
    for(let estrat of estrategias) {
      if (compararArrays(estrat.numerosSeq, registros.map(r => r.numero))) {
        padraoEncontrado = estrat;
        break;
      }
    }

    if (padraoEncontrado) {
      alertaPadrao.innerText = `‚ö†Ô∏è Padr√£o detectado! Estrat√©gia criada em: ${new Date(padraoEncontrado.criadoEm).toLocaleString()}`;

      // Projetar os hor√°rios ajustados para hoje
      let horariosProjetados = projetarHorarios(padraoEncontrado.horariosBrancos, registros);
      if (horariosProjetados.length > 0) {
        divPrevisoes.innerHTML += "<h4>üü¢ Previs√µes de brancos baseadas no padr√£o:</h4>";
        horariosProjetados.forEach(h => {
          let el = document.createElement("div");
          el.className = "sinal";
          el.innerHTML = `
            <strong>${h}</strong>
            <button onclick="registrarResultado('${h}', 'win')">‚úÖ Acertou</button>
            <button onclick="registrarResultado('${h}', 'loss')">‚ùå Errou</button>
          `;
          divPrevisoes.appendChild(el);
        });
      }

      // Exibir alertas de REC e CHUVA conforme padr√£o identificado
      if (padraoEncontrado.infoRecChuva.rec) {
        alertaRec.innerText = "‚ö†Ô∏è Aten√ß√£o: padr√£o REC detectado ‚Äî per√≠odo com poucos brancos e intervalos longos.";
      }
      if (padraoEncontrado.infoRecChuva.chuva) {
        alertaChuva.innerText = "üåßÔ∏è Aten√ß√£o: padr√£o Chuva de Brancos detectado ‚Äî sequ√™ncia r√°pida de brancos!";
      }
    } else {
      alertaPadrao.innerText = "Nenhum padr√£o conhecido detectado no hist√≥rico atual.";
      // Se n√£o encontrar padr√£o, pode tentar prever com l√≥gica base simples:
      gerarPrevisoesSimples(divPrevisoes);
    }
  }

  // === Fun√ß√£o para projetar hor√°rios futuros baseando no padr√£o hist√≥rico e no hist√≥rico atual ===
  // Ajusta os hor√°rios para o dia atual e pr√≥ximos minutos
  function projetarHorarios(horariosBrancos, registrosAtuais) {
    // Pega o hor√°rio da √∫ltima jogada atual para basear proje√ß√£o
    let ultReg = registrosAtuais[registrosAtuais.length - 1];
    let ultSegundos = parseHorarioToSeconds(ultReg.horario);

    // Converte todos os hor√°rios do padr√£o para segundos
    let segundosPadrao = horariosBrancos.map(h => parseHorarioToSeconds(h));

    // Calcula diferen√ßa entre hor√°rio inicial do padr√£o e da √∫ltima jogada atual para ajustar
    let dif = ultSegundos - segundosPadrao[segundosPadrao.length - 1];

    // Ajusta todos os hor√°rios do padr√£o somando a diferen√ßa
    let horariosAjustados = segundosPadrao.map(s => {
      let ajustado = s + dif;
      // Ajustar para ficar entre 0 e 86399 segundos (um dia)
      if (ajustado < 0) ajustado += 86400;
      if (ajustado >= 86400) ajustado -= 86400;
      return ajustado;
    });

    // S√≥ retorna hor√°rios futuros em rela√ß√£o ao √∫ltimo registro atual
    let futuros = horariosAjustados.filter(s => s > ultSegundos);

    // Converte segundos para HH:mm:ss
    let resultados = futuros.map(s => {
      let h = Math.floor(s / 3600);
      let m = Math.floor((s % 3600) / 60);
      let ss = s % 60;
      return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
    });

    return resultados;
  }

  // === Fun√ß√£o para previs√µes simples caso n√£o encontre padr√£o ===
  function gerarPrevisoesSimples(div) {
    const agora = new Date();
    const base = agora.getHours() * 3600 + agora.getMinutes() * 60 + agora.getSeconds();

    div.innerHTML = "<h4>üü° Previs√µes Simples (base temporal atual):</h4>";

    [1, 2, 3].forEach(i => {
      let seg = base + i * 240; // A cada 4 minutos
      let h = Math.floor(seg / 3600) % 24;
      let m = Math.floor((seg % 3600) / 60);
      let s = seg % 60;
      let nivel = i === 1 ? "Forte" : i === 2 ? "Moderado" : "Arriscado";
      let horario = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;

      let el = document.createElement("div");
      el.className = "sinal";
      el.innerHTML = `
        <strong>${horario}</strong> (${nivel})
        <button onclick="registrarResultado('${horario}', 'win')">‚úÖ Acertou</button>
        <button onclick="registrarResultado('${horario}', 'loss')">‚ùå Errou</button>
      `;
      div.appendChild(el);
    });
  }

  // === Fun√ß√£o para registrar resultado acertou/errou e melhorar aprendizado ===
  function registrarResultado(horario, resultado) {
    estatisticas.push({ horario, resultado: resultado === "win" ? "‚úÖ" : "‚ùå", data: new Date().toISOString() });
    salvarDados();
    alert(`Resultado registrado: ${resultado === "win" ? "Acertou" : "Errou"} para o hor√°rio ${horario}`);
  }

  // === Atualizar a √°rea de estat√≠sticas com resultados ===
  function atualizarEstatisticas() {
    const div = document.getElementById("estatisticas");
    if (estatisticas.length === 0) {
      div.innerText = "Nenhuma estat√≠stica registrada ainda.";
      return;
    }
    div.innerText = estatisticas
      .slice()
      .reverse()
      .map(e => `${new Date(e.data).toLocaleString()} - ${e.horario} - ${e.resultado}`)
      .join("\n");
  }

  // === Limpar estat√≠sticas ===
  function limparEstatisticas() {
    if (confirm("Tem certeza que deseja apagar as estat√≠sticas?")) {
      estatisticas = [];
      salvarDados();
    }
  }

  // === Limpar os campos de hist√≥rico ===
  function limparHistorico() {
    document.getElementById("historicoCerebro").value = "";
    document.getElementById("historicoAtual").value = "";
    document.getElementById("msgCerebro").innerText = "";
    document.getElementById("previsoes").innerHTML = "";
    document.getElementById("alertaPadr√£o").innerText = "";
    document.getElementById("alertaRec").innerText = "";
    document.getElementById("alertaChuva").innerText = "";
    document.getElementById("mensagemHistorico").innerText = "‚úÖ Campos de hist√≥rico limpos! Estrat√©gias mantidas.";
  }

  // === Inicializa√ß√µes ===
  atualizarContadorEstrategias();
  atualizarEstatisticas();

</script>
</body>
</html>
