// Fun√ß√£o para somar minutos e manter hora em 24h, retorna string HH:MM
function somarMinutos(horaStr, minutosSomar) {
  const base = parseTimeHM(horaStr);
  if (!base) return null;
  let h = base.h;
  let m = base.m + minutosSomar;
  h += Math.floor(m / 60);
  m = m % 60;
  h = h % 24;
  return timeToStr(h, m);
}

function estrat1Analisar() {
  const num1 = parseInt(document.getElementById('num1').value) || 0;
  const num2 = parseInt(document.getElementById('num2').value) || 0; // branco (pode ser 0)
  const num3 = parseInt(document.getElementById('num3').value) || 0;

  const hora1 = document.getElementById('hora1').value || "";
  const hora2 = document.getElementById('hora2').value || "";
  const hora3 = document.getElementById('hora3').value || "";

  if(!parseTimeHM(hora1) || !parseTimeHM(hora2) || !parseTimeHM(hora3)) {
    alert('Por favor, insira hor√°rios v√°lidos no formato HH:MM.');
    return;
  }

  const somaDigitosHora1 = somarDigitos(hora1);
  const somaDigitosHora2 = somarDigitos(hora2);
  const somaDigitosHora3 = somarDigitos(hora3);
  const somaHorarios = somaDigitosHora1 + somaDigitosHora2 + somaDigitosHora3;
  const somaPedras = num1 + num3;
  const total = somaHorarios + somaPedras;

  // Use o hor√°rio do branco para somar minutos
  const horarioPrevisto = somarMinutos(hora2, total);

  document.getElementById('resultado').innerHTML = `
    üîé Soma dos d√≠gitos hor√°rios: ${somaDigitosHora1} + ${somaDigitosHora2} + ${somaDigitosHora3} = <b>${somaHorarios}</b><br/>
    ü™® Soma das pedras (anterior + posterior): ${num1} + ${num3} = <b>${somaPedras}</b><br/><br/>
    ‚úÖ <b>Total geral (hor√°rios + pedras): ${total}</b><br/>
    ‚è∞ Hor√°rio previsto (branco + total minutos): <b>${horarioPrevisto}</b><br/>
    ‚úîÔ∏è Adicionado √† lista Hor√°rio Atual
  `;

  if(!listaAtual.find(e => e.time === horarioPrevisto)) {
    listaAtual.push({time: horarioPrevisto});
  }
  atualizarTodasListas();
}

function marcarLoss(nomeLista, time) {
  stats[nomeLista].loss++;

  if(nomeLista === 'atual') {
    // Ao errar na lista atual, joga para as pr√≥ximas duas horas
    // Calcula as pr√≥ximas duas horas com o mesmo minuto

    const base = parseTimeHM(time);
    if(base) {
      const proxHora = (base.h + 1) % 24;
      const seguHora = (base.h + 2) % 24;
      const proxTime = timeToStr(proxHora, base.m);
      const seguTime = timeToStr(seguHora, base.m);

      if(!listaProxima.find(e => e.time === proxTime)) listaProxima.push({time: proxTime});
      if(!listaSeguinte.find(e => e.time === seguTime)) listaSeguinte.push({time: seguTime});
    }
  }
  else if(nomeLista === 'proxima') {
    // Se erro na pr√≥xima, joga para seguinte
    const base = parseTimeHM(time);
    if(base) {
      const seguHora = (base.h + 1) % 24;
      const seguTime = timeToStr(seguHora, base.m);
      if(!listaSeguinte.find(e => e.time === seguTime)) listaSeguinte.push({time: seguTime});
    }
  }
  removerItemDaLista(nomeLista, time);
  atualizarStats(nomeLista);
}
