<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Scofield Analista - Previsão do Branco Blaze</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 0;
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh;
  }
  header {
    background: #222;
    width: 100%; max-width: 800px;
    padding: 15px 10px;
    text-align: center;
    font-weight: bold;
    font-size: 1.8rem;
    letter-spacing: 0.12em;
    border-bottom: 3px solid #E03B3B;
  }
  main {
    max-width: 800px;
    width: 100%;
    padding: 20px 10px;
  }
  .pedras-container {
    display: flex;
    justify-content: space-around;
    margin-bottom: 20px;
  }
  .pedra {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100px;
    user-select: none;
  }
  .quadrado {
    width: 80px;
    height: 80px;
    border-radius: 8px;
    margin-bottom: 10px;
    box-shadow: 0 0 15px rgba(0,0,0,0.8);
    display: flex; align-items: center; justify-content: center;
    font-size: 1.6rem;
    font-weight: 700;
    text-align: center;
    color: white;
  }
  .quadrado.vermelho {
    background: #E03B3B;
    box-shadow: 0 0 15px #E03B3B;
  }
  .quadrado.preto {
    background: #222;
    box-shadow: 0 0 15px #222;
  }
  .quadrado.branco {
    background: #f0f0f0;
    color: #111;
    font-weight: 600;
    font-size: 1rem;
    padding: 5px;
    line-height: 1.3;
  }
  label {
    font-size: 0.9rem;
    margin-bottom: 3px;
    font-weight: 600;
  }
  input[type="text"], input[type="time"], input[type="number"] {
    width: 80px;
    margin-bottom: 10px;
    padding: 6px 8px;
    border-radius: 5px;
    border: none;
    font-size: 1rem;
    box-sizing: border-box;
    text-align: center;
  }
  input[type="time"] {
    font-family: monospace;
  }
  button {
    background: #E03B3B;
    color: white;
    border: none;
    padding: 12px 18px;
    font-weight: 700;
    font-size: 1.1rem;
    border-radius: 6px;
    cursor: pointer;
    margin: 10px 5px 25px 5px;
    transition: background 0.3s ease;
    user-select: none;
  }
  button:hover {
    background: #b02c2c;
  }
  #historico {
    max-height: 180px;
    overflow-y: auto;
    background: #222;
    padding: 10px;
    border-radius: 8px;
    font-family: monospace;
    font-size: 0.85rem;
    margin-bottom: 20px;
    color: #ddd;
  }
  #mensagem-alerta {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 20px;
    color: #E03B3B;
    text-align: center;
    min-height: 42px;
    user-select: none;
  }
  #ultima-previsao {
    font-size: 1.15rem;
    font-weight: 600;
    text-align: center;
    margin-bottom: 20px;
  }
  #grafico {
    background: #222;
    height: 150px;
    border-radius: 8px;
    margin-bottom: 30px;
    padding: 10px;
    box-sizing: border-box;
  }
  #status-aposta {
    text-align: center;
    font-weight: 700;
    font-size: 1.2rem;
    margin-bottom: 20px;
    color: #eee;
  }
</style>
</head>
<body>

<header>SCOFIELD ANALISTA</header>

<main>
  <div class="pedras-container">
    <div class="pedra">
      <div class="quadrado vermelho">VERMELHO</div>
      <label for="vermelho-numero">Nº Pedra</label>
      <input type="number" id="vermelho-numero" min="1" max="14" placeholder="Nº" />
      <label for="vermelho-horario">Horário (HH:MM:SS)</label>
      <input type="text" id="vermelho-horario" placeholder="20:15:25" maxlength="8" />
    </div>
    <div class="pedra">
      <div class="quadrado branco">
        "Quando você quer algo, todo o universo conspira para que você realize."  
      </div>
      <label for="branco-horario">Horário Branco (HH:MM:SS)</label>
      <input type="text" id="branco-horario" placeholder="20:15:29" maxlength="8" />
    </div>
    <div class="pedra">
      <div class="quadrado preto">PRETO</div>
      <label for="preto-numero">Nº Pedra</label>
      <input type="number" id="preto-numero" min="1" max="14" placeholder="Nº" />
      <label for="preto-horario">Horário (HH:MM:SS)</label>
      <input type="text" id="preto-horario" placeholder="20:15:31" maxlength="8" />
    </div>
  </div>

  <div style="text-align:center;">
    <button id="btn-adicionar">Adicionar Resultado</button>
    <button id="btn-limpar">Limpar Histórico</button>
  </div>

  <div id="mensagem-alerta"></div>
  <div id="ultima-previsao"></div>

  <div id="historico"></div>

  <div style="text-align:center;">
    <button id="btn-acertou" disabled>Acertou</button>
    <button id="btn-errou" disabled>Errou</button>
  </div>

  <div id="status-aposta"></div>

  <canvas id="grafico" width="760" height="150"></canvas>
</main>

<script>
  // Utilidades
  function parseHorario(text) {
    // Espera "HH:MM:SS" 
    const re = /^([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])$/;
    if (!re.test(text)) return null;
    const [h, m, s] = text.split(':').map(Number);
    return h * 3600 + m * 60 + s;
  }
  function formatHorario(segundos) {
    const h = Math.floor(segundos / 3600).toString().padStart(2, '0');
    const m = Math.floor((segundos % 3600) / 60).toString().padStart(2, '0');
    const s = (segundos % 60).toString().padStart(2, '0');
    return `${h}:${m}:${s}`;
  }

  // Classifica cor pela pedra
  const pedrasVermelhas = [1,2,3,4,5,6,7];
  const pedrasPretas = [8,9,11,12,13,14];

  function getCorByNumero(numero) {
    if (pedrasVermelhas.includes(numero)) return 'VERMELHO';
    if (pedrasPretas.includes(numero)) return 'PRETO';
    return 'INDEFINIDO';
  }

  // Dados e armazenamento
  let historico = JSON.parse(localStorage.getItem('scofield_historico')) || [];
  let aprendizado = JSON.parse(localStorage.getItem('scofield_aprendizado')) || {acertos:0, erros:0};
  let ultimaPrevisao = null;

  // Elementos
  const vermelhoNumeroEl = document.getElementById('vermelho-numero');
  const vermelhoHorarioEl = document.getElementById('vermelho-horario');
  const brancoHorarioEl = document.getElementById('branco-horario');
  const pretoNumeroEl = document.getElementById('preto-numero');
  const pretoHorarioEl = document.getElementById('preto-horario');

  const btnAdicionar = document.getElementById('btn-adicionar');
  const btnLimpar = document.getElementById('btn-limpar');
  const historicoEl = document.getElementById('historico');
  const mensagemAlertaEl = document.getElementById('mensagem-alerta');
  const ultimaPrevisaoEl = document.getElementById('ultima-previsao');
  const btnAcertou = document.getElementById('btn-acertou');
  const btnErrou = document.getElementById('btn-errou');
  const statusApostaEl = document.getElementById('status-aposta');
  const graficoCanvas = document.getElementById('grafico');
  const ctxGrafico = graficoCanvas.getContext('2d');

  // Função para renderizar histórico
  function renderizarHistorico() {
    if (historico.length === 0) {
      historicoEl.textContent = '(Nenhum dado no histórico)';
      return;
    }
    historicoEl.innerHTML = historico.map((item, idx) => {
      const cor = item.cor || 'INDEFINIDO';
      const horario = formatHorario(item.horario);
      return `${idx+1}. Pedra: ${item.numero || '-'} - Cor: ${cor} - Horário: ${horario}`;
    }).join('<br/>');
  }

  // Função para salvar no localStorage
  function salvarDados() {
    localStorage.setItem('scofield_historico', JSON.stringify(historico));
    localStorage.setItem('scofield_aprendizado', JSON.stringify(aprendizado));
  }

  // Função para adicionar resultado manual
  function adicionarResultado() {
    mensagemAlertaEl.textContent = '';
    const vNum = Number(vermelhoNumeroEl.value);
    const vHora = parseHorario(vermelhoHorarioEl.value.trim());
    const bHora = parseHorario(brancoHorarioEl.value.trim());
    const pNum = Number(pretoNumeroEl.value);
    const pHora = parseHorario(pretoHorarioEl.value.trim());

    if (!vNum || vNum <1 || vNum >14) {
      alert('Número da pedra vermelha inválido (1-14)');
      return;
    }
    if (vHora === null) {
      alert('Horário da pedra vermelha inválido. Use HH:MM:SS');
      return;
    }
    if (bHora === null) {
      alert('Horário do branco inválido. Use HH:MM:SS');
      return;
    }
    if (!pNum || pNum <1 || pNum >14) {
      alert('Número da pedra preta inválido (1-14)');
      return;
    }
    if (pHora === null) {
      alert('Horário da pedra preta inválido. Use HH:MM:SS');
      return;
    }

    // Armazena as pedras anteriores, branco e posterior
    // Primeiro vermelha
    historico.push({
      numero: vNum,
      cor: 'VERMELHO',
      horario: vHora
    });
    // Branco (sem número)
    historico.push({
      numero: null,
      cor: 'BRANCO',
      horario: bHora
    });
    // Preta
    historico.push({
      numero: pNum,
      cor: 'PRETO',
      horario: pHora
    });

    salvarDados();
    renderizarHistorico();
    limparInputs();
    analisarHistorico();
    prepararBotoesAcertoErro(false);
  }

  function limparInputs() {
    vermelhoNumeroEl.value = '';
    vermelhoHorarioEl.value = '';
    brancoHorarioEl.value = '';
    pretoNumeroEl.value = '';
    pretoHorarioEl.value = '';
  }

  btnAdicionar.addEventListener('click', adicionarResultado);
  btnLimpar.addEventListener('click', () => {
    if (confirm('Deseja realmente limpar todo o histórico e aprendizado?')) {
      historico = [];
      aprendizado = {acertos:0, erros:0};
      salvarDados();
      renderizarHistorico();
      mensagemAlertaEl.textContent = '';
      ultimaPrevisaoEl.textContent = '';
      statusApostaEl.textContent = '';
      prepararBotoesAcertoErro(true);
      limparInputs();
      limparGrafico();
    }
  });

  // Função para preparar botões acertou/errou
  function prepararBotoesAcertoErro(disabled) {
    btnAcertou.disabled = disabled;
    btnErrou.disabled = disabled;
  }

  // Função para registrar acerto
  btnAcertou.addEventListener('click', () => {
    aprendizado.acertos++;
    salvarDados();
    mensagemAlertaEl.textContent = 'Obrigado! Acerto registrado.';
    prepararBotoesAcertoErro(true);
  });

  // Função para registrar erro
  btnErrou.addEventListener('click', () => {
    aprendizado.erros++;
    salvarDados();
    mensagemAlertaEl.textContent = 'Erro registrado. Vamos melhorar!';
    prepararBotoesAcertoErro(true);
  });

  // Limpar gráfico
  function limparGrafico() {
    ctxGrafico.clearRect(0,0,graficoCanvas.width,graficoCanvas.height);
  }

  // Função para desenhar gráfico básico de probabilidade (simples)
  function desenharGrafico(probabilidades) {
    limparGrafico();
    if (!probabilidades || probabilidades.length === 0) return;

    const maxProb = Math.max(...probabilidades);
    const scaleY = graficoCanvas.height / (maxProb || 1);
    const passoX = graficoCanvas.width / (probabilidades.length - 1);

    ctxGrafico.strokeStyle = '#E03B3B';
    ctxGrafico.lineWidth = 3;
    ctxGrafico.beginPath();

    probabilidades.forEach((p, i) => {
      const x = i * passoX;
      const y = graficoCanvas.height - p * scaleY;
      if (i === 0) ctxGrafico.moveTo(x,y);
      else ctxGrafico.lineTo(x,y);
    });
    ctxGrafico.stroke();
  }

  // Função que faz a análise do histórico e tenta prever branco
  function analisarHistorico() {
    if (historico.length < 3) {
      ultimaPrevisaoEl.textContent = 'Mais dados são necessários para prever o branco.';
      prepararBotoesAcertoErro(true);
      limparGrafico();
      return;
    }

    // Exemplo de estratégia simples: calcular intervalos entre brancos
    const brancos = historico.filter(item => item.cor === 'BRANCO');
    if (brancos.length < 2) {
      ultimaPrevisaoEl.textContent = 'Ainda não há histórico suficiente de brancos para previsão.';
      prepararBotoesAcertoErro(true);
      limparGrafico();
      return;
    }

    // Calcular intervalos entre brancos
    let intervalos = [];
    for(let i=1; i<brancos.length; i++){
      intervalos.push(brancos[i].horario - brancos[i-1].horario);
    }

    // Média dos intervalos
    const mediaIntervalo = intervalos.reduce((a,b) => a+b,0) / intervalos.length;

    // Previsão do próximo branco
    const ultimoBranco = brancos[brancos.length-1];
    const proximoBrancoTempo = ultimoBranco.horario + mediaIntervalo;

    // Checar se próximo branco está no futuro (dentro do dia)
    if (proximoBrancoTempo > 86399) {
      ultimaPrevisaoEl.textContent = 'Previsão do branco está fora do horário do dia.';
      prepararBotoesAcertoErro(true);
      limparGrafico();
      return;
    }

    // Mostrar a previsão formatada
    ultimaPrevisao = proximoBrancoTempo;
    ultimaPrevisaoEl.textContent = `PRÓXIMO BRANCO PROVÁVEL EM ${formatHorario(proximoBrancoTempo)} — PREPARA!`;

    // Acionar aviso sonoro e visual
    avisarUsuario();

    // Habilitar botões de acerto/erro
    prepararBotoesAcertoErro(false);

    // Gerar probabilidades para gráfico (simples)
    const probabilidades = intervalos.map(i => Math.min(1, i / mediaIntervalo));
    desenharGrafico(probabilidades);

    // Mostrar status do sinal (forte ou arriscado)
    const erroTaxa = aprendizado.erros + aprendizado.acertos === 0 ? 0 : aprendizado.erros / (aprendizado.erros + aprendizado.acertos);
    if (erroTaxa < 0.3) {
      statusApostaEl.textContent = 'Sinal FORTE para apostar!';
      statusApostaEl.style.color = '#4caf50';
    } else if (erroTaxa < 0.6) {
      statusApostaEl.textContent = 'Sinal ARRISCADO. Atenção!';
      statusApostaEl.style.color = '#e6b800';
    } else {
      statusApostaEl.textContent = 'Sinal FRACO. Melhor aguardar mais dados.';
      statusApostaEl.style.color = '#e03b3b';
    }
  }

  // Função para aviso sonoro e visual
  function avisarUsuario() {
    mensagemAlertaEl.textContent = '⚠️ Scofield alerta: Branco próximo! Prepare-se!';
    // Som simples usando beep do browser via AudioContext
    try {
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      const ctx = new AudioContext();
      const osc = ctx.createOscillator();
      osc.type = 'square';
      osc.frequency.setValueAtTime(440, ctx.currentTime);
      osc.connect(ctx.destination);
      osc.start();
      osc.stop(ctx.currentTime + 0.3);
    } catch(e) {
      // Não suportado
    }
  }

  // Inicialização
  renderizarHistorico();
  analisarHistorico();
  prepararBotoesAcertoErro(true);

  // Atualizar previsão a cada 10s (simulação)
  setInterval(() => {
    analisarHistorico();
  }, 10000);

</script>

</body>
</html>
