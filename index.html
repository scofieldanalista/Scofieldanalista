<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scofield Analista V5 PRO ⚪</title>
  <style>
    body { background: #111; color: #eee; font-family: 'Segoe UI', sans-serif; padding: 15px; }
    h1 { text-align: center; color: #ff4747; }
    textarea, input, button { width: 100%; padding: 10px; margin: 5px 0; border-radius: 5px; box-sizing: border-box; }
    textarea, input { background: #222; color: #eee; border: 1px solid #555; }
    button { background: #ff4747; color: white; border: none; cursor: pointer; font-weight: bold; }
    button:hover { background: #e53e3e; }
    .secao { margin-top: 25px; }
    .estatisticas { white-space: pre-line; background: #222; padding: 10px; border-radius: 5px; margin-top: 15px; font-size: 1em; }
    #avisoRecChuva { background: #440000; color: #ff5555; padding: 10px; text-align: center; border-radius: 5px; font-weight: bold; margin-bottom: 15px; }
    #proximaPrevisao { background: #330000; color: #ff4747; padding: 10px; text-align: center; border-radius: 5px; font-weight: bold; margin-bottom: 15px; }
  </style>
</head>
<body>
  <h1>Scofield Analista V5 PRO ⚪</h1>

  <div id="proximaPrevisao">Próxima previsão forte: --:--:--</div>
  <div id="avisoRecChuva"></div>

  <div class="secao">
    <h3>🧠 Histórico Cérebro</h3>
    <textarea id="historicoCerebro" rows="8" placeholder="Cole aqui o histórico completo com horários, números e cores..."></textarea>
    <button onclick="enviarCerebro()">📤 Enviar Histórico</button>
    <div id="mensagemCerebro" style="color:#8f8; margin-top:6px;"></div>
    <div>Estratégias criadas: <span id="numEstrategias">0</span></div>
  </div>

  <div class="secao">
    <h3>⏱️ Começar Análise</h3>
    <textarea id="historicoAtual" rows="6" placeholder="Cole aqui as últimas jogadas para prever os brancos..."></textarea>
    <button onclick="analisarAgora()">🔍 Analisar</button>
    <div id="previsoes"></div>
    <button onclick="mostrarMinutosQuentes()">📈 Ver Minutos Quentes</button>
    <div id="minutosQuentes" class="estatisticas"></div>
  </div>

  <div class="secao">
    <h3>📊 Estatísticas</h3>
    <div id="estatisticas" class="estatisticas">Nenhuma estatística registrada.</div>
    <button onclick="limparEstatisticas()">🧹 Limpar Estatísticas</button>
  </div>

  <div class="secao">
    <h3>🧹 Limpar Histórico</h3>
    <button onclick="limparHistorico()">🧼 Limpar Campos de Histórico</button>
    <div id="mensagemHistorico" style="color:#8f8; margin-top:10px;"></div>
  </div>

  <script>
    const VERMELHA = new Set(['1','2','3','4','5','6','7']);
    const PRETA = new Set(['8','9','10','11','12','13','14']);
    const horasFiltro = 60 * 60 * 1000; // 1 hora
    let estrategias = JSON.parse(localStorage.getItem("estrategias")||"[]");
    let estatisticas = JSON.parse(localStorage.getItem("estatisticas")||"[]");
    let historicos = JSON.parse(localStorage.getItem("historicos")||"[]");

    function salvar() {
      localStorage.setItem("estrategias", JSON.stringify(estrategias));
      localStorage.setItem("estatisticas", JSON.stringify(estatisticas));
      localStorage.setItem("historicos", JSON.stringify(historicos));
      atualizarContadores();
    }

    function atualizarContadores() {
      document.getElementById("numEstrategias").innerText = estrategias.length;
      atualizarEstatisticas();
    }

    function atualizarEstatisticas() {
      const div = document.getElementById("estatisticas");
      if (!estatisticas.length) {
        div.innerText = "Nenhuma estatística registrada."; return;
      }
      const seq = calcularSequencia();
      let linhas = estatisticas.map(e=>`${e.horario} ${e.acerto?"✅":"❌"} - ${new Date(e.data).toLocaleString()}`);
      linhas.push(`\n🔄 Sequência atual: ${seq.acertos} acerto(s), ${seq.erros} erro(s).`);
      div.innerText = linhas.join('\n');
    }

    function calcularSequencia(){
      let ac=0, er=0;
      for(let i=estatisticas.length-1;i>=0;i--){
        if(estatisticas[i].acerto) { if(er) break; ac++; } else { if(ac) break; er++; }
      }
      return {acertos: ac, erros: er};
    }

    function parsear(hist){
      const linhas = hist.trim().split(/\r?\n/).map(l=>l.trim()).filter(l=>l);
      let res=[], i=0;
      while(i<linhas.length){
        let num=linhas[i], hora=linhas[i+1];
        if(/^\d{2}:\d{2}:\d{2}$/.test(hora)){
          let cor="branco";
          if(num==='0'||!num) cor="branco";
          else if(VERMELHA.has(num)) cor="vermelha";
          else if(PRETA.has(num)) cor="preta";
          else cor="desconhecida";
          res.push({num, hora, cor, t: timeToSec(hora)});
          i+=2;
        } else i++;
      }
      return res;
    }

    function timeToSec(h){
      const [H,M,S]=h.split(':').map(x=>+x);
      return H*3600+M*60+S;
    }

    function enviarCerebro(){
      const hist = document.getElementById("historicoCerebro").value;
      const arr = parsear(hist);
      if(arr.length<2){ alert("Histórico inválido."); return; }
      historicos.push({ts: Date.now(), itens: arr});
      gerarEstrategias(arr);
      document.getElementById("mensagemCerebro").innerText=`✅ Histórico enviado! Estratégias: ${estrategias.length}`;
      salvar();
    }

    function gerarEstrategias(arr){
      estrategias = []; // reinicia
      for(let i=0;i<arr.length-1;i++){
        if(arr[i].cor==="branco" && arr[i+1].cor==="branco"){
          const tempo = arr[i+1].t - arr[i].t;
          const soma = +arr[i-1]?.num + +arr[i+1]?.num || null;
          if(!soma) continue;
          estrategias.push({
            hora0:arr[i].hora, hora1:arr[i+1].hora,
            soma, dif:tempo,
            peso:1, criado:Date.now()
          });
        }
      }
    }

    function analisarAgora(){
      const hist = document.getElementById("historicoAtual").value;
      const arr = parsear(hist);
      if(arr.length<2){ alert("Histórico inválido."); return; }
      const brancos=arr.filter(x=>x.cor==="branco");
      if(!brancos.length){ alert("Sem brancos."); return; }
      const ult=brancos.slice(-1)[0];
      const contexto = brancos.slice(-2)[0];
      const somaAt = contexto ? (+contexto.num + +ult.num): null;
      const agoraSec=ult.t;
      // filtrar por hora
      const corte = Date.now() - horasFiltro;
      const ates=estrategias.filter(e=>e.criado>=corte);
      const comp = ates.filter(e=>e.soma===somaAt);
      if(!comp.length){
        document.getElementById("previsoes").innerText="⚠️ Sem padrão. REC possível.";
        return;
      }
      // escolher maior peso
      comp.sort((a,b)=>b.peso-a.peso);
      const top=comp[0];
      const prox = agoraSec + top.dif;
      const hh = String(Math.floor(prox/3600)%24).padStart(2,'0');
      const mm = String(Math.floor(prox/60)%60).padStart(2,'0');
      const ss = String(prox%60).padStart(2,'0');
      document.getElementById("previsoes").innerHTML=`<div>${hh}:${mm}:${ss} (⚪ Forte)</div>`;
      document.getElementById("proximaPrevisao").innerText=`Próxima previsão forte: ${hh}:${mm}:${ss}`;
    }

    function mostrarMinutosQuentes(){
      const freq={};
      estrategias.forEach(e=>{
        const min=e.hora1.slice(3,5);
        freq[min]=(freq[min]||0)+e.peso;
      });
      const ord=Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0,10);
      const div=document.getElementById("minutosQuentes");
      div.innerHTML=ord.map(o=>`Minuto ${o[0]} - Peso ${o[1]}`).join('<br>');
    }

    function registrarAcerto(h){
      estatisticas.push({horario:h, acerto:true, data:Date.now()});
      estrategias.forEach(e=>{ if(e.hora1===h) e.peso++; });
      salvar();
    }

    function registrarErro(h){
      estatisticas.push({horario:h, acerto:false, data:Date.now()});
      estrategias.forEach(e=>{ if(e.hora1===h) e.peso=Math.max(1, e.peso-1); });
      salvar();
    }

    function limparEstatisticas(){
      if(confirm("Apagar estatísticas?")){
        estatisticas=[]; salvar(); atualizarEstatisticas();
      }
    }

    function limparHistorico(){
      if(confirm("Limpar tudo?")){
        document.getElementById("historicoCerebro").value="";
        document.getElementById("historicoAtual").value="";
        document.getElementById("mensagemCerebro").innerText="";
        document.getElementById("mensagemHistorico").innerText="Campos limpos.";
        document.getElementById("previsoes").innerText="";
        document.getElementById("minutosQuentes").innerText="";
        document.getElementById("proximaPrevisao").innerText="Próxima previsão forte: --:--:--";
      }
    }

    window.onload = () => { atualizarContadores(); };

  </script>
</body>
</html>
