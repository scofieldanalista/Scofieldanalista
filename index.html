<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Scofield Analista V5 - Previs√£o em Tempo Real</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background:#111; color:#eee;
    margin:0; padding:20px;
    text-align:center;
  }
  h1 {
    color:#00ffcc;
    margin-bottom:15px;
  }
  textarea, input {
    width: 90%;
    max-width: 450px;
    padding: 8px;
    margin: 8px 0;
    border-radius: 6px;
    border:none;
    background:#222;
    color:#eee;
    font-family: monospace;
    font-size: 14px;
  }
  button {
    background:#00ffcc;
    border:none;
    border-radius:6px;
    padding:10px 20px;
    margin:8px 5px 15px 5px;
    font-weight:bold;
    cursor:pointer;
    color:#000;
    transition: background 0.3s ease;
  }
  button:hover {
    background:#00bfa5;
    color:#fff;
  }
  .block-container {
    display:flex;
    justify-content:center;
    gap:15px;
    margin:20px 0;
  }
  .block {
    width: 80px;
    height: 80px;
    border-radius:10px;
    font-weight:bold;
    font-size:20px;
    display:flex;
    justify-content:center;
    align-items:center;
    color:#111;
    user-select:none;
    box-shadow: 0 0 6px rgba(0,0,0,0.4);
  }
  .vermelho { background:#e53935; color:#fff;}
  .preto { background:#212121; color:#fff;}
  .branco { background:#fff; color:#111;}
  #resultado {
    margin-top: 20px;
    font-size: 18px;
    font-weight: bold;
    min-height: 40px;
    max-width: 450px;
    margin-left: auto;
    margin-right: auto;
    padding: 10px;
    background: #222;
    border-radius: 8px;
    color: #00ffcc;
  }
  #listaPrevisoes {
    max-width: 450px;
    margin: 20px auto 0 auto;
    text-align: left;
    background: #222;
    padding: 15px;
    border-radius: 8px;
    font-size: 15px;
    color: #ccc;
    min-height: 80px;
  }
  #feedbackBtns button {
    background:#007bff;
    color:#fff;
    margin-top: 10px;
  }
  #feedbackBtns button:hover {
    background:#0056b3;
  }
</style>
</head>
<body>

<h1>üîç Scofield Analista V5 - Previs√£o Real</h1>

<div>
  <textarea id="historico" placeholder="Cole o hist√≥rico da Blaze (n√∫mero e hor√°rio). Exemplo:\n1\n00:00:05\n3\n00:00:10\nbranco\n00:00:15\n7\n00:00:20\n"></textarea><br>
  <button onclick="analisarHistorico()">Analisar Hist√≥rico</button>
  <button onclick="limparHistorico()">Limpar Hist√≥rico</button>
</div>

<h2>Informe um padr√£o manual</h2>
<div class="block-container">
  <div id="blocoAnterior" class="block branco">?</div>
  <div class="block branco" style="font-size: 32px;">üé≤</div>
  <div id="blocoPosterior" class="block branco">?</div>
</div>

<div>
  <input id="anterior" type="text" placeholder="N√∫mero anterior / hor√°rio (ex: 5/00:01:15)" />
  <input id="posterior" type="text" placeholder="N√∫mero posterior / hor√°rio (ex: 9/00:01:18)" />
  <input id="branco" type="text" placeholder="Hor√°rio do branco (ex: 00:01:20)" />
  <button onclick="analisarPadrao()">Analisar padr√£o</button>
</div>

<div id="resultado"></div>

<h3>Pr√≥ximos minutos prov√°veis para branco:</h3>
<div id="listaPrevisoes">Previs√£o ser√° exibida aqui ap√≥s an√°lise.</div>

<div id="feedbackBtns">
  <button onclick="registrarResultado(true)">‚úÖ Acertou</button>
  <button onclick="registrarResultado(false)">‚ùå Errou</button>
</div>

<script>
  let estrategias = [];
  let ultimaAnalise = null;
  let pesoMaximo = 10;
  let pesoMinimo = 0;

  function corDaPedra(numero) {
    if (!numero || isNaN(numero)) return 'branco';
    numero = parseInt(numero);
    if (numero >= 1 && numero <= 7) return 'vermelho';
    if (numero >= 8 && numero <= 14) return 'preto';
    return 'branco';
  }
  function atualizarBlocos() {
    const anterior = document.getElementById("anterior").value.split('/')[0];
    const posterior = document.getElementById("posterior").value.split('/')[0];
    const blocoAnterior = document.getElementById("blocoAnterior");
    const blocoPosterior = document.getElementById("blocoPosterior");
    blocoAnterior.className = "block " + corDaPedra(anterior);
    blocoAnterior.textContent = anterior || "?";
    blocoPosterior.className = "block " + corDaPedra(posterior);
    blocoPosterior.textContent = posterior || "?";
  }
  document.getElementById("anterior").addEventListener("input", atualizarBlocos);
  document.getElementById("posterior").addEventListener("input", atualizarBlocos);

  function horarioParaSegundos(horario) {
    if(!horario) return null;
    const partes = horario.split(":").map(Number);
    if(partes.length !== 3) return null;
    return partes[0]*3600 + partes[1]*60 + partes[2];
  }

  function segundosParaHorario(segundos) {
    if (segundos === null) return "??:??:??";
    segundos = segundos % 86400; // Ajustar para um dia s√≥
    let h = Math.floor(segundos / 3600);
    let m = Math.floor((segundos % 3600) / 60);
    let s = segundos % 60;
    return [h,m,s].map(x => x.toString().padStart(2,'0')).join(":");
  }

  function analisarHistorico() {
    const texto = document.getElementById("historico").value.trim();
    if(!texto) {
      alert("Cole o hist√≥rico antes de analisar.");
      return;
    }
    const linhas = texto.split('\n');
    let registros = [];
    let brancosCount = 0;
    for(let i=0; i<linhas.length; i++) {
      let linha = linhas[i].trim();
      if(!linha) continue;
      let numero = null;
      let horario = null;
      let numeroEncontrado = linha.match(/\d+/);
      if(numeroEncontrado) {
        numero = numeroEncontrado[0];
        if(i+1 < linhas.length && linhas[i+1].match(/\d{2}:\d{2}:\d{2}/)) {
          horario = linhas[i+1].trim();
          i++;
        }
      } else {
        if(linha.toLowerCase().includes('branco') || linha === '') {
          numero = null;
          horario = (i+1 < linhas.length && linhas[i+1].match(/\d{2}:\d{2}:\d{2}/)) ? linhas[i+1].trim() : null;
          i += horario ? 1 : 0;
          brancosCount++;
        } else if(linha.match(/\d{2}:\d{2}:\d{2}/)) {
          numero = null;
          horario = linha;
          brancosCount++;
        } else {
          continue;
        }
      }
      registros.push({
        numero,
        horario,
        cor: corDaPedra(numero),
        segundos: horarioParaSegundos(horario)
      });
    }
    if(brancosCount === 0) {
      alert("‚ö†Ô∏è Aten√ß√£o: Nenhum branco detectado no hist√≥rico. Verifique o formato dos dados colados.");
    }
    gerarEstrategias(registros);
    document.getElementById("resultado").style.color = "#00ffcc";
    document.getElementById("resultado").textContent = `‚úÖ Hist√≥rico analisado com sucesso! Brancos detectados: ${brancosCount}`;
    mostrarPrevisoes();
    ultimaAnalise = registros;
  }

  function gerarEstrategias(registros) {
    estrategias = [];
    for(let i=1; i < registros.length - 1; i++) {
      if(registros[i].cor === 'branco' && registros[i].segundos !== null) {
        let anterior = registros[i-1];
        let posterior = registros[i+1];
        if(anterior && posterior && anterior.segundos !== null && posterior.segundos !== null) {
          let soma = (parseInt(anterior.numero)||0) + (parseInt(posterior.numero)||0);
          let intervalo = Math.abs(registros[i].segundos - anterior.segundos);
          let horario = registros[i].segundos;
          let faixa = faixaHoraria(horario);
          let existente = estrategias.find(e => 
            e.soma === soma &&
            Math.abs(e.intervalo - intervalo) <= 5 &&
            e.faixa === faixa
          );
          if(existente) {
            existente.peso = Math.min(pesoMaximo, existente.peso + 0.1);
            existente.contagem++;
          } else {
            estrategias.push({
              soma,
              intervalo,
              horario,
              peso: 3,
              contagem: 1,
              acertos: 0,
              erros: 0,
              faixa
            });
          }
        }
      }
    }
  }

  function faixaHoraria(segundos) {
    if(segundos === null) return "desconhecido";
    let h = Math.floor(segundos/3600);
    if(h < 12) return "manh√£";
    else if(h < 18) return "tarde";
    else return "noite";
  }

  function analisarPadrao() {
    const anteriorRaw = document.getElementById("anterior").value.trim();
    const posteriorRaw = document.getElementById("posterior").value.trim();
    const brancoRaw = document.getElementById("branco").value.trim();
    if(!anteriorRaw || !posteriorRaw || !brancoRaw) {
      alert("Preencha todos os campos corretamente.");
      return;
    }
    const anteriorParts = anteriorRaw.split('/');
    const posteriorParts = posteriorRaw.split('/');
    if(anteriorParts.length !== 2 || posteriorParts.length !== 2) {
      alert("Preencha n√∫mero e hor√°rio separados por /, ex: 5/00:01:15");
      return;
    }
    const numAnterior = parseInt(anteriorParts[0]);
    const horaAnterior = anteriorParts[1];
    const numPosterior = parseInt(posteriorParts[0]);
    const horaPosterior = posteriorParts[1];
    const horaBranco = brancoRaw;
    if(isNaN(numAnterior) || isNaN(numPosterior)) {
      alert("N√∫meros anteriores e posteriores inv√°lidos.");
      return;
    }
    const somaAtual = numAnterior + numPosterior;
    const intervaloAtual = Math.abs(horarioParaSegundos(horaBranco) - horarioParaSegundos(horaAnterior));
    const faixaAtual = faixaHoraria(horarioParaSegundos(horaBranco));
    let encontradas = estrategias.filter(e => 
      e.soma === somaAtual &&
      Math.abs(e.intervalo - intervaloAtual) <= 5 &&
      e.faixa === faixaAtual
    );
    if(encontradas.length === 0) {
      document.getElementById("resultado").style.color = "#ffbb33";
      document.getElementById("resultado").textContent = "‚ö†Ô∏è Nenhum padr√£o exato encontrado. Aguardar novo hist√≥rico.";
      ultimaAnalise = null;
      return;
    }
    let pesoTotal = 0;
    encontradas.forEach(e => pesoTotal += e.peso);
    let pesoMedio = pesoTotal / encontradas.length;
    let texto = `üìå Padr√£o identificado! Peso m√©dio: ${pesoMedio.toFixed(2)}. `;
    if(pesoMedio >= 4) texto += "üí™ Sinal forte para branco!";
    else if(pesoMedio >= 2) texto += "‚ö†Ô∏è Sinal m√©dio, aposte com cautela.";
    else texto += "‚ùó Sinal arriscado, prefira aguardar.";
    document.getElementById("resultado").style.color = pesoMedio >= 4 ? "#00ff00" : pesoMedio >= 2 ? "#ffbb33" : "#ff4444";
    document.getElementById("resultado").textContent = texto;
    ultimaAnalise = encontradas;
    mostrarPrevisoes(pesoMedio, encontradas);
  }

  function mostrarPrevisoes(pesoMedio = null, encontradas = null) {
    const container = document.getElementById("listaPrevisoes");
    if(!estrategias || estrategias.length === 0) {
      container.textContent = "Cole o hist√≥rico e analise para gerar previs√µes.";
      return;
    }
    // Pegar hor√°rio atual em segundos
    let agora = new Date();
    let segundosAgora = agora.getHours()*3600 + agora.getMinutes()*60 + agora.getSeconds();

    // Filtrar estrat√©gias com peso bom e que ocorrem em faixa hor√°ria atual
    let faixaAtual = faixaHoraria(segundosAgora);

    let possiveis = estrategias.filter(e => 
      e.peso >= 2 && e.faixa === faixaAtual
    );

    if(possiveis.length === 0) {
      container.textContent = "Sem estrat√©gias confi√°veis para o hor√°rio atual.";
      return;
    }

    // Para cada estrat√©gia, prever pr√≥ximo hor√°rio aproximado somando intervalo ao √∫ltimo hor√°rio conhecido
    // Ex: se estrat√©gia indica intervalo de 12 segundos, e √∫ltimo branco foi √†s 00:01:15, pr√≥ximo deve sair +/- 00:01:27
    // Aqui vamos usar hor√°rio da estrat√©gia + m√∫ltiplos de intervalo que estejam pr√≥ximos do hor√°rio atual

    // Buscar pr√≥ximas janelas dentro de +/- 300 segundos (5 minutos) do hor√°rio atual
    let proximosMinutos = [];

    possiveis.forEach(e => {
      // calcular pr√≥xima poss√≠vel sa√≠da somando intervalos m√∫ltiplos at√© ultrapassar agora
      let intervalo = e.intervalo;
      let baseHorario = e.horario;
      let diff = segundosAgora - baseHorario;
      let multiplo = Math.ceil(diff / intervalo);
      if(multiplo < 1) multiplo = 1;
      let proximoHorario = baseHorario + multiplo*intervalo;

      // Ajustar para um dia (mod 86400)
      proximoHorario = proximoHorario % 86400;

      // Calcular diferen√ßa entre agora e pr√≥ximo hor√°rio
      let segundosAteProximo = proximoHorario - segundosAgora;
      if(segundosAteProximo < 0) segundosAteProximo += 86400;

      // Considerar s√≥ pr√≥ximos em at√© 10 minutos
      if(segundosAteProximo <= 600) {
        proximosMinutos.push({
          horario: proximoHorario,
          peso: e.peso,
          soma: e.soma,
          intervalo: e.intervalo
        });
      }
    });

    if(proximosMinutos.length === 0) {
      container.textContent = "Nenhuma previs√£o para os pr√≥ximos 10 minutos.";
      return;
    }

    // Ordenar por peso decrescente e hor√°rio crescente
    proximosMinutos.sort((a,b) => {
      if(b.peso !== a.peso) return b.peso - a.peso;
      return a.horario - b.horario;
    });

    // Exibir top 5 previs√µes
    let exibicao = proximosMinutos.slice(0,5).map(p => {
      return `‚è∞ ${segundosParaHorario(p.horario)} (peso: ${p.peso.toFixed(2)}, soma: ${p.soma}, intervalo: ${p.intervalo}s)`;
    }).join('\n');

    container.textContent = exibicao;
  }

  function registrarResultado(acertou) {
    if(!ultimaAnalise || ultimaAnalise.length === 0) {
      alert("N√£o h√° an√°lise atual para registrar resultado.");
      return;
    }
    ultimaAnalise.forEach(e => {
      if(acertou) {
        e.acertos = (e.acertos || 0) + 1;
        e.peso = Math.min(pesoMaximo, e.peso + 0.5);
      } else {
        e.erros = (e.erros || 0) + 1;
        e.peso = Math.max(pesoMinimo, e.peso - 0.7);
      }
    });
    alert(acertou ? "‚úÖ Resultado registrado como ACERTO!" : "‚ùå Resultado registrado como ERRO.");
    mostrarPrevisoes();
  }

  function limparHistorico() {
    if(confirm("Deseja realmente limpar todo o hist√≥rico e estrat√©gias salvas?")) {
      document.getElementById("historico").value = "";
      document.getElementById("resultado").textContent = "";
      document.getElementById("listaPrevisoes").textContent = "Previs√£o ser√° exibida aqui ap√≥s an√°lise.";
      estrategias = [];
      ultimaAnalise = null;
      document.getElementById("blocoAnterior").className = "block branco";
      document.getElementById("blocoAnterior").textContent = "?";
      document.getElementById("blocoPosterior").className = "block branco";
      document.getElementById("blocoPosterior").textContent = "?";
    }
  }
</script>

</body>
</html>
