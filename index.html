<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Scofield Analista V2 PRO ‚ö™</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: 'Segoe UI', sans-serif;
    padding: 15px;
  }
  h1 {
    text-align: center;
    color: #ff4747;
    margin-bottom: 5px;
  }
  #status {
    text-align: center;
    font-size: 0.9em;
    color: #bbb;
    margin-bottom: 15px;
  }
  textarea, input, button {
    width: 100%;
    padding: 10px;
    margin: 5px 0;
    border-radius: 5px;
    box-sizing: border-box;
  }
  textarea, input {
    background: #222;
    color: #eee;
    border: 1px solid #555;
  }
  button {
    background: #ff4747;
    color: white;
    border: none;
    cursor: pointer;
    font-weight: bold;
  }
  button:hover {
    background: #e53e3e;
  }
  .secao {
    margin-top: 25px;
  }
  .sinal {
    background: #222;
    padding: 10px;
    margin-top: 10px;
    border-radius: 5px;
  }
  .sinal button {
    width: 48%;
    margin: 2px 1%;
  }
  .estatisticas {
    white-space: pre-line;
    background: #222;
    padding: 10px;
    border-radius: 5px;
    margin-top: 15px;
    font-size: 1em;
  }
  #minutosQuentesBox {
    background: #222;
    border-radius: 5px;
    padding: 10px;
    margin-top: 15px;
    max-height: 200px;
    overflow-y: auto;
    font-size: 1em;
  }
  #proximaPrevisao {
    text-align: center;
    font-size: 1.1em;
    font-weight: bold;
    color: #ff4747;
    margin-bottom: 10px;
  }
</style>
</head>
<body>
  <h1>Scofield Analista V2 PRO ‚ö™</h1>
  <div id="status">Nenhuma previs√£o ainda.</div>
  
  <div class="secao">
    <h3>üß† Hist√≥rico C√©rebro</h3>
    <textarea id="historicoCerebro" rows="8" placeholder="Cole aqui o hist√≥rico completo com hor√°rios, n√∫meros e cores..."></textarea>
    <button onclick="enviarCerebro()">üì§ Enviar Hist√≥rico</button>
    <div id="mensagemCerebro" style="color:#8f8; margin-top:5px;"></div>
    <div id="estrategiasCriadas" style="margin-top:5px; color:#bbb;"></div>
  </div>

  <div class="secao">
    <h3>‚è±Ô∏è Come√ßar An√°lise</h3>
    <textarea id="historicoAtual" rows="6" placeholder="Cole aqui as √∫ltimas jogadas para prever os brancos..."></textarea>
    <button onclick="analisarAgora()">üîç Analisar</button>
    <div id="previsoes"></div>
  </div>

  <div class="secao">
    <button onclick="mostrarMinutosQuentes()">üìà Ver Minutos Quentes</button>
    <div id="minutosQuentesBox" style="display:none;"></div>
  </div>

  <div class="secao">
    <h3>üìä Estat√≠sticas</h3>
    <div id="estatisticas" class="estatisticas"></div>
    <button onclick="limparEstatisticas()">üßπ Limpar Estat√≠sticas</button>
  </div>

  <div class="secao">
    <h3>üßπ Limpar Hist√≥rico</h3>
    <button onclick="limparHistorico()">üßº Limpar Campos de Hist√≥rico</button>
    <div id="mensagemHistorico" style="margin-top:10px;color:#8f8;"></div>
  </div>

<script>
  // Dados persistentes
  let estrategias = JSON.parse(localStorage.getItem("estrategias") || "[]");
  let estatisticas = JSON.parse(localStorage.getItem("estatisticas") || "[]");
  let minutosQuentes = JSON.parse(localStorage.getItem("minutosQuentes") || "{}");
  let padroesSalvos = JSON.parse(localStorage.getItem("padroesSalvos") || "[]");
  let proximaPrevisaoHora = null;

  // Atualiza √°rea de estrat√©gias criadas e estat√≠sticas
  function atualizarInterface() {
    document.getElementById("estrategiasCriadas").innerText = `Estrat√©gias criadas: ${estrategias.length}`;
    atualizarEstatisticas();
    if(proximaPrevisaoHora){
      document.getElementById("status").innerText = `Pr√≥xima previs√£o forte: ${proximaPrevisaoHora}`;
    } else {
      document.getElementById("status").innerText = "Nenhuma previs√£o ainda.";
    }
  }

  // Salvar dados no localStorage
  function salvarDados() {
    localStorage.setItem("estrategias", JSON.stringify(estrategias));
    localStorage.setItem("estatisticas", JSON.stringify(estatisticas));
    localStorage.setItem("minutosQuentes", JSON.stringify(minutosQuentes));
    localStorage.setItem("padroesSalvos", JSON.stringify(padroesSalvos));
    atualizarInterface();
  }

  // Parse hist√≥rico c√©rebro
  function parseHistorico(texto) {
    // Formato esperado: n√∫mero\nhor√°rio\n (exemplo: "3\n02:12:42\n")
    const linhas = texto.trim().split('\n').filter(l => l.trim() !== "");
    let resultado = [];
    for(let i=0; i<linhas.length; i++) {
      let linha = linhas[i].trim();
      if(/^\d{2}:\d{2}:\d{2}$/.test(linha)) {
        // hor√°rio
        let num = null;
        if(i > 0 && !/^\d{2}:\d{2}:\d{2}$/.test(linhas[i-1])) {
          num = parseInt(linhas[i-1]);
        }
        resultado.push({numero: num, horario: linha});
      }
    }
    return resultado;
  }

  // An√°lise de padr√µes b√°sicos (exemplo simples para soma anterior+posterior)
  function analisarPadroes(histCerebro) {
    let novasEstrategias = [];
    // Exemplo de detec√ß√£o: soma do n√∫mero da pedra anterior + pr√≥xima
    for(let i=1; i < histCerebro.length -1; i++) {
      let soma = 0;
      if(histCerebro[i-1].numero && histCerebro[i+1].numero) {
        soma = histCerebro[i-1].numero + histCerebro[i+1].numero;
        // Verifica se estrat√©gia j√° existe
        let existe = estrategias.find(e => e.tipo === "soma" && e.valor === soma);
        if(!existe) {
          novasEstrategias.push({tipo:"soma", valor:soma, acertos:0, erros:0, horarios:[]});
        }
      }
    }
    return novasEstrategias;
  }

  // Atualiza minutos quentes baseado no hist√≥rico c√©rebro
  function atualizarMinutosQuentes(histCerebro) {
    histCerebro.forEach(item => {
      let min = item.horario.split(":")[1]; // minuto
      minutosQuentes[min] = (minutosQuentes[min] || 0) + 1;
    });
  }

  // Detecta se padr√£o j√° foi salvo antes (simples compara√ß√£o de hor√°rios)
  function detectarPadrao(histAtual) {
    for(let padrao of padroesSalvos) {
      // comparar sequ√™ncias hor√°rios simples
      if(padrao.horarios.length !== histAtual.length) continue;
      let match = true;
      for(let i=0; i<histAtual.length; i++) {
        if(padrao.horarios[i] !== histAtual[i].horario) {
          match = false;
          break;
        }
      }
      if(match) return padrao;
    }
    return null;
  }

  // Fun√ß√£o para enviar hist√≥rico c√©rebro
  function enviarCerebro() {
    const texto = document.getElementById("historicoCerebro").value;
    if(texto.trim().length < 10) {
      alert("Hist√≥rico muito curto.");
      return;
    }
    const histCerebro = parseHistorico(texto);
    if(histCerebro.length === 0) {
      alert("Formato do hist√≥rico inv√°lido.");
      return;
    }

    // Atualizar minutos quentes
    atualizarMinutosQuentes(histCerebro);

    // Detectar e adicionar novas estrat√©gias
    let novas = analisarPadroes(histCerebro);
    if(novas.length > 0){
      estrategias = estrategias.concat(novas);
    }

    // Salvar padr√µes para reconhecimento futuro
    padroesSalvos.push({horarios: histCerebro.map(h=>h.horario), data: new Date().toISOString()});

    salvarDados();

    document.getElementById("mensagemCerebro").innerText = "‚úÖ Hist√≥rico analisado com sucesso!";
    atualizarInterface();
  }

  // Gera previs√µes com base nas estrat√©gias e minutos quentes
  function gerarPrevisoes(histAtual) {
    let resultados = [];
    const agora = new Date();
    // Para exemplo: pega os minutos quentes e cria previs√µes futuras nesses minutos na hora atual
    let minutosOrdenados = Object.entries(minutosQuentes)
      .sort((a,b) => b[1] - a[1])
      .map(e => parseInt(e[0]));

    // Usar s√≥ os 5 minutos mais quentes para n√£o lotar previs√£o
    let minutosTop = minutosOrdenados.slice(0,5);

    minutosTop.forEach(min => {
      let h = agora.getHours();
      let m = min;
      let s = 0;
      let nivel = "Forte";

      // Se o minuto j√° passou no hor√°rio atual, tenta hora seguinte
      if(m <= agora.getMinutes()){
        h = (h + 1) % 24;
      }

      let horarioStr = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;

      resultados.push({horario: horarioStr, nivel});
    });

    // Atualiza pr√≥xima previs√£o forte para exibi√ß√£o
    if(resultados.length > 0) proximaPrevisaoHora = resultados[0].horario;
    else proximaPrevisaoHora = null;
    atualizarInterface();

    return resultados;
  }

  // An√°lise do hist√≥rico atual para gerar previs√µes
  function analisarAgora() {
    const texto = document.getElementById("historicoAtual").value;
    if(texto.trim().length < 5){
      alert("Cole o hist√≥rico atual para analisar.");
      return;
    }

    const histAtual = parseHistorico(texto);
    if(histAtual.length === 0){
      alert("Formato do hist√≥rico atual inv√°lido.");
      return;
    }

    // Detectar padr√£o salvo para esse hist√≥rico
    const padrao = detectarPadrao(histAtual);
    const divPrevisoes = document.getElementById("previsoes");
    divPrevisoes.innerHTML = "";

    if(padrao){
      let msg = `<h4>üü¢ Padr√£o detectado com base em hist√≥rico salvo</h4>`;
      // Mostrar todos os hor√°rios dos brancos desse padr√£o
      msg += `<div>Hor√°rios do padr√£o salvo:</div><ul>`;
      padrao.horarios.forEach(h => {
        msg += `<li>${h}</li>`;
      });
      msg += `</ul>`;
      divPrevisoes.innerHTML = msg;
      proximaPrevisaoHora = padrao.horarios[0];
      atualizarInterface();
      return;
    }

    // Caso n√£o detecte padr√£o, usar minutos quentes para gerar previs√µes
    const previsoes = gerarPrevisoes(histAtual);

    if(previsoes.length === 0){
      divPrevisoes.innerHTML = `<p>üîç Nenhum padr√£o. Usando previs√£o simples:</p>`;
    } else {
      divPrevisoes.innerHTML = `<h4>üü¢ Brancos Prov√°veis:</h4>`;
      previsoes.forEach(p => {
        const sinalDiv = document.createElement("div");
        sinalDiv.className = "sinal";
        sinalDiv.innerHTML = `
          <strong>${p.horario}</strong> (${p.nivel})<br>
          <button onclick="registrarResultado('${p.horario}','win')">‚úÖ Acertou</button>
          <button onclick="registrarResultado('${p.horario}','loss')">‚ùå Errou</button>
        `;
        divPrevisoes.appendChild(sinalDiv);
      });
    }
  }

  // Bot√£o para mostrar minutos quentes guardados
  function mostrarMinutosQuentes() {
    const box = document.getElementById("minutosQuentesBox");
    if(box.style.display === "none"){
      box.style.display = "block";
      let lista = "";
      Object.entries(minutosQuentes)
        .sort((a,b) => b[1]-a[1])
        .forEach(([min, count]) => {
          lista += `Minuto ${min.padStart(2,'0')}: ${count} vezes\n`;
        });
      box.textContent = lista || "Nenhum minuto quente detectado ainda.";
    } else {
      box.style.display = "none";
    }
  }

  // Registrar resultado dos sinais para aprendizado
  function registrarResultado(horario, resultado) {
    estatisticas.push({ horario, resultado: resultado === 'win' ? '‚úÖ' : '‚ùå' });
    // Ajustar estrat√©gias com base no feedback
    ajustarEstrategias(horario, resultado);
    salvarDados();
  }

  // Ajusta estrat√©gias com base nos acertos/erros
  function ajustarEstrategias(horario, resultado) {
    // Exemplo simples: aumenta acerto ou erro na estrat√©gia que mais combina com o hor√°rio
    estrategias.forEach(est => {
      if(est.horarios.includes(horario)){
        if(resultado === "win") est.acertos++;
        else est.erros++;
      }
    });
  }

  // Atualiza estat√≠sticas vis√≠veis
  function atualizarEstatisticas() {
    const div = document.getElementById("estatisticas");
    div.innerText = estatisticas.map(e => `${e.horario} ${e.resultado}`).reverse().join("\n");
  }

  // Limpa estat√≠sticas
  function limparEstatisticas() {
    if(confirm("Tem certeza que deseja apagar as estat√≠sticas?")){
      estatisticas = [];
      salvarDados();
    }
  }

  // Limpa campos e mensagens relacionados ao hist√≥rico
  function limparHistorico() {
    document.getElementById("historicoCerebro").value = "";
    document.getElementById("historicoAtual").value = "";
    document.getElementById("mensagemCerebro").innerText = "";
    document.getElementById("previsoes").innerHTML = "";
    document.getElementById("mensagemHistorico").innerText = "‚úÖ Campos de hist√≥rico limpos! Estrat√©gias mantidas.";
  }

  // Inicializa√ß√£o da interface
  atualizarInterface();
</script>
</body>
</html>
