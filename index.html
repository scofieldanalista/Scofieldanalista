<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Scofield Analista - AnÃ¡lise InstantÃ¢nea</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #fff;
    color: #000;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    margin-bottom: 20px;
  }
  .container {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
  }
  .pedra {
    width: 120px;
    height: 160px;
    border: 3px solid #999;
    border-radius: 12px;
    text-align: center;
    padding: 10px;
    user-select: none;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .quadrado-cor {
    width: 100%;
    height: 120px;
    border-radius: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 70px;
    color: white;
  }
  .vermelho { background-color: #c0392b; }
  .preto { background-color: #000; }
  .branco {
    background-color: #ecf0f1;
    color: #000;
    position: relative;
  }
  .blaze-logo {
    width: 60px;
    height: 60px;
    margin: auto;
    background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/a/a6/Blaze_logo.svg/512px-Blaze_logo.svg.png') no-repeat center center;
    background-size: contain;
  }
  label {
    font-weight: bold;
    margin-top: 5px;
    font-size: 14px;
  }
  input[type=number], input[type=time] {
    width: 100%;
    font-size: 16px;
    padding: 4px;
    border-radius: 6px;
    border: 1.5px solid #888;
    text-align: center;
  }
  button {
    padding: 12px 30px;
    font-size: 18px;
    border: none;
    background-color: #c0392b;
    color: white;
    border-radius: 10px;
    cursor: pointer;
    margin-top: 10px;
  }
  #log {
    max-height: 260px;
    overflow-y: auto;
    width: 100%;
    max-width: 600px;
    background: #eee;
    padding: 15px;
    border-radius: 12px;
    font-size: 16px;
    margin-top: 25px;
  }
  .log-item {
    margin-bottom: 12px;
  }
  #resultado {
    margin-top: 20px;
    font-weight: bold;
    font-size: 18px;
    color: #c0392b;
    max-width: 600px;
    text-align: center;
  }
</style>
</head>
<body>

<h1>Scofield Analista - Entrada Visual & AnÃ¡lise</h1>

<div class="container">
  <div class="pedra" id="pedra-esq">
    <div class="quadrado-cor vermelho" id="cor-esq">ðŸ”´</div>
    <label for="num-esq">NÃºmero</label>
    <input type="number" id="num-esq" min="0" max="14" placeholder="0-14" />
    <label for="hora-esq">HorÃ¡rio</label>
    <input type="time" id="hora-esq" />
  </div>

  <div class="pedra" id="pedra-meio">
    <div class="quadrado-cor branco" id="cor-meio">
      <div class="blaze-logo"></div>
    </div>
    <label for="hora-meio">HorÃ¡rio Branco</label>
    <input type="time" id="hora-meio" />
  </div>

  <div class="pedra" id="pedra-dir">
    <div class="quadrado-cor vermelho" id="cor-dir">ðŸ”´</div>
    <label for="num-dir">NÃºmero</label>
    <input type="number" id="num-dir" min="0" max="14" placeholder="0-14" />
    <label for="hora-dir">HorÃ¡rio</label>
    <input type="time" id="hora-dir" />
  </div>
</div>

<button id="btn-salvar">Salvar Resultado</button>
<button id="btn-analisar">Analisar</button>

<div id="resultado"></div>

<div id="log"></div>

<script>
  // Cores possÃ­veis para esquerda e direita
  const cores = ['vermelho', 'preto'];
  const corEsqDiv = document.getElementById('cor-esq');
  const corDirDiv = document.getElementById('cor-dir');

  let corEsqIndex = 0;
  let corDirIndex = 0;

  function atualizaCor(div, index) {
    div.className = 'quadrado-cor ' + cores[index];
    div.textContent = cores[index] === 'vermelho' ? 'ðŸ”´' : 'âš«';
  }

  corEsqDiv.addEventListener('click', () => {
    corEsqIndex = (corEsqIndex + 1) % cores.length;
    atualizaCor(corEsqDiv, corEsqIndex);
  });

  corDirDiv.addEventListener('click', () => {
    corDirIndex = (corDirIndex + 1) % cores.length;
    atualizaCor(corDirDiv, corDirIndex);
  });

  let resultados = JSON.parse(localStorage.getItem('resultados')) || [];

  function salvaResultado() {
    const numEsq = Number(document.getElementById('num-esq').value);
    const horaEsq = document.getElementById('hora-esq').value;
    const horaMeio = document.getElementById('hora-meio').value;
    const numDir = Number(document.getElementById('num-dir').value);
    const horaDir = document.getElementById('hora-dir').value;

    if (
      isNaN(numEsq) || numEsq < 0 || numEsq > 14 ||
      isNaN(numDir) || numDir < 0 || numDir > 14 ||
      !horaEsq || !horaMeio || !horaDir
    ) {
      alert('Preencha todos os nÃºmeros corretamente (0 a 14) e horÃ¡rios.');
      return;
    }

    resultados.push({
      esquerda: { cor: cores[corEsqIndex], numero: numEsq, horario: horaEsq },
      meio: { cor: 'branco', horario: horaMeio },
      direita: { cor: cores[corDirIndex], numero: numDir, horario: horaDir }
    });

    localStorage.setItem('resultados', JSON.stringify(resultados));
    atualizaLog();
    limpaFormulario();
    document.getElementById('resultado').textContent = '';
  }

  function atualizaLog() {
    const logDiv = document.getElementById('log');
    if(resultados.length === 0) {
      logDiv.innerHTML = '<p>Nenhum resultado salvo.</p>';
      return;
    }
    let html = '';
    resultados.forEach((r, i) => {
      html += `<div class="log-item">
        <strong>Registro ${i+1}</strong><br>
        ðŸŸ¥ Esquerda: ${r.esquerda.cor} | NÂº: ${r.esquerda.numero} | Hora: ${r.esquerda.horario}<br>
        âšª Meio (Branco): Hora: ${r.meio.horario}<br>
        â¬› Direita: ${r.direita.cor} | NÂº: ${r.direita.numero} | Hora: ${r.direita.horario}
      </div>`;
    });
    logDiv.innerHTML = html;
  }

  function limpaFormulario() {
    document.getElementById('num-esq').value = '';
    document.getElementById('hora-esq').value = '';
    document.getElementById('hora-meio').value = '';
    document.getElementById('num-dir').value = '';
    document.getElementById('hora-dir').value = '';
  }

  // FunÃ§Ã£o para converter HH:MM para minutos totais (ex: 10:45 => 645)
  function horaParaMinutos(hora) {
    const [h, m] = hora.split(':').map(Number);
    return h * 60 + m;
  }

  // FunÃ§Ã£o para converter minutos totais para HH:MM
  function minutosParaHora(minutos) {
    const h = Math.floor(minutos / 60) % 24;
    const m = minutos % 60;
    return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
  }

  // Detecta padrÃµes Duplo, Dentado e Banguela (baseado nos horÃ¡rios)
  function detectarPadroesBranco() {
    const brancos = resultados.map((r, i) => ({
      index: i,
      horarioMin: horaParaMinutos(r.meio.horario)
    })).sort((a,b) => a.horarioMin - b.horarioMin);

    let padroesDetectados = [];

    for(let i=0; i < brancos.length -1; i++) {
      const diff = brancos[i+1].horarioMin - brancos[i].horarioMin;

      // Duplo: branco seguido imediatamente (mesmo minuto ou prÃ³ximo minuto)
      if(diff === 0 || diff === 1) {
        padroesDetectados.push(`Duplo: branco no minuto ${minutosParaHora(brancos[i].horarioMin)} seguido do minuto ${minutosParaHora(brancos[i+1].horarioMin)}`);
      }
      // Dentado: branco - qualquer pedra - branco (2 minutos de diferenÃ§a)
      else if(diff === 2) {
        padroesDetectados.push(`Dentado: branco no minuto ${minutosParaHora(brancos[i].horarioMin)}, pedra qualquer, branco no minuto ${minutosParaHora(brancos[i+1].horarioMin)}`);
      }
      // Banguela: branco e outro branco com atÃ© 3 minutos de diferenÃ§a (mas nÃ£o imediato nem dentado)
      else if(diff > 2 && diff <= 4) {
        padroesDetectados.push(`Banguela: branco no minuto ${minutosParaHora(brancos[i].horarioMin)} e outro branco no minuto ${minutosParaHora(brancos[i+1].horarioMin)}`);
      }
    }
    return padroesDetectados;
  }

  // Calcula mÃ©dia do intervalo em minutos entre os brancos para previsÃ£o
  function mediaIntervaloBrancos() {
    const brancos = resultados
      .map(r => horaParaMinutos(r.meio.horario))
      .sort((a,b) => a-b);
    if(brancos.length < 2) return null;

    let soma = 0;
    for(let i=1; i < brancos.length; i++) {
      soma += (brancos[i] - brancos[i-1]);
    }
    return soma / (brancos.length -1);
  }

  // PrevisÃ£o do prÃ³ximo branco baseada em mÃ©dia + padrÃµes
  function preverProximoBranco() {
    const media = mediaIntervaloBrancos();
    if(media === null) return 'Dados insuficientes para previsÃ£o.';

    const ultBrancoMin = horaParaMinutos(resultados[resultados.length -1].meio.horario);
    const previstoMin = Math.round(ultBrancoMin + media);
    return `PrÃ³ximo branco provÃ¡vel por volta das ${minutosParaHora(previstoMin)} (baseado na mÃ©dia de intervalos)`;
  }

  // AnÃ¡lise completa ao clicar no botÃ£o "Analisar"
  function analisarDados() {
    if(resultados.length === 0) {
      alert('Nenhum dado para analisar.');
      return;
    }
    const padroes = detectarPadroesBranco();
    const previsao = preverProximoBranco();

    const resultadoDiv = document.getElementById('resultado');
    let html = previsao;
    if(padroes.length) {
      html += '<br><br><strong>PadrÃµes detectados:</strong><br>' + padroes.join('<br>');
      playAlerta();
    } else {
      html += '<br><br><em>Nenhum padrÃ£o especial detectado.</em>';
    }
    resultadoDiv.innerHTML = html;
  }

  // Alerta sonoro simples
  function playAlerta() {
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioCtx.createOscillator();
    oscillator.type = 'square';
    oscillator.frequency.setValueAtTime(440, audioCtx.currentTime);
    oscillator.connect(audioCtx.destination);
    oscillator.start();
    oscillator.stop(audioCtx.currentTime + 0.7);
  }

  document.getElementById('btn-salvar').addEventListener('click', salvaResultado);
  document.getElementById('btn-analisar').addEventListener('click', analisarDados);

  atualizaCor(corEsqDiv, corEsqIndex);
  atualizaCor(corDirDiv, corDirIndex);
  atualizaLog();
</script>

</body>
</html>
