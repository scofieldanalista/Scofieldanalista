<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Scofield Analista</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fff;
      color: #000;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      margin-bottom: 20px;
    }
    .container {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }
    .pedra {
      width: 120px;
      height: 160px;
      border: 3px solid #999;
      border-radius: 12px;
      text-align: center;
      padding: 10px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .quadrado-cor {
      width: 100%;
      height: 120px;
      border-radius: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 70px;
      color: white;
    }
    .vermelho { background-color: #c0392b; }
    .preto { background-color: #000; }
    .branco {
      background-color: #ecf0f1;
      color: #000;
      position: relative;
    }
    .blaze-logo {
      width: 60px;
      height: 60px;
      margin: auto;
      background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/a/a6/Blaze_logo.svg/512px-Blaze_logo.svg.png') no-repeat center center;
      background-size: contain;
    }
    label {
      font-weight: bold;
      font-size: 14px;
      margin-top: 5px;
    }
    input[type=number], input[type=time] {
      width: 100%;
      font-size: 16px;
      padding: 4px;
      border-radius: 6px;
      border: 1.5px solid #888;
      text-align: center;
    }
    button {
      padding: 12px 30px;
      font-size: 18px;
      border: none;
      background-color: #c0392b;
      color: white;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 10px;
      margin-right: 10px;
    }
    #log {
      max-height: 260px;
      overflow-y: auto;
      width: 100%;
      max-width: 600px;
      background: #eee;
      padding: 15px;
      border-radius: 12px;
      font-size: 16px;
      margin-top: 25px;
    }
    .log-item {
      margin-bottom: 12px;
    }
    #resultado {
      margin-top: 20px;
      font-weight: bold;
      font-size: 18px;
      color: #c0392b;
      max-width: 600px;
      text-align: center;
    }
  </style>
</head>
<body>

  <h1>Scofield Analista</h1>

  <div class="container">
    <div class="pedra" id="pedra-esq">
      <div class="quadrado-cor vermelho" id="cor-esq">🔴</div>
      <label for="num-esq">Número</label>
      <input type="number" id="num-esq" min="0" max="14" />
      <label for="hora-esq">Horário</label>
      <input type="time" id="hora-esq" />
    </div>

    <div class="pedra" id="pedra-meio">
      <div class="quadrado-cor branco" id="cor-meio">
        <div class="blaze-logo"></div>
      </div>
      <label for="hora-meio">Horário Branco</label>
      <input type="time" id="hora-meio" />
    </div>

    <div class="pedra" id="pedra-dir">
      <div class="quadrado-cor vermelho" id="cor-dir">🔴</div>
      <label for="num-dir">Número</label>
      <input type="number" id="num-dir" min="0" max="14" />
      <label for="hora-dir">Horário</label>
      <input type="time" id="hora-dir" />
    </div>
  </div>

  <div>
    <button id="btn-salvar">Salvar Resultado</button>
    <button id="btn-analisar">Analisar</button>
    <button id="btn-limpar" style="background:#555;">🧼 Limpar Histórico</button>
  </div>

  <div id="resultado"></div>
  <div id="log"></div>

  <script>
    const cores = ['vermelho', 'preto'];
    const corEsqDiv = document.getElementById('cor-esq');
    const corDirDiv = document.getElementById('cor-dir');
    let corEsqIndex = 0;
    let corDirIndex = 0;

    function atualizaCor(div, index) {
      div.className = 'quadrado-cor ' + cores[index];
      div.textContent = cores[index] === 'vermelho' ? '🔴' : '⚫';
    }

    corEsqDiv.addEventListener('click', () => {
      corEsqIndex = (corEsqIndex + 1) % cores.length;
      atualizaCor(corEsqDiv, corEsqIndex);
    });

    corDirDiv.addEventListener('click', () => {
      corDirIndex = (corDirIndex + 1) % cores.length;
      atualizaCor(corDirDiv, corDirIndex);
    });

    let resultados = JSON.parse(localStorage.getItem('resultados')) || [];

    function salvaResultado() {
      const numEsq = Number(document.getElementById('num-esq').value);
      const horaEsq = document.getElementById('hora-esq').value;
      const horaMeio = document.getElementById('hora-meio').value;
      const numDir = Number(document.getElementById('num-dir').value);
      const horaDir = document.getElementById('hora-dir').value;

      if (
        isNaN(numEsq) || isNaN(numDir) ||
        !horaEsq || !horaMeio || !horaDir
      ) {
        alert('Preencha todos os campos corretamente.');
        return;
      }

      resultados.push({
        esquerda: { cor: cores[corEsqIndex], numero: numEsq, horario: horaEsq },
        meio: { cor: 'branco', horario: horaMeio },
        direita: { cor: cores[corDirIndex], numero: numDir, horario: horaDir }
      });

      localStorage.setItem('resultados', JSON.stringify(resultados));
      atualizaLog();
      limpaFormulario();
      document.getElementById('resultado').textContent = '';
    }

    function atualizaLog() {
      const logDiv = document.getElementById('log');
      if(resultados.length === 0) {
        logDiv.innerHTML = '<p>Nenhum resultado salvo.</p>';
        return;
      }
      let html = '';
      resultados.forEach((r, i) => {
        html += `<div class="log-item">
          <strong>Registro ${i+1}</strong><br>
          🟥 Esquerda: ${r.esquerda.cor} | Nº: ${r.esquerda.numero} | Hora: ${r.esquerda.horario}<br>
          ⚪ Branco: ${r.meio.horario}<br>
          ⬛ Direita: ${r.direita.cor} | Nº: ${r.direita.numero} | Hora: ${r.direita.horario}
        </div>`;
      });
      logDiv.innerHTML = html;
    }

    function limpaFormulario() {
      document.getElementById('num-esq').value = '';
      document.getElementById('hora-esq').value = '';
      document.getElementById('hora-meio').value = '';
      document.getElementById('num-dir').value = '';
      document.getElementById('hora-dir').value = '';
    }

    function horaParaMinutos(hora) {
      const [h, m] = hora.split(':').map(Number);
      return h * 60 + m;
    }

    function minutosParaHora(min) {
      const h = String(Math.floor(min / 60)).padStart(2, '0');
      const m = String(min % 60).padStart(2, '0');
      return `${h}:${m}`;
    }

    function detectarPadroesBranco() {
      const brancos = resultados.map((r, i) => ({
        index: i,
        horarioMin: horaParaMinutos(r.meio.horario)
      })).sort((a,b) => a.horarioMin - b.horarioMin);

      let padroes = [];
      for(let i=0; i < brancos.length -1; i++) {
        const diff = brancos[i+1].horarioMin - brancos[i].horarioMin;
        if(diff === 1) padroes.push(`Duplo: ${minutosParaHora(brancos[i].horarioMin)} e ${minutosParaHora(brancos[i+1].horarioMin)}`);
        else if(diff === 2) padroes.push(`Dentado: branco ${minutosParaHora(brancos[i].horarioMin)}, pedra, branco ${minutosParaHora(brancos[i+1].horarioMin)}`);
        else if(diff <= 4) padroes.push(`Banguela: branco ${minutosParaHora(brancos[i].horarioMin)} até ${minutosParaHora(brancos[i+1].horarioMin)}`);
      }
      return padroes;
    }

    function mediaIntervaloBrancos() {
      const brancos = resultados.map(r => horaParaMinutos(r.meio.horario)).sort((a,b) => a-b);
      if(brancos.length < 2) return null;
      let soma = 0;
      for(let i=1; i < brancos.length; i++) {
        soma += brancos[i] - brancos[i-1];
      }
      return soma / (brancos.length -1);
    }

    function preverProximoBranco() {
      const media = mediaIntervaloBrancos();
      if(media === null) return 'Dados insuficientes.';
      const ultBranco = horaParaMinutos(resultados[resultados.length -1].meio.horario);
      const previsto = Math.round(ultBranco + media);
      return `Próximo branco provável por volta das ${minutosParaHora(previsto)}`;
    }

    function playAlerta() {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = ctx.createOscillator();
      osc.type = 'square';
      osc.frequency.setValueAtTime(440, ctx.currentTime);
      osc.connect(ctx.destination);
      osc.start();
      osc.stop(ctx.currentTime + 0.7);
    }

    function analisarDados() {
      if(resultados.length === 0) {
        alert('Nenhum dado para analisar.');
        return;
      }

      const padroes = detectarPadroesBranco();
      const previsao = preverProximoBranco();
      const resultadoDiv = document.getElementById('resultado');

      let horaAlvo = previsao.match(/\d{2}:\d{2}/);
      let frase = horaAlvo
        ? `🕓 PRÓXIMO BRANCO PROVÁVEL EM ${horaAlvo[0]} — PREPARA!`
        : previsao;

      let html = `<div style="font-size: 20px; color: #d63031; margin-bottom: 10px;">${frase}</div>`;
      if(padroes.length) {
        html += '<strong>Padrões detectados:</strong><br>' + padroes.join('<br>');
        playAlerta();
      } else {
        html += '<br><em>Nenhum padrão especial detectado.</em>';
      }

      resultadoDiv.innerHTML = html;
    }

    document.getElementById('btn-salvar').addEventListener('click', salvaResultado);
    document.getElementById('btn-analisar').addEventListener('click', analisarDados);
    document.getElementById('btn-limpar').addEventListener('click', () => {
      if(confirm("Tem certeza que quer apagar tudo?")) {
        resultados = [];
        localStorage.removeItem('resultados');
        atualizaLog();
        document.getElementById('resultado').textContent = '';
      }
    });

    atualizaCor(corEsqDiv, corEsqIndex);
    atualizaCor(corDirDiv, corDirIndex);
    atualizaLog();
  </script>
</body>
</html>
