<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scofield Analista V4 - IA Aprimorada</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #f2f2f2;
      padding: 20px;
      text-align: center;
      min-height: 100vh;
      margin: 0;
    }
    h1 {
      color: #00ffcc;
      margin-bottom: 10px;
    }
    .input-group {
      margin: 15px auto;
      max-width: 450px;
      text-align: left;
    }
    textarea {
      width: 100%;
      height: 120px;
      border-radius: 8px;
      border: none;
      padding: 10px;
      font-size: 14px;
      resize: vertical;
      font-family: monospace;
      background: #222;
      color: #eee;
    }
    input[type="text"] {
      width: 100%;
      padding: 8px;
      margin-top: 8px;
      border-radius: 6px;
      border: none;
      font-size: 14px;
      background: #222;
      color: #eee;
      font-family: monospace;
    }
    button {
      cursor: pointer;
      background: #00ffcc;
      border: none;
      padding: 10px 18px;
      margin: 10px 5px 0 0;
      border-radius: 6px;
      font-weight: bold;
      color: #000;
      font-size: 15px;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #00bfa5;
      color: #fff;
    }
    .block-container {
      display: flex;
      justify-content: center;
      margin: 20px 0;
      gap: 15px;
    }
    .block {
      width: 80px;
      height: 80px;
      border-radius: 10px;
      font-weight: bold;
      font-size: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #111;
      user-select: none;
      box-shadow: 0 0 6px rgba(0,0,0,0.4);
    }
    .vermelho { background: #e53935; color: #fff; }
    .preto { background: #212121; color: #fff; }
    .branco { background: #fff; color: #111; }
    #resultado {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
      min-height: 40px;
      max-width: 450px;
      margin-left: auto;
      margin-right: auto;
      padding: 10px;
      background: #222;
      border-radius: 8px;
      color: #00ffcc;
    }
    #estrategiasSalvas {
      max-width: 450px;
      margin: 20px auto 0 auto;
      text-align: left;
      background: #222;
      padding: 12px 15px;
      border-radius: 8px;
      font-size: 14px;
      max-height: 180px;
      overflow-y: auto;
      color: #ccc;
    }
  </style>
</head>
<body>
  <h1>üîç Scofield Analista V4</h1>

  <div class="input-group">
    <label for="historico"><b>Cole o hist√≥rico da Blaze (com hor√°rios e n√∫meros):</b></label>
    <textarea id="historico" placeholder="Exemplo:\n1\n00:00:05\n...\n(aceita v√°rios formatos)"></textarea>
    <button onclick="analisarHistorico()">Analisar Hist√≥rico</button>
    <button onclick="limparHistorico()">Limpar Hist√≥rico</button>
  </div>

  <h2>Informe um padr√£o manual</h2>
  <div class="block-container">
    <div id="blocoAnterior" class="block branco">?</div>
    <div class="block branco" style="font-size: 32px;">üé≤</div>
    <div id="blocoPosterior" class="block branco">?</div>
  </div>

  <div class="input-group">
    <input id="anterior" type="text" placeholder="N√∫mero anterior / hor√°rio (HH:MM:SS)" />
    <input id="posterior" type="text" placeholder="N√∫mero posterior / hor√°rio (HH:MM:SS)" />
    <input id="branco" type="text" placeholder="Hor√°rio do branco (HH:MM:SS)" />
    <button onclick="analisarPadrao()">Analisar padr√£o</button>
  </div>

  <div>
    <button onclick="registrarResultado(true)">‚úÖ Acertou</button>
    <button onclick="registrarResultado(false)">‚ùå Errou</button>
  </div>

  <div id="resultado"></div>

  <div id="estrategiasSalvas" style="display:none;">
    <h3>Estrat√©gias Salvas:</h3>
    <ul id="listaEstrategias"></ul>
  </div>

<script>
  // --- VARI√ÅVEIS GLOBAIS ---
  let estrategias = [];
  let pesoMaximo = 10;
  let pesoMinimo = 0;
  let ultimaAnalise = null;

  // --- FUN√á√ÉO PARA DEFINIR COR DA PEDRA ---
  function corDaPedra(numero) {
    if (!numero || isNaN(numero)) return 'branco';
    numero = parseInt(numero);
    if (numero >= 1 && numero <= 7) return 'vermelho';
    if (numero >= 8 && numero <= 14) return 'preto';
    return 'branco';
  }

  // Atualiza os blocos de cor conforme n√∫meros manuais
  function atualizarBlocos() {
    const anterior = document.getElementById("anterior").value.split('/')[0];
    const posterior = document.getElementById("posterior").value.split('/')[0];
    document.getElementById("blocoAnterior").className = "block " + corDaPedra(anterior);
    document.getElementById("blocoAnterior").textContent = anterior || "?";
    document.getElementById("blocoPosterior").className = "block " + corDaPedra(posterior);
    document.getElementById("blocoPosterior").textContent = posterior || "?";
  }
  document.getElementById("anterior").addEventListener("input", atualizarBlocos);
  document.getElementById("posterior").addEventListener("input", atualizarBlocos);

  // --- FUN√á√ÉO PARA PARSE DE HOR√ÅRIO EM SEGUNDOS ---
  function horarioParaSegundos(horario) {
    if(!horario) return null;
    const partes = horario.split(":").map(Number);
    if(partes.length !== 3) return null;
    return partes[0]*3600 + partes[1]*60 + partes[2];
  }

  // --- FUN√á√ÉO PARA AN√ÅLISE DO HIST√ìRICO ---
  function analisarHistorico() {
    const texto = document.getElementById("historico").value.trim();
    if(!texto) {
      alert("Cole o hist√≥rico antes de analisar.");
      return;
    }
    const linhas = texto.split('\n');
    let registros = [];

    // Tentar detectar formatos e extrair n√∫mero e hor√°rio
    for(let i=0; i<linhas.length; i++) {
      let linha = linhas[i].trim();
      if(!linha) continue;

      let numero = null;
      let horario = null;

      // Caso formato linha n√∫mero, pr√≥xima linha hor√°rio
      if(i+1 < linhas.length && linhas[i+1].match(/\\d{2}:\\d{2}:\\d{2}/)) {
        numero = linha.match(/\\d+/) ? linha.match(/\\d+/)[0] : null;
        horario = linhas[i+1].trim();
        i++; // pular pr√≥xima linha que √© hor√°rio
      } else if(linha.match(/\\d+\\s+\\d+\\s+\\d{2}:\\d{2}:\\d{2}/)) {
        // Formato 3 colunas
        let partes = linha.split(/\s+/);
        numero = partes[1];
        horario = partes[2];
      } else if(linha.match(/\\d{2}:\\d{2}:\\d{2}/)) {
        // Linha s√≥ hor√°rio - branco
        horario = linha;
        numero = null;
      } else {
        // Tentar s√≥ n√∫mero
        numero = linha.match(/\\d+/) ? linha.match(/\\d+/)[0] : null;
        horario = null;
      }
      registros.push({
        numero,
        horario,
        cor: corDaPedra(numero),
        segundos: horarioParaSegundos(horario)
      });
    }

    gerarEstrategias(registros);
    document.getElementById("resultado").style.color = "#00ffcc";
    document.getElementById("resultado").textContent = "‚úÖ Hist√≥rico analisado com sucesso!";
    mostrarEstrategias();
    ultimaAnalise = registros;
  }

  // --- FUN√á√ÉO QUE GERA ESTRAT√âGIAS A PARTIR DO HIST√ìRICO ---
  function gerarEstrategias(registros) {
    // Resetar
    estrategias = [];

    // Para cada branco detectado, gerar estrat√©gia baseada em soma e intervalo e hor√°rio
    for(let i=1; i < registros.length - 1; i++) {
      if(registros[i].cor === 'branco' && registros[i].segundos !== null) {
        let anterior = registros[i-1];
        let posterior = registros[i+1];
        if(anterior && posterior && anterior.segundos !== null && posterior.segundos !== null) {
          let soma = (parseInt(anterior.numero)||0) + (parseInt(posterior.numero)||0);
          let intervalo = Math.abs(registros[i].segundos - anterior.segundos);
          let horario = registros[i].segundos;
          let faixa = faixaHoraria(horario);

          // Verificar se j√° existe estrat√©gia parecida
          let existente = estrategias.find(e => 
            e.soma === soma &&
            Math.abs(e.intervalo - intervalo) <= 5 &&
            e.faixa === faixa
          );
          if(existente) {
            // Atualizar pesos, acertos, erros
            existente.peso = Math.min(pesoMaximo, existente.peso + 0.1);
            existente.contagem++;
          } else {
            estrategias.push({
              soma,
              intervalo,
              horario,
              peso: 3, // peso inicial m√©dio
              contagem: 1,
              acertos: 0,
              erros: 0,
              faixa
            });
          }
        }
      }
    }
  }

  // --- FAIXA HOR√ÅRIA PARA ANALISE ---
  function faixaHoraria(segundos) {
    if(segundos === null) return "desconhecido";
    let h = Math.floor(segundos/3600);
    if(h < 12) return "manh√£";
    else if(h < 18) return "tarde";
    else return "noite";
  }

  // --- FUN√á√ÉO PARA ANALISAR PADR√ÉO MANUAL ---
  function analisarPadrao() {
    const anteriorRaw = document.getElementById("anterior").value.trim();
    const posteriorRaw = document.getElementById("posterior").value.trim();
    const brancoRaw = document.getElementById("branco").value.trim();

    if(!anteriorRaw || !posteriorRaw || !brancoRaw) {
      alert("Preencha todos os campos corretamente.");
      return;
    }

    const anteriorParts = anteriorRaw.split('/');
    const posteriorParts = posteriorRaw.split('/');

    if(anteriorParts.length !== 2 || posteriorParts.length !== 2) {
      alert("Preencha n√∫mero e hor√°rio separados por /, ex: 5/00:01:15");
      return;
    }

    const numAnterior = parseInt(anteriorParts[0]);
    const horaAnterior = anteriorParts[1];
    const numPosterior = parseInt(posteriorParts[0]);
    const horaPosterior = posteriorParts[1];
    const horaBranco = brancoRaw;

    if(isNaN(numAnterior) || isNaN(numPosterior)) {
      alert("N√∫meros anteriores e posteriores inv√°lidos.");
      return;
    }

    const somaAtual = numAnterior + numPosterior;
    const intervaloAtual = Math.abs(horarioParaSegundos(horaBranco) - horarioParaSegundos(horaAnterior));
    const faixaAtual = faixaHoraria(horarioParaSegundos(horaBranco));

    // Buscar estrat√©gias similares
    let encontradas = estrategias.filter(e => 
      e.soma === somaAtual &&
      Math.abs(e.intervalo - intervaloAtual) <= 5 &&
      e.faixa === faixaAtual
    );

    if(encontradas.length === 0) {
      document.getElementById("resultado").style.color = "#ffbb33";
      document.getElementById("resultado").textContent = "‚ö†Ô∏è Nenhum padr√£o exato encontrado. Aguardar novo hist√≥rico.";
      ultimaAnalise = null;
      return;
    }

    // Calcular peso m√©dio e mostrar resultado
    let pesoTotal = 0;
    encontradas.forEach(e => pesoTotal += e.peso);
    let pesoMedio = pesoTotal / encontradas.length;

    let texto = `üìå Padr√£o identificado! Peso m√©dio: ${pesoMedio.toFixed(2)}. `;

    if(pesoMedio >= 4) texto += "üí™ Sinal forte para branco!";
    else if(pesoMedio >= 2) texto += "‚ö†Ô∏è Sinal m√©dio, aposte com cautela.";
    else texto += "‚ùó Sinal arriscado, prefira aguardar.";

    document.getElementById("resultado").style.color = pesoMedio >= 4 ? "#00ff00" : pesoMedio >= 2 ? "#ffbb33" : "#ff4444";
    document.getElementById("resultado").textContent = texto;
    ultimaAnalise = encontradas;
  }

  // --- FUN√á√ÉO PARA REGISTRAR FEEDBACK ACERTO/ERRO ---
  function registrarResultado(acertou) {
    if(!ultimaAnalise || ultimaAnalise.length === 0) {
      alert("N√£o h√° an√°lise atual para registrar resultado.");
      return;
    }

    ultimaAnalise.forEach(e => {
      if(acertou) {
        e.acertos++;
        e.peso = Math.min(pesoMaximo, e.peso + 0.5);
      } else {
        e.erros++;
        e.peso = Math.max(pesoMinimo, e.peso - 0.7);
      }
    });

    mostrarEstrategias();

    alert(acertou ? "‚úÖ Resultado registrado como ACERTO!" : "‚ùå Resultado registrado como ERRO.");
  }

  // --- FUN√á√ÉO PARA LIMPAR HIST√ìRICO ---
  function limparHistorico() {
    if(confirm("Deseja realmente limpar todo o hist√≥rico e estrat√©gias salvas?")) {
      document.getElementById("historico").value = "";
      document.getElementById("resultado").textContent = "";
      estrategias = [];
      ultimaAnalise = null;
      document.getElementById("estrategiasSalvas").style.display = "none";
      document.getElementById("listaEstrategias").innerHTML = "";
      document.getElementById("blocoAnterior").className = "block branco";
      document.getElementById("blocoAnterior").textContent = "?";
      document.getElementById("blocoPosterior").className = "block branco";
      document.getElementById("blocoPosterior").textContent = "?";
    }
  }

  // --- FUN√á√ÉO PARA EXIBIR ESTRAT√âGIAS SALVAS ---
  function mostrarEstrategias() {
    if(estrategias.length === 0) {
      document.getElementById("estrategiasSalvas").style.display = "none";
      document.getElementById("listaEstrategias").innerHTML = "";
      return;
    }

    document.getElementById("estrategiasSalvas").style.display = "block";

    let html = estrategias
      .sort((a,b) => b.peso - a.peso)
      .map(e => {
        let eficiencia = e.acertos + e.erros > 0 ? Math.round(100 * e.acertos / (e.acertos + e.erros)) : 0;
        return `<li>
          Soma: <b>${e.soma}</b>, Intervalo: <b>${e.intervalo}s</b>, Faixa: <b>${e.faixa}</b>, Peso: <b>${e.peso.toFixed(2)}</b><br>
          Acertos: ${e.acertos} | Erros: ${e.erros} | Efici√™ncia: ${eficiencia}%
        </li>`;
      }).join("");

    document.getElementById("listaEstrategias").innerHTML = html;
  }
</script>
</body>
</html>
