<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scofield Analista V3 PRO ‚ö™</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: 'Segoe UI', sans-serif;
      padding: 15px;
    }
    h1 {
      text-align: center;
      color: #ff4747;
    }
    textarea,
    input,
    button {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      box-sizing: border-box;
    }
    textarea,
    input {
      background: #222;
      color: #eee;
      border: 1px solid #555;
    }
    button {
      background: #ff4747;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background: #e53e3e;
    }
    .secao {
      margin-top: 25px;
    }
    .sinal {
      background: #222;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
    }
    .sinal button {
      width: 48%;
      margin: 2px 1%;
      font-weight: bold;
    }
    .estatisticas {
      white-space: pre-line;
      background: #222;
      padding: 10px;
      border-radius: 5px;
      margin-top: 15px;
      font-size: 1em;
    }
    #avisoRecChuva {
      background: #440000;
      color: #ff5555;
      padding: 10px;
      text-align: center;
      border-radius: 5px;
      font-weight: bold;
      margin-bottom: 15px;
    }
    #proximaPrevisao {
      background: #330000;
      color: #ff4747;
      padding: 10px;
      text-align: center;
      border-radius: 5px;
      font-weight: bold;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <h1>Scofield Analista V3 PRO ‚ö™</h1>

  <div id="proximaPrevisao">Pr√≥xima previs√£o forte: --:--:--</div>
  <div id="avisoRecChuva"></div>

  <div class="secao">
    <h3>üß† Hist√≥rico C√©rebro</h3>
    <textarea id="historicoCerebro" rows="8" placeholder="Cole aqui o hist√≥rico completo com hor√°rios, n√∫meros e cores..."></textarea>
    <button onclick="enviarCerebro()">üì§ Enviar Hist√≥rico</button>
    <div id="mensagemCerebro" style="color:#8f8; margin-top:6px;"></div>
    <div>Estrat√©gias criadas: <span id="numEstrategias">0</span></div>
  </div>

  <div class="secao">
    <h3>‚è±Ô∏è Come√ßar An√°lise</h3>
    <textarea id="historicoAtual" rows="6" placeholder="Cole aqui as √∫ltimas jogadas para prever os brancos..."></textarea>
    <button onclick="analisarAgora()">üîç Analisar</button>
    <div id="previsoes"></div>
    <button onclick="mostrarMinutosQuentes()" style="margin-top:10px;">üìà Ver Minutos Quentes</button>
    <div id="minutosQuentes" style="margin-top:10px; background:#222; padding:10px; border-radius:5px; max-height:150px; overflow:auto;"></div>
  </div>

  <div class="secao">
    <h3>üìä Estat√≠sticas</h3>
    <div id="estatisticas" class="estatisticas">Nenhuma estat√≠stica registrada.</div>
    <button onclick="limparEstatisticas()">üßπ Limpar Estat√≠sticas</button>
  </div>

  <div class="secao">
    <h3>üßπ Limpar Hist√≥rico</h3>
    <button onclick="limparHistorico()">üßº Limpar Campos de Hist√≥rico</button>
    <div id="mensagemHistorico" style="margin-top:10px;color:#8f8;"></div>
  </div>

  <script>
// Cores
const VERMELHAS = new Set(['1','2','3','4','5','6','7']);
const PRETAS = new Set(['8','9','10','11','12','13','14']);

// Dados persistentes
let estrategias = JSON.parse(localStorage.getItem("estrategias") || "[]");
let estatisticas = JSON.parse(localStorage.getItem("estatisticas") || "[]");
let historicosMemorizados = JSON.parse(localStorage.getItem("historicosMemorizados") || "[]");

// Atualiza contagem de estrat√©gias
function atualizarContadorEstrategias() {
  document.getElementById("numEstrategias").innerText = estrategias.length;
}

// Atualiza estat√≠sticas
function atualizarEstatisticas() {
  const div = document.getElementById("estatisticas");
  if (estatisticas.length === 0) {
    div.innerText = "Nenhuma estat√≠stica registrada.";
    return;
  }
  let linhas = estatisticas.map(e => {
    let status = e.acerto ? "‚úÖ" : "‚ùå";
    let d = new Date(e.data);
    return `${e.horario} ${status} - ${d.toLocaleString()}`;
  });
  div.innerText = linhas.join('\n');
}

// Salva no localStorage
function salvarDados() {
  localStorage.setItem("estrategias", JSON.stringify(estrategias));
  localStorage.setItem("estatisticas", JSON.stringify(estatisticas));
  localStorage.setItem("historicosMemorizados", JSON.stringify(historicosMemorizados));
  atualizarEstatisticas();
  atualizarContadorEstrategias();
}

// Parseia hist√≥rico para [{num, hora, cor}]
function parsearHistorico(texto) {
  let linhas = texto.trim().split(/\r?\n/).map(l => l.trim()).filter(l => l !== '');
  let resultado = [];
  for (let i = 0; i < linhas.length;) {
    let num = linhas[i];
    let proxLinha = linhas[i + 1] || '';
    if (/^\d{2}:\d{2}:\d{2}$/.test(proxLinha)) {
      let cor = 'branco';
      if (num === '0' || num === '') {
        cor = 'branco';
        num = null;
      } else if (VERMELHAS.has(num)) {
        cor = 'vermelha';
      } else if (PRETAS.has(num)) {
        cor = 'preta';
      } else {
        cor = 'desconhecida';
      }
      resultado.push({ num: num, hora: proxLinha, cor: cor });
      i += 2;
    } else {
      i++;
    }
  }
  return resultado;
}

// Cria nova estrat√©gia a partir de hist√≥rico parseado
function criarOuAtualizarEstrategias(historico) {
  let horariosBranco = historico.filter(e => e.cor === 'branco').map(e => e.hora);
  if (horariosBranco.length === 0) return 0;

  let nova = {
    id: Date.now(),
    horariosBrancos: horariosBranco,
    criadoEm: Date.now(),
    peso: 1
  };

  let existe = estrategias.some(est => {
    return JSON.stringify(est.horariosBrancos) === JSON.stringify(nova.horariosBrancos);
  });

  if (!existe) {
    estrategias.push(nova);
    return 1;
  }

  return 0;
}
// Enviar hist√≥rico para criar estrat√©gias
function enviarCerebro() {
  const texto = document.getElementById("historicoCerebro").value;
  if (texto.trim().length < 10) {
    alert("Hist√≥rico muito curto.");
    return;
  }
  const parseado = parsearHistorico(texto);
  if (parseado.length === 0) {
    alert("N√£o foi poss√≠vel interpretar o hist√≥rico.");
    return;
  }

  historicosMemorizados.push({
    data: Date.now(),
    itens: parseado
  });

  const criadas = criarOuAtualizarEstrategias(parseado);
  document.getElementById("mensagemCerebro").innerText = `‚úÖ Hist√≥rico enviado! ${criadas} estrat√©gia(s) criada(s).`;

  salvarDados();
}

// Verifica se dois hor√°rios est√£o pr√≥ximos (toler√¢ncia em segundos)
function estaProximo(hora1, hora2, segundos = 60) {
  let [h1, m1, s1] = hora1.split(':').map(Number);
  let [h2, m2, s2] = hora2.split(':').map(Number);
  let t1 = h1 * 3600 + m1 * 60 + s1;
  let t2 = h2 * 3600 + m2 * 60 + s2;
  return Math.abs(t1 - t2) <= segundos;
}

// Fun√ß√£o principal de an√°lise
function analisarAgora() {
  const textoAtual = document.getElementById("historicoAtual").value;
  if (textoAtual.trim().length < 5) {
    alert("Cole as √∫ltimas jogadas para analisar.");
    return;
  }
  const parseadoAtual = parsearHistorico(textoAtual);
  if (parseadoAtual.length === 0) {
    alert("N√£o foi poss√≠vel interpretar o hist√≥rico atual.");
    return;
  }

  let estrategiasCompativeis = estrategias.filter(est => {
    return est.horariosBrancos.some(hb => {
      return parseadoAtual.some(item => item.cor === 'branco' && estaProximo(hb, item.hora, 60));
    });
  });

  let previsoes = [];
  let avisoRecChuva = "";

  if (estrategiasCompativeis.length === 0) {
    avisoRecChuva = "üîç Nenhum padr√£o detectado. Previs√£o simples.";
    let agora = new Date();
    for (let i = 1; i <= 3; i++) {
      let novaHora = new Date(agora.getTime() + i * 60000);
      let h = novaHora.getHours().toString().padStart(2, '0');
      let m = novaHora.getMinutes().toString().padStart(2, '0');
      let s = novaHora.getSeconds().toString().padStart(2, '0');
      previsoes.push({ horario: `${h}:${m}:${s}`, nivel: i === 1 ? "Forte" : i === 2 ? "Moderado" : "Arriscado" });
    }
  } else {
    estrategiasCompativeis.sort((a, b) => b.peso - a.peso);
    let melhor = estrategiasCompativeis[0];

    let agoraSegundos = (() => {
      let d = new Date();
      return d.getHours() * 3600 + d.getMinutes() * 60 + d.getSeconds();
    })();

    previsoes = melhor.horariosBrancos.filter(hb => {
      let [h, m, s] = hb.split(':').map(Number);
      let seg = h * 3600 + m * 60 + s;
      return seg >= agoraSegundos;
    }).map(hb => ({ horario: hb, nivel: "Forte" }));

    avisoRecChuva = detectarRecOuChuva(parseadoAtual, melhor);
  }

  mostrarPrevisoes(previsoes, avisoRecChuva);
}
  // Mostrar as previs√µes no DOM
  function mostrarPrevisoes(previsoes, avisoRecChuva){
    const div = document.getElementById("previsoes");
    div.innerHTML = "<h4>üü¢ Brancos Prov√°veis:</h4>";
    previsoes.forEach(p => {
      let linha = document.createElement("div");
      linha.style.marginBottom = "5px";

      linha.innerHTML = `
        ${p.horario} (${p.nivel})
        <button onclick="registrarAcerto('${p.horario}')">‚úÖ Acertou</button>
        <button onclick="registrarErro('${p.horario}')">‚ùå Errou</button>
      `;
      div.appendChild(linha);
    });

    // Atualiza o aviso autom√°tico do pr√≥ximo forte no topo
    if(previsoes.length > 0){
      document.getElementById("proximaPrevisao").innerText = `Pr√≥xima previs√£o forte: ${previsoes[0].horario}`;
    } else {
      document.getElementById("proximaPrevisao").innerText = "Pr√≥xima previs√£o forte: --:--:--";
    }

    // Aviso REC/CHUVA
    document.getElementById("avisoRecChuva").innerText = avisoRecChuva || "";
  }

  // Registrar acerto para a estrat√©gia associada ao hor√°rio
  function registrarAcerto(horario){
    estatisticas.push({ horario: horario, acerto: true, data: Date.now() });
    ajustarPesoEstrategia(horario, true);
    salvarDados();
    atualizarEstatisticas();
  }

  // Registrar erro para a estrat√©gia associada ao hor√°rio
  function registrarErro(horario){
    estatisticas.push({ horario: horario, acerto: false, data: Date.now() });
    ajustarPesoEstrategia(horario, false);
    salvarDados();
    atualizarEstatisticas();
  }

  // Ajusta o peso da estrat√©gia que cont√©m o hor√°rio
  function ajustarPesoEstrategia(horario, acertou){
    estrategias.forEach(est => {
      if(est.horariosBrancos.includes(horario)){
        if(acertou) est.peso += 1;
        else est.peso = Math.max(1, est.peso - 1);
      }
    });
  }

  // Atualiza as estat√≠sticas na tela
  function atualizarEstatisticas(){
    const div = document.getElementById("estatisticas");
    if(estatisticas.length === 0){
      div.innerText = "Nenhuma estat√≠stica registrada.";
      return;
    }
    let linhas = estatisticas.map(e => {
      let status = e.acerto ? "‚úÖ" : "‚ùå";
      let d = new Date(e.data);
      let dataStr = d.toLocaleString();
      return `${e.horario} ${status} - ${dataStr}`;
    });
    div.innerText = linhas.join('\n');
  }

  // Limpar estat√≠sticas
  function limparEstatisticas(){
    estatisticas = [];
    salvarDados();
    atualizarEstatisticas();
  }

  // Limpar campos de hist√≥rico e mensagens
  function limparHistorico(){
    document.getElementById("historicoCerebro").value = "";
    document.getElementById("historicoAtual").value = "";
    document.getElementById("mensagemCerebro").innerText = "";
    document.getElementById("mensagemHistorico").innerText = "‚úÖ Campos de hist√≥rico limpos!";
    document.getElementById("previsoes").innerHTML = "";
    document.getElementById("avisoRecChuva").innerText = "";
    document.getElementById("proximaPrevisao").innerText = "Pr√≥xima previs√£o forte: --:--:--";
  }
