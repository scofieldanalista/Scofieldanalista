<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Scofield Analista - Previsão Branco Blaze</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #eee;
    margin: 0; padding: 0;
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh;
  }
  h1 {
    margin: 15px 0;
    font-weight: 900;
    text-align: center;
    color: #eaeaea;
    text-shadow: 0 0 10px #f44336;
  }
  .pedras-container {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 20px;
  }
  .pedra-box {
    width: 100px;
    height: 100px;
    border-radius: 10px;
    position: relative;
    box-shadow: 0 0 15px #000;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    font-size: 2.3rem;
    user-select: none;
  }
  .pedra-vermelha {
    background: #b71c1c;
    box-shadow: 0 0 20px #ff5252;
    border: 3px solid #ff1744;
  }
  .pedra-preta {
    background: #222;
    box-shadow: 0 0 20px #444;
    border: 3px solid #555;
  }
  .pedra-branco {
    background: #fff;
    box-shadow: 0 0 20px #ccc;
    border: 3px solid #999;
    color: #111;
    font-size: 1.4rem;
    text-align: center;
    padding: 10px;
    line-height: 1.2;
  }
  .pedra-branco .frase {
    font-weight: 700;
    font-family: 'Courier New', Courier, monospace;
    font-size: 1rem;
  }
  .inputs-container {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 30px;
  }
  .input-group {
    width: 100px;
    display: flex;
    flex-direction: column;
  }
  label {
    font-size: 0.85rem;
    margin-bottom: 4px;
  }
  input[type="text"], input[type="time"], input[type="number"] {
    padding: 6px 8px;
    border-radius: 5px;
    border: none;
    font-size: 1rem;
    text-align: center;
    outline: none;
    box-shadow: inset 0 0 5px #000;
  }
  input[type="time"]::-webkit-inner-spin-button,
  input[type="time"]::-webkit-calendar-picker-indicator {
    display: none;
    -webkit-appearance: none;
  }
  button {
    margin: 5px 10px;
    background: #f44336;
    border: none;
    border-radius: 6px;
    color: #fff;
    font-weight: 700;
    padding: 10px 15px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background: #d32f2f;
  }
  #msg-previsao {
    margin-top: 15px;
    font-size: 1.2rem;
    font-weight: 700;
    color: #ff3d00;
    text-align: center;
    text-shadow: 0 0 8px #ff3d00;
  }
  #historico-textarea {
    width: 90vw;
    max-width: 600px;
    height: 180px;
    border-radius: 8px;
    padding: 10px;
    font-family: monospace;
    font-size: 0.9rem;
    margin-bottom: 10px;
    resize: vertical;
  }
  #btn-limpar {
    background: #555;
    margin-left: 10px;
  }
  footer {
    margin-top: auto;
    padding: 15px;
    font-size: 0.8rem;
    color: #777;
  }
</style>
</head>
<body>

<h1>Scofield Analista - Previsão Branco Blaze</h1>

<div class="pedras-container">
  <div class="pedra-box pedra-vermelha" title="Pedra Vermelha">V</div>
  <div class="pedra-box pedra-branco" title="Pedra Branco">
    <div class="frase">"A paciência é a chave do sucesso."</div>
  </div>
  <div class="pedra-box pedra-preta" title="Pedra Preta">P</div>
</div>

<div class="inputs-container">
  <div class="input-group">
    <label for="num-vermelha">Número Vermelha</label>
    <input type="number" id="num-vermelha" min="1" max="14" placeholder="Ex: 5" />
    <label for="hora-vermelha">Hora (HH:MM:SS)</label>
    <input type="text" id="hora-vermelha" placeholder="20:16:30" pattern="^\d{2}:\d{2}:\d{2}$" />
  </div>
  <div class="input-group">
    <label for="hora-branco">Hora Branco (HH:MM:SS)</label>
    <input type="text" id="hora-branco" placeholder="20:17:00" pattern="^\d{2}:\d{2}:\d{2}$" />
  </div>
  <div class="input-group">
    <label for="num-preta">Número Preta</label>
    <input type="number" id="num-preta" min="1" max="14" placeholder="Ex: 10" />
    <label for="hora-preta">Hora (HH:MM:SS)</label>
    <input type="text" id="hora-preta" placeholder="20:17:30" pattern="^\d{2}:\d{2}:\d{2}$" />
  </div>
</div>

<div style="text-align:center; margin-bottom: 25px;">
  <button id="btn-add-historico">Adicionar ao Histórico</button>
  <button id="btn-limpar">Limpar Histórico</button>
</div>

<textarea id="historico-textarea" placeholder="Cole aqui o histórico completo (horário + pedra)."></textarea>
<br />
<button id="btn-carregar-historico">Carregar Histórico</button>

<div id="msg-previsao"></div>

<div style="text-align:center; margin-top: 20px;">
  <button id="btn-acertou">Acertou</button>
  <button id="btn-errou">Errou</button>
</div>

<audio id="alert-sound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>

<footer>
  Desenvolvido por Scofield Analista - Use com responsabilidade
</footer>

<script>
  // Tabela de pedras para cores fixas conforme combinado
  const pedrasVermelhas = new Set([1,2,3,4,5,6,7]);
  const pedrasPretas = new Set([8,9,11,12,13,14]);
  
  // Histórico armazenado em localStorage (array de objetos: {hora, pedra, cor})
  let historico = JSON.parse(localStorage.getItem('historicoScofield')) || [];
  // Aprendizado simples, guarda acertos/erros de previsões
  let aprendizado = JSON.parse(localStorage.getItem('aprendizadoScofield')) || {acertos: 0, erros: 0};

  // Referências DOM
  const txtHistorico = document.getElementById('historico-textarea');
  const msgPrevisao = document.getElementById('msg-previsao');
  const alertSound = document.getElementById('alert-sound');

  function salvarHistorico() {
    localStorage.setItem('historicoScofield', JSON.stringify(historico));
  }
  function salvarAprendizado() {
    localStorage.setItem('aprendizadoScofield', JSON.stringify(aprendizado));
  }

  function parseHoraToSeconds(horaStr) {
    // Espera formato HH:MM:SS
    const parts = horaStr.split(':');
    if(parts.length !== 3) return null;
    const [h,m,s] = parts.map(Number);
    if(isNaN(h)||isNaN(m)||isNaN(s)) return null;
    return h*3600 + m*60 + s;
  }

  function secondsToHora(sec) {
    const h = Math.floor(sec/3600).toString().padStart(2,'0');
    const m = Math.floor((sec%3600)/60).toString().padStart(2,'0');
    const s = Math.floor(sec%60).toString().padStart(2,'0');
    return `${h}:${m}:${s}`;
  }

  // Função para identificar cor da pedra pelo número
  function identificarCor(pedraNum) {
    if(pedraNum === null || pedraNum === undefined || pedraNum === '') return 'branco';
    const num = Number(pedraNum);
    if(pedrasVermelhas.has(num)) return 'vermelha';
    if(pedrasPretas.has(num)) return 'preta';
    return 'desconhecida';
  }

  // Função para adicionar entrada manual ao histórico
  document.getElementById('btn-add-historico').onclick = () => {
    const numV = document.getElementById('num-vermelha').value.trim();
    const horaV = document.getElementById('hora-vermelha').value.trim();
    const horaB = document.getElementById('hora-branco').value.trim();
    const numP = document.getElementById('num-preta').value.trim();
    const horaP = document.getElementById('hora-preta').value.trim();

    if(!horaV.match(/^\d{2}:\d{2}:\d{2}$/) || !horaB.match(/^\d{2}:\d{2}:\d{2}$/) || !horaP.match(/^\d{2}:\d{2}:\d{2}$/)) {
      alert('Digite horários válidos no formato HH:MM:SS.');
      return;
    }

    // Adiciona vermelha
    historico.push({
      hora: horaV,
      pedra: numV || null,
      cor: identificarCor(numV)
    });
    // Branco
    historico.push({
      hora: horaB,
      pedra: null,
      cor: 'branco'
    });
    // Preta
    historico.push({
      hora: horaP,
      pedra: numP || null,
      cor: identificarCor(numP)
    });

    salvarHistorico();
    carregarHistoricoNaTextarea();
    limparInputs();
    analisarPrevisao();
  };

  function limparInputs() {
    document.getElementById('num-vermelha').value = '';
    document.getElementById('hora-vermelha').value = '';
    document.getElementById('hora-branco').value = '';
    document.getElementById('num-preta').value = '';
    document.getElementById('hora-preta').value = '';
  }

  // Função para limpar histórico
  document.getElementById('btn-limpar').onclick = () => {
    if(confirm('Tem certeza que deseja limpar o histórico?')) {
      historico = [];
      salvarHistorico();
      carregarHistoricoNaTextarea();
      msgPrevisao.textContent = '';
    }
  };

  // Carregar histórico da textarea para a variável
  document.getElementById('btn-carregar-historico').onclick = () => {
    const texto = txtHistorico.value.trim();
    if(!texto) {
      alert('Cole o histórico antes de carregar.');
      return;
    }
    const linhas = texto.split('\n').map(l => l.trim()).filter(l => l !== '');
    // Espera pares linha: horário ou número, alternados
    let novoHistorico = [];
    for(let i=0; i < linhas.length; i++) {
      const linha = linhas[i];
      // Detecta se é horário ou número (numérico ou vazio para branco)
      if(linha.match(/^\d{2}:\d{2}:\d{2}$/)) {
        // Horário - verificar próxima linha para pedra
        if(i > 0) {
          let pedraRaw = linhas[i-1];
          let cor = identificarCor(pedraRaw);
          // Se pedraRaw for horário também (ex: sequência só de horários), considera branco
          if(pedraRaw.match(/^\d{2}:\d{2}:\d{2}$/)) cor = 'branco';
          novoHistorico.push({
            hora: linha,
            pedra: cor === 'branco' ? null : Number(pedraRaw),
            cor
          });
        }
      } else {
        // Se for número, próxima linha tem que ser horário para formar par
        if(i+1 < linhas.length && linhas[i+1].match(/^\d{2}:\d{2}:\d{2}$/)) {
          // já processado na iteração do horário
          continue;
        } else {
          // Pedra sem horário => ignorar
          continue;
        }
      }
    }
    historico = novoHistorico;
    salvarHistorico();
    carregarHistoricoNaTextarea();
    analisarPrevisao();
    alert('Histórico carregado com ' + historico.length + ' pedras.');
  };

  function carregarHistoricoNaTextarea() {
    // Monta texto simples para exibir no textarea
    let texto = '';
    for(const item of historico) {
      const numStr = item.pedra === null ? '' : item.pedra.toString();
      texto += numStr + '\n' + item.hora + '\n';
    }
    txtHistorico.value = texto.trim();
  }

  // Função de previsão simples: procura o último branco no histórico e tenta prever o próximo branco baseado no intervalo médio entre brancos
  function analisarPrevisao() {
    if(historico.length === 0) {
      msgPrevisao.textContent = 'Sem histórico para analisar.';
      return;
    }
    // Filtrar brancos e ordenar por hora
    const brancos = historico.filter(i => i.cor === 'branco').sort((a,b) => parseHoraToSeconds(a.hora) - parseHoraToSeconds(b.hora));
    if(brancos.length < 2) {
      msgPrevisao.textContent = 'Mais dados de brancos necessários para prever.';
      return;
    }
    // Calcular intervalos médios entre brancos (em segundos)
    let diffs = [];
    for(let i=1; i < brancos.length; i++) {
      const s1 = parseHoraToSeconds(brancos[i-1].hora);
      const s2 = parseHoraToSeconds(brancos[i].hora);
      if(s1 !== null && s2 !== null) diffs.push(s2 - s1);
    }
    if(diffs.length === 0) {
      msgPrevisao.textContent = 'Dados insuficientes para calcular intervalos.';
      return;
    }
    const mediaIntervalo = diffs.reduce((a,b) => a+b, 0) / diffs.length;

    // Último branco
    const ultimoBranco = brancos[brancos.length - 1];
    const ultimoSeg = parseHoraToSeconds(ultimoBranco.hora);

    if(ultimoSeg === null) {
      msgPrevisao.textContent = 'Erro ao interpretar horário do último branco.';
      return;
    }
    const previsaoSeg = ultimoSeg + mediaIntervalo;
    const previsaoHora = secondsToHora(previsaoSeg);

    msgPrevisao.textContent = `PRÓXIMO BRANCO PROVÁVEL EM ${previsaoHora} — PREPARA!`;

    // Se estiver próximo (menos de 10 segundos) toca som
    const agora = new Date();
    const agoraSeg = agora.getHours()*3600 + agora.getMinutes()*60 + agora.getSeconds();
    if(Math.abs(previsaoSeg - agoraSeg) <= 10) {
      alertSound.play();
    }
  }

  // Botões acertou / errou para aprendizado simples
  document.getElementById('btn-acertou').onclick = () => {
    aprendizado.acertos++;
    salvarAprendizado();
    alert(`Obrigado! Total Acertos: ${aprendizado.acertos}`);
  };
  document.getElementById('btn-errou').onclick = () => {
    aprendizado.erros++;
    salvarAprendizado();
    alert(`Que pena! Total Erros: ${aprendizado.erros}`);
  };

  // Ao carregar a página, carrega histórico e faz análise
  window.onload = () => {
    carregarHistoricoNaTextarea();
    analisarPrevisao();
  };
</script>

</body>
</html>
