<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Scofield Analista - Blaze Double</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #eee;
    margin: 0; padding: 20px;
  }
  h2 {
    text-align: center;
    margin-bottom: 20px;
    color: #f5a623;
  }
  .container {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
    margin-bottom: 15px;
  }
  .pedra {
    background: #222;
    border-radius: 12px;
    padding: 15px;
    width: 130px;
    text-align: center;
    user-select: none;
  }
  .cor-quadrado {
    font-size: 70px;
    cursor: pointer;
    margin-bottom: 10px;
    transition: transform 0.2s ease;
  }
  .cor-quadrado:hover {
    transform: scale(1.15);
  }
  label {
    font-size: 14px;
    margin-top: 5px;
    display: block;
  }
  input[type="number"],
  input[type="time"] {
    width: 100%;
    padding: 6px 8px;
    font-size: 16px;
    border-radius: 6px;
    border: none;
    margin-top: 4px;
  }
  input[type="number"]::-webkit-inner-spin-button,
  input[type="number"]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  button {
    margin: 10px 8px 0 0;
    padding: 12px 22px;
    font-size: 16px;
    font-weight: 600;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: #f5a623;
    color: #111;
    transition: background 0.3s ease;
    user-select: none;
  }
  button:hover {
    background: #d48806;
  }
  #resultado {
    margin-top: 20px;
    font-size: 20px;
    font-weight: 700;
    color: #f5a623;
    text-align: center;
    min-height: 50px;
  }
  #confian√ßa {
    font-weight: 600;
    margin-top: 8px;
    text-align: center;
  }
  #log {
    margin-top: 20px;
    max-height: 230px;
    overflow-y: auto;
    background: #222;
    padding: 10px;
    border-radius: 10px;
    font-size: 14px;
    line-height: 1.3;
    color: #ccc;
  }
  #avisos {
    margin-top: 12px;
    font-size: 16px;
    font-weight: 700;
    color: #ff5555;
    text-align: center;
  }
  @media(max-width: 480px){
    .container {
      flex-direction: column;
      align-items: center;
    }
    .pedra {
      width: 80vw;
      max-width: 300px;
    }
    button {
      width: 48vw;
      max-width: 220px;
    }
  }
</style>
</head>
<body>

<h2>Scofield Analista - Blaze Double</h2>

<div class="container">
  <div class="pedra" id="esquerda">
    <div class="cor-quadrado" id="cor-esq" title="Clique para mudar cor">üî¥</div>
    <label for="num-esq">N√∫mero (0-14)</label>
    <input type="number" id="num-esq" min="0" max="14" placeholder="Ex: 7" />
    <label for="hora-esq">Hor√°rio</label>
    <input type="time" id="hora-esq" />
  </div>

  <div class="pedra" id="meio">
    <div style="font-size: 80px; user-select:none;" title="Pedra branca üî•">üî•</div>
    <label for="hora-meio">Hor√°rio Branco</label>
    <input type="time" id="hora-meio" />
  </div>

  <div class="pedra" id="direita">
    <div class="cor-quadrado" id="cor-dir" title="Clique para mudar cor">üî¥</div>
    <label for="num-dir">N√∫mero (0-14)</label>
    <input type="number" id="num-dir" min="0" max="14" placeholder="Ex: 3" />
    <label for="hora-dir">Hor√°rio</label>
    <input type="time" id="hora-dir" />
  </div>
</div>

<div style="text-align:center;">
  <button id="btn-salvar">Salvar Resultado</button>
  <button id="btn-analisar">Analisar</button>
  <button id="btn-limpar">Limpar Hist√≥rico</button>
</div>

<div id="resultado"></div>
<div id="confian√ßa"></div>
<div style="text-align:center; margin-top:10px;">
  <button id="btn-acertou" disabled>‚úÖ Acertou</button>
  <button id="btn-errou" disabled>‚ùå Errou</button>
</div>

<div id="avisos"></div>

<div id="log"></div>

<script>
  // --- Vari√°veis globais ---
  const cores = ['vermelho', 'preto'];
  let corEsqIndex = 0;
  let corDirIndex = 0;
  let resultados = JSON.parse(localStorage.getItem('resultados')) || [];
  let feedbacks = JSON.parse(localStorage.getItem('feedbacks')) || [];

  // Refer√™ncias DOM
  const corEsqDiv = document.getElementById('cor-esq');
  const corDirDiv = document.getElementById('cor-dir');
  const btnSalvar = document.getElementById('btn-salvar');
  const btnAnalisar = document.getElementById('btn-analisar');
  const btnLimpar = document.getElementById('btn-limpar');
  const btnAcertou = document.getElementById('btn-acertou');
  const btnErrou = document.getElementById('btn-errou');
  const resultadoDiv = document.getElementById('resultado');
  const confiancaDiv = document.getElementById('confian√ßa');
  const logDiv = document.getElementById('log');
  const avisosDiv = document.getElementById('avisos');

  // --- Fun√ß√£o para atualizar a cor dos quadrados ---
  function atualizarCor(div, index) {
    if (cores[index] === 'vermelho') {
      div.textContent = 'üî¥';
      div.style.color = '#e74c3c';
    } else {
      div.textContent = '‚ö´';
      div.style.color = '#000000';
    }
  }

  // Inicializa cores
  atualizarCor(corEsqDiv, corEsqIndex);
  atualizarCor(corDirDiv, corDirIndex);

  // Trocar cor ao clicar
  corEsqDiv.addEventListener('click', () => {
    corEsqIndex = (corEsqIndex + 1) % cores.length;
    atualizarCor(corEsqDiv, corEsqIndex);
  });
  corDirDiv.addEventListener('click', () => {
    corDirIndex = (corDirIndex + 1) % cores.length;
    atualizarCor(corDirDiv, corDirIndex);
  });

  // Limpar inputs
  function limparCampos() {
    document.getElementById('num-esq').value = '';
    document.getElementById('hora-esq').value = '';
    document.getElementById('hora-meio').value = '';
    document.getElementById('num-dir').value = '';
    document.getElementById('hora-dir').value = '';
  }

  // Converte "HH:MM" para minutos totais (inteiro)
  function horaParaMinutos(hora) {
    if(!hora) return null;
    const [h,m] = hora.split(':').map(Number);
    return h * 60 + m;
  }

  // Converte minutos totais para "HH:MM"
  function minutosParaHora(minutos) {
    const h = Math.floor(minutos / 60);
    const m = minutos % 60;
    return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
  }

  // Salvar resultado no hist√≥rico
  function salvarResultado() {
    const numEsq = parseInt(document.getElementById('num-esq').value);
    const horaEsq = document.getElementById('hora-esq').value;
    const horaMeio = document.getElementById('hora-meio').value;
    const numDir = parseInt(document.getElementById('num-dir').value);
    const horaDir = document.getElementById('hora-dir').value;

    if (
      isNaN(numEsq) || numEsq < 0 || numEsq > 14 ||
      isNaN(numDir) || numDir < 0 || numDir > 14 ||
      !horaEsq || !horaMeio || !horaDir
    ) {
      alert('Preencha todos os campos corretamente (n√∫meros 0-14 e hor√°rios).');
      return;
    }

    const resultado = {
      esquerda: { cor: cores[corEsqIndex], numero: numEsq, horario: horaEsq },
      meio: { cor: 'branco', horario: horaMeio },
      direita: { cor: cores[corDirIndex], numero: numDir, horario: horaDir }
    };

    resultados.push(resultado);
    localStorage.setItem('resultados', JSON.stringify(resultados));
    atualizarLog();
    limparCampos();
    resultadoDiv.textContent = '';
    confiancaDiv.textContent = '';
    avisosDiv.textContent = '';
    btnAcertou.disabled = true;
    btnErrou.disabled = true;
  }

  // Atualiza log da tela
  function atualizarLog() {
    if (resultados.length === 0) {
      logDiv.innerHTML = '<p>Nenhum resultado salvo.</p>';
      return;
    }
    let html = resultados.map((r, i) => {
      return `<p><strong>#${i+1}</strong> Esquerda: ${r.esquerda.cor} ${r.esquerda.numero} √†s ${r.esquerda.horario} | Branco √†s ${r.meio.horario} | Direita: ${r.direita.cor} ${r.direita.numero} √†s ${r.direita.horario}</p>`;
    }).join('');
    logDiv.innerHTML = html;
  }

  // Feedback do usu√°rio: acertou ou errou a previs√£o
  function salvarFeedback(acertou) {
    if (!ultimoPrevisto) {
      alert('Fa√ßa uma an√°lise antes de registrar acerto ou erro.');
      return;
    }
    feedbacks.push({ previsto: ultimoPrevisto, acertou: acertou, timestamp: new Date().toISOString() });
    localStorage.setItem('feedbacks', JSON.stringify(feedbacks));
    btnAcertou.disabled = true;
    btnErrou.disabled = true;
    resultadoDiv.textContent = 'Obrigado pelo feedback! üß†';
  }

  btnAcertou.addEventListener('click', () => salvarFeedback(true));
  btnErrou.addEventListener('click', () => salvarFeedback(false));

  btnSalvar.addEventListener('click', salvarResultado);

  btnLimpar.addEventListener('click', () => {
    if (confirm('Deseja realmente limpar todo o hist√≥rico?')) {
      resultados = [];
      feedbacks = [];
      localStorage.removeItem('resultados');
      localStorage.removeItem('feedbacks');
      atualizarLog();
      resultadoDiv.textContent = '';
      confiancaDiv.textContent = '';
      avisosDiv.textContent = '';
      btnAcertou.disabled = true;
      btnErrou.disabled = true;
    }
  });

  // Vari√°vel global para armazenar √∫ltima previs√£o feita
  let ultimoPrevisto = null;

  // Fun√ß√£o que implementa estrat√©gias m√∫ltiplas para prever o pr√≥ximo branco
  function analisar() {
    if (resultados.length < 2) {
      alert('Para analisar, √© necess√°rio pelo menos 2 resultados salvos.');
      return;
    }

    // Extrair hor√°rios dos brancos em minutos
    const brancos = resultados
      .map(r => horaParaMinutos(r.meio.horario))
      .filter(v => v !== null)
      .sort((a,b) => a-b);

    // C√°lculo do intervalo m√©dio entre brancos
    const intervalos = [];
    for (let i=1; i<brancos.length; i++) {
      intervalos.push(brancos[i] - brancos[i-1]);
    }
    const mediaIntervalo = intervalos.reduce((a,b) => a+b, 0) / intervalos.length;

    // Previs√£o do pr√≥ximo branco baseada no √∫ltimo branco + m√©dia do intervalo
    const ultimoBranco = brancos[brancos.length -1];
    const previsto = Math.round(ultimoBranco + mediaIntervalo);
    ultimoPrevisto = previsto;

    const previstoHora = minutosParaHora(previsto);
    resultadoDiv.textContent = `üïì PR√ìXIMO BRANCO PROV√ÅVEL EM ${previstoHora} ‚Äî PREPARA!`;

    // --- Determinar a confian√ßa e avisos ---

    const confian√ßa = calcularConfian√ßa(mediaIntervalo, intervalos, brancos);
    confiancaDiv.textContent = confian√ßa.text;
    confiancaDiv.style.color = confian√ßa.color;

    const recDetectado = detectarREC(intervalos);
    const chuvaDetectada = detectarChuva(intervalos);

    let avisos = [];
    if (recDetectado) avisos.push('‚ö†Ô∏è A Blaze pode estar em REC (recupera√ß√£o)!');
    if (chuvaDetectada.estado === 'chuva') avisos.push('‚òîÔ∏è Chuva de brancos detectada!');
    if (chuvaDetectada.estado === 'tendencia') avisos.push('üîÆ Poss√≠vel chuva de brancos se aproximando...');
    avisosDiv.innerHTML = avisos.join('<br>');

    btnAcertou.disabled = false;
    btnErrou.disabled = false;
  }

  btnAnalisar.addEventListener('click', analisar);

  // Calcula confian√ßa do sinal baseado no intervalo e estabilidade
  function calcularConfian√ßa(mediaIntervalo, intervalos, brancos) {
    // Se intervalo m√©dio muito constante e curto = sinal forte
    const variacao = Math.max(...intervalos) - Math.min(...intervalos);
    const intervaloCurto = mediaIntervalo <= 7; // 7 minutos ou menos considerado curto
    const estabilidade = variacao <= 3; // pouca varia√ß√£o entre intervalos

    if (intervaloCurto && estabilidade && brancos.length >= 5) {
      return { text: 'üîí Sinal FORTE ‚Äî alta chance de branco!', color: '#2ecc71' };
    } else if (mediaIntervalo <= 12) {
      return { text: '‚ö†Ô∏è Sinal ARRISCADO ‚Äî aposte com cautela!', color: '#f39c12' };
    } else {
      return { text: '‚ùå Sinal FRACO ‚Äî melhor esperar mais dados.', color: '#e74c3c' };
    }
  }

  // Detecta REC (recupera√ß√£o) pela sequ√™ncia de intervalos longos seguidos por curtos
  function detectarREC(intervalos) {
    if (intervalos.length < 4) return false;
    // Verifica se teve pelo menos um intervalo > 15 minutos (seca)
    // seguido de v√°rios intervalos curtos <= 5 minutos
    let seca = intervalos.some(i => i > 15);
    let recuperacao = intervalos.slice(-3).every(i => i <= 5);
    return seca && recuperacao;
  }

  // Detecta chuva de brancos e tend√™ncia para chuva
  function detectarChuva(intervalos) {
    if (intervalos.length < 3) return {estado:'normal'};
    let ultimos3 = intervalos.slice(-3);

    // Chuva se √∫ltimos 3 intervalos <= 6 min
    if (ultimos3.every(i => i <= 6)) return {estado:'chuva'};

    // Tend√™ncia se √∫ltimos 3 intervalos decrescentes
    if (ultimos3[0] > ultimos3[1] && ultimos3[1] > ultimos3[2]) {
      return {estado:'tendencia'};
    }

    return {estado:'normal'};
  }

  // Inicializa√ß√£o da interface e hist√≥rico
  atualizarLog();
  btnAcertou.disabled = true;
  btnErrou.disabled = true;

</script>

</body>
</html>
