<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Scofield Visionário - Análises</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: Arial, sans-serif;
    margin: 0; padding: 20px;
  }
  h2 {
    color: #0f0;
    text-align: center;
    margin-bottom: 20px;
  }
  .container {
    max-width: 480px;
    margin: auto;
  }
  .bloco {
    background: #222;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 25px;
  }
  .bloco h3 {
    color: #0ff;
    margin-top: 0;
    text-align: center;
  }
  label {
    display: block;
    margin: 10px 0 5px 0;
    font-weight: bold;
  }
  input[type=number], input[type=text] {
    width: 100%;
    padding: 12px;
    border-radius: 5px;
    border: none;
    font-size: 18px;
    text-align: center;
  }
  button {
    background: #0f0;
    border: none;
    border-radius: 6px;
    padding: 15px;
    font-size: 18px;
    color: #000;
    cursor: pointer;
    margin-top: 15px;
    width: 100%;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #0c0;
  }
  .feedback-buttons button {
    width: 48%;
    margin-top: 10px;
  }
  .feedback-buttons {
    display: flex;
    justify-content: space-between;
  }
  #resultado {
    margin-top: 15px;
    font-size: 20px;
    text-align: center;
    min-height: 1.2em;
  }
  .lists-section {
    margin-top: 30px;
  }
  .list-block {
    background: #222;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 30px;
  }
  .list-block h4 {
    margin-top: 0;
    color: #0ff;
  }
  .list-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .progress-bar {
    background: #444;
    border-radius: 10px;
    overflow: hidden;
    height: 20px;
    width: 70%;
    margin-right: 10px;
  }
  .progress-fill {
    background: #0f0;
    height: 100%;
    width: 0%;
    transition: width 0.5s ease;
  }
  .stats-text {
    color: #0f0;
    font-weight: bold;
    white-space: nowrap;
  }
  ul {
    list-style: none;
    padding-left: 0;
    max-height: 250px;
    overflow-y: auto;
  }
  ul li {
    padding: 8px 12px;
    background: #111;
    margin-bottom: 8px;
    border-radius: 6px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  ul li span.time {
    font-weight: bold;
  }
  ul li .buttons {
    display: flex;
    gap: 8px;
  }
  ul li button {
    padding: 6px 12px;
    font-size: 14px;
    width: auto;
  }
  /* Estrategia 2 list style */
  #estrat2-list li {
    background: #111;
  }
  /* Scrollbar for lists */
  ul::-webkit-scrollbar {
    width: 6px;
  }
  ul::-webkit-scrollbar-thumb {
    background: #0f0;
    border-radius: 3px;
  }
</style>
</head>
<body>
<h2>Scofield Visionário</h2>

<div class="container">
  <!-- Estratégia 1: Entrada Manual -->
  <div class="bloco">
    <h3>Estratégia 1 - Entrada Manual</h3>
    <label>Pedra Anterior - Número</label>
    <input type="number" id="num1" placeholder="Ex: 5" />
    <label>Pedra Anterior - Horário (HH:MM)</label>
    <input type="text" id="hora1" placeholder="22:02" />

    <label>Pedra do Meio - Número (0 se branco)</label>
    <input type="number" id="num2" placeholder="Ex: 0" />
    <label>Pedra do Meio - Horário (HH:MM)</label>
    <input type="text" id="hora2" placeholder="22:02" />

    <label>Pedra Posterior - Número</label>
    <input type="number" id="num3" placeholder="Ex: 12" />
    <label>Pedra Posterior - Horário (HH:MM)</label>
    <input type="text" id="hora3" placeholder="22:03" />

    <button onclick="estrat1Analisar()">Analisar e Adicionar à Lista</button>
    <div id="resultado" aria-live="polite"></div>
  </div>

  <!-- Estratégia 2: Contagem de 6 em 6 pedras -->
  <div class="bloco">
    <h3>Estratégia 2 - Contagem Automática</h3>
    <label>Informe o horário do branco (HH:MM)</label>
    <input type="text" id="estrat2_branco" placeholder="Ex: 22:06" />
    <button onclick="estrat2Gerar()">Gerar Lista</button>
    <div id="estrat2-status" style="margin-top:10px; font-size:16px; color:#0f0;"></div>
  </div>

  <!-- Listas da Estratégia 1 -->
  <div class="lists-section">

    <div class="list-block" id="listaAtualBlock">
      <div class="list-controls">
        <h4>Horário Atual</h4>
        <div>
          <button onclick="limparLista('atual')">Limpar Lista</button>
        </div>
      </div>
      <div class="progress-bar" aria-label="Progresso de acertos horário atual">
        <div class="progress-fill" id="progressAtu"></div>
      </div>
      <div class="stats-text" id="statsAtu">0 win | 0 loss</div>
      <ul id="listaAtual" aria-live="polite" aria-relevant="additions"></ul>
    </div>

    <div class="list-block" id="listaProximaBlock">
      <div class="list-controls">
        <h4>Próxima Hora</h4>
        <div>
          <button onclick="limparLista('proxima')">Limpar Lista</button>
        </div>
      </div>
      <div class="progress-bar" aria-label="Progresso de acertos próxima hora">
        <div class="progress-fill" id="progressProx"></div>
      </div>
      <div class="stats-text" id="statsProx">0 win | 0 loss</div>
      <ul id="listaProxima" aria-live="polite" aria-relevant="additions"></ul>
    </div>

    <div class="list-block" id="listaSeguinteBlock">
      <div class="list-controls">
        <h4>Hora Seguinte</h4>
        <div>
          <button onclick="limparLista('seguinte')">Limpar Lista</button>
        </div>
      </div>
      <div class="progress-bar" aria-label="Progresso de acertos hora seguinte">
        <div class="progress-fill" id="progressSeg"></div>
      </div>
      <div class="stats-text" id="statsSeg">0 win | 0 loss</div>
      <ul id="listaSeguinte" aria-live="polite" aria-relevant="additions"></ul>
    </div>

  </div>

  <!-- Lista da Estratégia 2 -->
  <div class="list-block">
    <h4>Estratégia 2 - Próximos Horários</h4>
    <button onclick="limparLista('estrat2')">Limpar Lista</button>
    <div class="progress-bar" aria-label="Progresso de acertos estratégia 2">
      <div class="progress-fill" id="progressE2"></div>
    </div>
    <div class="stats-text" id="statsE2">0 win | 0 loss</div>
    <ul id="estrat2-list" aria-live="polite" aria-relevant="additions"></ul>
  </div>
</div>

<script>
  // Helpers
  function parseTimeHM(t) {
    const [h,m] = t.split(':').map(s => parseInt(s));
    if (isNaN(h) || isNaN(m) || h<0 || h>23 || m<0 || m>59) return null;
    return {h,m};
  }
  function timeToStr(h,m) {
    h = h < 10 ? '0'+h : h;
    m = m < 10 ? '0'+m : m;
    return h + ':' + m;
  }
  function compareTimes(t1,t2) {
    return (t1.h*60 + t1.m) - (t2.h*60 + t2.m);
  }
  function sortListByTime(list) {
    list.sort((a,b) => {
      let ta = parseTimeHM(a.time);
      let tb = parseTimeHM(b.time);
      return compareTimes(ta, tb);
    });
  }

  // Soma dígitos horários
  function somarDigitos(horario) {
    if (!horario) return 0;
    return horario.replace(/[^0-9]/g, '').split('').reduce((acc, d) => acc + parseInt(d), 0);
  }

  // --- Dados e listas da Estratégia 1 ---
  let listaAtual = [];
  let listaProxima = [];
  let listaSeguinte = [];

  // Acertos e erros (win/loss) armazenados em objetos para cada lista
  const stats = {
    atual: {win:0, loss:0},
    proxima: {win:0, loss:0},
    seguinte: {win:0, loss:0},
    estrat2: {win:0, loss:0},
  };

  // Renderiza uma lista na UL correspondente
  function renderLista(nomeLista) {
    let ul, arr;
    switch(nomeLista) {
      case 'atual': ul = document.getElementById('listaAtual'); arr = listaAtual; break;
      case 'proxima': ul = document.getElementById('listaProxima'); arr = listaProxima; break;
      case 'seguinte': ul = document.getElementById('listaSeguinte'); arr = listaSeguinte; break;
      case 'estrat2': ul = document.getElementById('estrat2-list'); arr = listaEstrat2; break;
      default: return;
    }
    // Ordena por horário crescente
    sortListByTime(arr);

    ul.innerHTML = '';
    for(let i=0; i<arr.length; i++) {
      const item = arr[i];
      const li = document.createElement('li');
      li.innerHTML = `<span class="time">${item.time}</span>
        <div class="buttons">
          <button onclick="marcarWin('${nomeLista}', '${item.time}')">Win</button>
          <button onclick="marcarLoss('${nomeLista}', '${item.time}')">Loss</button>
        </div>
      `;
      ul.appendChild(li);
    }
  }

  // Atualiza as listas no DOM
  function atualizarTodasListas() {
    renderLista('atual');
    renderLista('proxima');
    renderLista('seguinte');
    renderLista('estrat2');
    atualizarStats('atual');
    atualizarStats('proxima');
    atualizarStats('seguinte');
    atualizarStats('estrat2');
  }

  // Atualiza as barras e texto de stats
  function atualizarStats(nomeLista) {
    const stat = stats[nomeLista];
    let win = stat.win;
    let loss = stat.loss;
    let total = win + loss;
    let perc = total === 0 ? 0 : Math.round((win/total)*100);
    let progressFillId = '';
    let statsTextId = '';

    switch(nomeLista) {
      case 'atual': progressFillId = 'progressAtu'; statsTextId = 'statsAtu'; break;
      case 'proxima': progressFillId = 'progressProx'; statsTextId = 'statsProx'; break;
      case 'seguinte': progressFillId = 'progressSeg'; statsTextId = 'statsSeg'; break;
      case 'estrat2': progressFillId = 'progressE2'; statsTextId = 'statsE2'; break;
    }
    document.getElementById(progressFillId).style.width = perc + '%';
    document.getElementById(statsTextId).textContent = `${win} win | ${loss} loss`;
  }

  // --- Estratégia 1: Analisar e adicionar na lista atual ---
  function estrat1Analisar() {
    const num1 = parseInt(document.getElementById('num1').value) || 0;
    const num2 = parseInt(document.getElementById('num2').value) || 0;
    const num3 = parseInt(document.getElementById('num3').value) || 0;

    const hora1 = document.getElementById('hora1').value || "";
    const hora2 = document.getElementById('hora2').value || "";
    const hora3 = document.getElementById('hora3').value || "";

    // Validar horários HH:MM (sem segundos)
    if(!parseTimeHM(hora1) || !parseTimeHM(hora2) || !parseTimeHM(hora3)) {
      alert('Por favor, insira horários válidos no formato HH:MM.');
      return;
    }

    // Soma horários
    const somaHorarios = somarDigitos(hora1) + somarDigitos(hora2) + somarDigitos(hora3);
    const somaPedras = num1 + num3;
    const total = somaHorarios + somaPedras;

    // O horário para lista é a hora do meio + total minutos
    const baseTime = parseTimeHM(hora2);
    let minCalc = baseTime.m + total;
    let hourCalc = baseTime.h + Math.floor(minCalc/60);
    minCalc = minCalc % 60;
    hourCalc = hourCalc % 24;
    const timeStr = timeToStr(hourCalc,minCalc);

    document.getElementById('resultado').innerHTML = `
      🔎 Soma horários: ${somarDigitos(hora1)} + ${somarDigitos(hora2)} + ${somarDigitos(hora3)} = ${somaHorarios} <br/>
      🪨 Soma pedras: ${num1} + ${num3} = ${somaPedras} <br/><br/>
      ✅ <b>Total final: ${total}</b><br/>
      ⏰ Horário calculado: <b>${timeStr}</b><br/>
      ✔️ Adicionado à lista Horário Atual
    `;

    // Adiciona na lista atual se não existir o horário
    if(!listaAtual.find(e => e.time === timeStr)) {
      listaAtual.push({time: timeStr});
    }
    atualizarTodasListas();
  }

  // --- Marcar Win/Loss nas listas ---
  function marcarWin(nomeLista, time) {
    stats[nomeLista].win++;
    atualizarStats(nomeLista);
    removerItemDaLista(nomeLista, time);
  }
  function marcarLoss(nomeLista, time) {
    stats[nomeLista].loss++;

    // Para estratégia 1, se errou em atual, joga para as próximas 2 listas
    if(nomeLista === 'atual') {
      moverParaProximasListas(time);
    } else if(nomeLista === 'proxima') {
      moverParaSeguinteLista(time);
    }
    removerItemDaLista(nomeLista, time);
    atualizarStats(nomeLista);
  }

  // Remove item da lista depois de feedback
  function removerItemDaLista(nomeLista, time) {
    let lista;
    if(nomeLista === 'atual') lista = listaAtual;
    else if(nomeLista === 'proxima') lista = listaProxima;
    else if(nomeLista === 'seguinte') lista = listaSeguinte;
    else if(nomeLista === 'estrat2') lista = listaEstrat2;
    else return;

    const idx = lista.findIndex(e=>e.time===time);
    if(idx !== -1) lista.splice(idx,1);

    atualizarTodasListas();
  }

  // Se erro na lista atual, joga para próximas duas
  function moverParaProximasListas(time) {
    if(!listaProxima.find(e => e.time === time)) listaProxima.push({time});
    if(!listaSeguinte.find(e => e.time === time)) listaSeguinte.push({time});
  }
  // Se erro na próxima, joga para seguinte
  function moverParaSeguinteLista(time) {
    if(!listaSeguinte.find(e => e.time === time)) listaSeguinte.push({time});
  }

  // --- Limpar listas ---
  function limparLista(nomeLista) {
    if(confirm(`Deseja limpar a lista "${nomeLista.charAt(0).toUpperCase()+nomeLista.slice(1)}"?`)) {
      if(nomeLista === 'atual') listaAtual = [];
      else if(nomeLista === 'proxima') listaProxima = [];
      else if(nomeLista === 'seguinte') listaSeguinte = [];
      else if(nomeLista === 'estrat2') listaEstrat2 = [];
      stats[nomeLista].win = 0;
      stats[nomeLista].loss = 0;
      atualizarTodasListas();
    }
  }

  // --- Estratégia 2 ---
  let listaEstrat2 = [];

  function estrat2Gerar() {
    const brancoInput = document.getElementById('estrat2_branco').value.trim();
    const base = parseTimeHM(brancoInput);
    if(!base) {
      alert('Informe um horário válido no formato HH:MM.');
      return;
    }
    listaEstrat2 = [];
    let h = base.h;
    let m = base.m;

    // Gera próximos 20 horários somando 3 minutos (6 pedras) cada vez
    for(let i=0; i<20; i++) {
      m += 3;
      if(m >= 60) {
        m -= 60;
        h = (h+1) % 24;
      }
      listaEstrat2.push({time: timeToStr(h,m)});
    }
    document.getElementById('estrat2-status').textContent = `Lista gerada com ${listaEstrat2.length} horários a partir de ${brancoInput}`;
    atualizarTodasListas();
  }

  // --- Inicializa listas na tela
  atualizarTodasListas();

</script>
</body>
</html>
