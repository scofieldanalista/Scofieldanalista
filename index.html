<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Scofield Analista Completo</title>
<style>
  /* Reset e b√°sico */
  body {
    margin: 0; padding: 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #121212;
    color: #eee;
    transition: background-color 0.3s, color 0.3s;
  }
  h1, h2 {
    text-align: center;
    color: #00ffcc;
  }
  textarea, input, button, select {
    width: 100%;
    margin: 10px 0;
    padding: 10px;
    border-radius: 5px;
    border: none;
    font-size: 16px;
    box-sizing: border-box;
  }
  button {
    background-color: #00b894;
    color: white;
    cursor: pointer;
    font-weight: bold;
  }
  button:hover {
    background-color: #019875;
  }
  .section {
    background: #1f1f1f;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 30px;
  }
  .success {
    color: #0f0;
    font-weight: bold;
  }
  .error {
    color: #f55;
    font-weight: bold;
  }
  .prediction {
    font-size: 18px;
    margin-top: 10px;
  }
  .chart, .history, .report-area {
    font-size: 14px;
    white-space: pre-wrap;
    background: #2a2a2a;
    padding: 10px;
    border-radius: 5px;
    max-height: 200px;
    overflow-y: auto;
  }
  .dark-mode {
    background-color: #121212;
    color: #eee;
  }
  .light-mode {
    background-color: #eee;
    color: #121212;
  }
  .dark-mode textarea, .dark-mode input, .dark-mode button, .dark-mode select {
    background-color: #333;
    color: #eee;
  }
  .light-mode textarea, .light-mode input, .light-mode button, .light-mode select {
    background-color: #fff;
    color: #121212;
  }
</style>
</head>
<body class="dark-mode">
  <h1>Scofield Analista Completo</h1>

  <div class="section" id="modeToggleSection">
    <label for="modeToggle">Modo Visual:</label>
    <select id="modeToggle" onchange="toggleMode()">
      <option value="dark" selected>Dark Mode</option>
      <option value="light">Light Mode</option>
    </select>
  </div>

  <div class="section" id="studySection">
    <h2>üß† Hist√≥rico de Estudo</h2>
    <textarea id="studyInput" rows="10" placeholder="Cole aqui o hist√≥rico de estudo (valores + hor√°rios)..."></textarea>
    <button onclick="analyzeHistory()">Analisar Hist√≥rico</button>
    <button onclick="clearHistoryInput()">Limpar Hist√≥rico</button>
    <div id="historyStatus"></div>
    <div id="strategyCount" class="success"></div>
  </div>

  <div class="section" id="patternSection">
    <h2>üß™ An√°lise de Padr√£o Atual (Tempo Real)</h2>
    <textarea id="patternInput" rows="10" placeholder="Cole aqui o padr√£o atual com 3 brancos e pen√∫ltimo com 5 pedras antes..."></textarea>
    <button onclick="analyzePattern()">Analisar Padr√£o</button>
    <button onclick="clearPatternInput()">Limpar An√°lise</button>
    <div id="patternStatus"></div>
    <div class="prediction" id="nextPrediction"></div>
  </div>

  <div class="section" id="predictionHistorySection">
    <h2>üìà Hist√≥rico de Previs√µes</h2>
    <div id="predictionLog" class="chart"></div>
    <div id="accuracyRate" class="success"></div>
    <button onclick="markResult(true)">‚úÖ Acertou</button>
    <button onclick="markResult(false)">‚ùå Errou</button>
  </div>

  <div class="section" id="reportSection" style="display:none;">
    <h2>üìä Relat√≥rios e Gr√°ficos</h2>
    <button onclick="exportReportCSV()">Exportar CSV</button>
    <button onclick="exportReportPDF()">Exportar PDF</button>
    <div id="reportArea" class="report-area"></div>
  </div>

  <audio id="alertSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>

<script>
  // Parte 1 - Vari√°veis globais e setup inicial
  let strategies = [];
  let predictionHistory = [];
  let hits = 0;
  let misses = 0;
  let learningMode = 'full'; // 'full' = an√°lise completa; 'simple' = ap√≥s primeira an√°lise
  let lastStrategyUsed = null;

  // Toggle modo dark/light
  function toggleMode() {
    const mode = document.getElementById('modeToggle').value;
    if (mode === 'dark') {
      document.body.classList.remove('light-mode');
      document.body.classList.add('dark-mode');
    } else {
      document.body.classList.remove('dark-mode');
      document.body.classList.add('light-mode');
    }
  }

  // Fun√ß√£o para limpar textarea do hist√≥rico de estudo
  function clearHistoryInput() {
    document.getElementById('studyInput').value = '';
    document.getElementById('historyStatus').innerText = '';
    document.getElementById('strategyCount').innerText = '';
  }

  // Fun√ß√£o para limpar textarea do padr√£o atual
  function clearPatternInput() {
    document.getElementById('patternInput').value = '';
    document.getElementById('patternStatus').innerText = '';
    document.getElementById('nextPrediction').innerText = '';
  }

  // Fun√ß√£o para parsear hist√≥rico (valores e hor√°rios)
  function parseHistory(raw) {
    const lines = raw.trim().split('\\n');
    const entries = [];
    for (let i = 0; i < lines.length - 1; i += 2) {
      let value = lines[i].trim();
      let time = lines[i + 1].trim();
      if (value === '' || isNaN(Number(value))) {
        entries.push({ color: 'branco', time });
      } else {
        let num = Number(value);
        let color = num >= 1 && num <= 7 ? 'vermelho' : num >= 8 && num <= 14 ? 'preto' : 'desconhecido';
        entries.push({ number: num, color, time });
      }
    }
    return entries;
  }
</script>
