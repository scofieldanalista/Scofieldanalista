<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scofield Analista PRO ‚ö™</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: 'Segoe UI', sans-serif;
      padding: 15px;
    }
    h1 {
      text-align: center;
      color: #ff4747;
    }
    textarea,
    input,
    button {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      box-sizing: border-box;
    }
    textarea,
    input {
      background: #222;
      color: #eee;
      border: 1px solid #555;
      font-family: monospace;
    }
    button {
      background: #ff4747;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      font-size: 1em;
      user-select: none;
    }
    button:hover {
      background: #e53e3e;
    }
    .secao {
      margin-top: 25px;
    }
    .sinal {
      background: #222;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
      user-select: none;
    }
    .sinal button {
      width: 48%;
      margin: 2px 1%;
      font-weight: bold;
    }
    .estatisticas {
      white-space: pre-line;
      background: #222;
      padding: 10px;
      border-radius: 5px;
      margin-top: 15px;
      font-size: 1em;
      max-height: 200px;
      overflow-y: auto;
      font-family: monospace;
    }
    #mensagemCerebro,
    #mensagemHistorico {
      margin-top: 10px;
      color: #8f8;
      font-weight: bold;
      min-height: 20px;
    }
  </style>
</head>
<body>
  <h1>Scofield Analista PRO ‚ö™</h1>

  <div class="secao">
    <h3>üß† Hist√≥rico C√©rebro (An√°lise Completa)</h3>
    <textarea
      id="historicoCerebro"
      rows="10"
      placeholder="Cole aqui o hist√≥rico completo com rodadas, n√∫meros e hor√°rios (ex: 3 linhas por entrada: rodada, pedra, hor√°rio)..."
    ></textarea>
    <button onclick="enviarCerebro()">üì§ Enviar Hist√≥rico</button>
    <div id="mensagemCerebro"></div>
  </div>

  <div class="secao">
    <h3>‚è±Ô∏è Hist√≥rico Atual (Jogadas Recentes)</h3>
    <textarea
      id="historicoAtual"
      rows="6"
      placeholder="Cole aqui as √∫ltimas jogadas para prever os pr√≥ximos brancos..."
    ></textarea>
    <button onclick="analisarAgora()">üîç Analisar</button>
    <div id="previsoes"></div>
  </div>

  <div class="secao">
    <h3>üìä Estat√≠sticas e Resultados</h3>
    <div id="estatisticas" class="estatisticas"></div>
    <button onclick="limparEstatisticas()">üßπ Limpar Estat√≠sticas</button>
  </div>

  <div class="secao">
    <h3>üßπ Limpar Campos de Hist√≥rico</h3>
    <button onclick="limparHistorico()">üßº Limpar Campos</button>
    <div id="mensagemHistorico"></div>
  </div>

  <script>
    // Estruturas principais para guardar estrat√©gias e estat√≠sticas
    let estrategias = JSON.parse(localStorage.getItem("estrategias") || "[]");
    let estatisticas = JSON.parse(localStorage.getItem("estatisticas") || "[]");

    // Parse do hist√≥rico c√©rebro: ler em grupos de 3 linhas (rodada, pedra, hor√°rio)
    function parseHistorico(text) {
      const linhas = text.trim().split('\n');
      const resultados = [];

      for (let i = 0; i < linhas.length; i += 3) {
        const rodada = linhas[i]?.trim();
        const pedraRaw = linhas[i + 1]?.trim();
        const horario = linhas[i + 2]?.trim();

        // Ignora entradas incompletas
        if (!rodada || !horario) continue;

        const pedra =
          pedraRaw === "" || pedraRaw.toLowerCase() === "branco"
            ? "branco"
            : parseInt(pedraRaw, 10);

        resultados.push({
          rodada: parseInt(rodada, 10),
          pedra,
          horario,
          timestamp: timeStringToTimestamp(horario),
        });
      }
      return resultados;
    }

    // Converte "HH:MM:SS" para timestamp em segundos desde in√≠cio do dia
    function timeStringToTimestamp(hora) {
      const partes = hora.split(":");
      if (partes.length !== 3) return null;
      const h = parseInt(partes[0], 10);
      const m = parseInt(partes[1], 10);
      const s = parseInt(partes[2], 10);
      if (
        isNaN(h) ||
        isNaN(m) ||
        isNaN(s) ||
        h < 0 ||
        h > 23 ||
        m < 0 ||
        m > 59 ||
        s < 0 ||
        s > 59
      )
        return null;
      return h * 3600 + m * 60 + s;
    }

    // Salva dados no localStorage e atualiza estat√≠sticas na tela
    function salvarDados() {
      localStorage.setItem("estrategias", JSON.stringify(estrategias));
      localStorage.setItem("estatisticas", JSON.stringify(estatisticas));
      atualizarEstatisticas();
    }

    // Envia o hist√≥rico c√©rebro para an√°lise e cria√ß√£o de estrat√©gias
    function enviarCerebro() {
      const texto = document.getElementById("historicoCerebro").value;
      if (texto.trim().length < 10) {
        alert("Hist√≥rico muito curto.");
        return;
      }

      const dadosParseados = parseHistorico(texto);

      if (dadosParseados.length === 0) {
        alert(
          "N√£o foi poss√≠vel detectar entradas v√°lidas no hist√≥rico. Verifique o formato."
        );
        return;
      }

      // Gerar estrat√©gias a partir dos dados parseados
      gerarEstrategias(dadosParseados);

      document.getElementById("mensagemCerebro").innerText =
        "‚úÖ Hist√≥rico analisado com sucesso!";
      salvarDados();
    }

    // Gera estrat√©gias baseadas no hist√≥rico c√©rebro
    function gerarEstrategias(dados) {
      // Resetar estrat√©gias atuais (ou pode acumular, ajuste conforme desejar)
      estrategias = [];

      // Exemplo simples: estrat√©gia baseada no intervalo entre brancos
      // Vamos extrair os hor√°rios dos brancos e calcular os intervalos

      const brancos = dados.filter((r) => r.pedra === "branco");
      if (brancos.length < 2) {
        // Poucos brancos para an√°lise
        return;
      }

      // Calcular intervalos entre brancos em segundos
      let intervalos = [];
      for (let i = 1; i < brancos.length; i++) {
        let diff = brancos[i].timestamp - brancos[i - 1].timestamp;
        if (diff < 0) diff += 24 * 3600; // Ajuste para virada do dia
        intervalos.push(diff);
      }

      // Calcular m√©dia e desvio padr√£o dos intervalos
      const media =
        intervalos.reduce((acc, v) => acc + v, 0) / intervalos.length || 0;
      const desvio = Math.sqrt(
        intervalos
          .map((v) => (v - media) ** 2)
          .reduce((acc, v) => acc + v, 0) / intervalos.length
      );

      // Armazenar a estrat√©gia
      estrategias.push({
        tipo: "intervalo_brancos",
        media: media,
        desvio: desvio,
        intervalos: intervalos,
        peso: 1,
      });
    }

    // Analisa o hist√≥rico atual e gera previs√µes reais baseadas nas estrat√©gias
    function analisarAgora() {
      const textoAtual = document.getElementById("historicoAtual").value;
      if (textoAtual.trim().length < 6) {
        alert("Cole as √∫ltimas jogadas para an√°lise.");
        return;
      }

      const dadosAtuais = parseHistorico(textoAtual);
      if (dadosAtuais.length === 0) {
        alert("Formato do hist√≥rico atual inv√°lido.");
        return;
      }

      const previsoes = preverBranco(dadosAtuais);
      mostrarPrevisoes(previsoes);
    }

    // Fun√ß√£o para prever o pr√≥ximo branco com base no hist√≥rico atual e estrat√©gias
    function preverBranco(dadosAtuais) {
      // Pega o √∫ltimo branco do hist√≥rico atual
      const brancosAtuais = dadosAtuais.filter((r) => r.pedra === "branco");
      if (brancosAtuais.length === 0) return [];

      const ultimoBranco = brancosAtuais[brancosAtuais.length - 1];
      const tempoUltimoBranco = ultimoBranco.timestamp;

      // Pega a estrat√©gia de intervalo m√©dia para os brancos
      const estrategia = estrategias.find(
        (e) => e.tipo === "intervalo_brancos" && e.peso > 0
      );

      if (!estrategia) return [];

      // Estima o pr√≥ximo branco somando a m√©dia do intervalo ao √∫ltimo branco
      let previsaoTimestamp = tempoUltimoBranco + estrategia.media;

      // Ajuste para passar do limite do dia
      if (previsaoTimestamp >= 24 * 3600) previsaoTimestamp -= 24 * 3600;

      // Gera hor√°rios pr√≥ximos para indicar n√≠vel de confian√ßa
      const previsoes = [];

      // N√≠vel Forte: previs√£o exata +/- 10 segundos
      previsoes.push({
        horario: timestampToTimeString(previsaoTimestamp),
        nivel: "Forte",
      });

      // N√≠vel Moderado: + / - 10 a 30 segundos
      previsoes.push({
        horario: timestampToTimeString(previsaoTimestamp + 20),
        nivel: "Moderado",
      });
      previsoes.push({
        horario: timestampToTimeString(previsaoTimestamp - 20),
        nivel: "Moderado",
      });

      // N√≠vel Arriscado: + / - 30 a 60 segundos
      previsoes.push({
        horario: timestampToTimeString(previsaoTimestamp + 45),
        nivel: "Arriscado",
      });
      previsoes.push({
        horario: timestampToTimeString(previsaoTimestamp - 45),
        nivel: "Arriscado",
      });

      // Retorna previs√µes ordenadas pelo n√≠vel de confian√ßa (Forte primeiro)
      return previsoes;
    }

    // Converte timestamp (segundos) para string "HH:MM:SS"
    function timestampToTimeString(segundos) {
      let s = Math.round(segundos);
      if (s < 0) s += 24 * 3600;
      const h = Math.floor(s / 3600) % 24;
      const m = Math.floor((s % 3600) / 60);
      const sec = s % 60;
      return (
        String(h).padStart(2, "0") +
        ":" +
        String(m).padStart(2, "0") +
        ":" +
        String(sec).padStart(2, "0")
      );
    }

    // Mostra as previs√µes na tela com bot√µes Acertou / Errou
    function mostrarPrevisoes(previsoes) {
      const div = document.getElementById("previsoes");
      div.innerHTML = "<h4>üü¢ Brancos Prov√°veis:</h4>";

      if (previsoes.length === 0) {
        div.innerHTML += "<p>Sem previs√µes dispon√≠veis.</p>";
        return;
      }

      previsoes.forEach((p) => {
        const sinalDiv = document.createElement("div");
        sinalDiv.className = "sinal";
        sinalDiv.innerHTML = `
          <strong>${p.horario}</strong> (${p.nivel})<br>
          <button onclick="registrarResultado('${p.horario}', 'win')">‚úÖ Acertou</button>
          <button onclick="registrarResultado('${p.horario}', 'loss')">‚ùå Errou</button>
        `;
        div.appendChild(sinalDiv);
      });
    }

    // Registrar resultado e ajustar estrat√©gias (aprendizado)
    function registrarResultado(horario, resultado) {
      estatisticas.push({ horario, resultado: resultado === "win" ? "‚úÖ" : "‚ùå" });
      salvarDados();

      // Ajustar peso da estrat√©gia principal com base no resultado
      const estrategia = estrategias.find((e) => e.tipo === "intervalo_brancos");
      if (!estrategia) return;

      if (resultado === "win") {
        estrategia.peso = Math.min(estrategia.peso + 0.5, 5); // aumenta confian√ßa
      } else {
        estrategia.peso = Math.max(estrategia.peso - 0.7, 0); // diminui confian√ßa
      }

      salvarDados();
      alert(`Resultado registrado: ${resultado === "win" ? "Acertou" : "Errou"}`);
    }

    // Atualiza a √°rea de estat√≠sticas na interface
    function atualizarEstatisticas() {
      const div = document.getElementById("estatisticas");
      div.innerText = estatisticas
        .map((e) => `${e.horario} ${e.resultado}`)
        .reverse()
        .join("\n");
    }

    // Limpa as estat√≠sticas
    function limparEstatisticas() {
      if (confirm("Tem certeza que deseja apagar as estat√≠sticas?")) {
        estatisticas = [];
        salvarDados();
      }
    }

    // Limpa campos de hist√≥rico e mensagens
    function limparHistorico() {
      document.getElement
