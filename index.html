<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Scofield Analista Completo</title>
<style>
  /* Reset e b√°sico */
  body {
    margin: 0; padding: 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #121212;
    color: #eee;
    transition: background-color 0.3s, color 0.3s;
  }
  h1, h2 {
    text-align: center;
    color: #00ffcc;
  }
  textarea, input, button, select {
    width: 100%;
    margin: 10px 0;
    padding: 10px;
    border-radius: 5px;
    border: none;
    font-size: 16px;
    box-sizing: border-box;
  }
  button {
    background-color: #00b894;
    color: white;
    cursor: pointer;
    font-weight: bold;
  }
  button:hover {
    background-color: #019875;
  }
  .section {
    background: #1f1f1f;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 30px;
  }
  .success {
    color: #0f0;
    font-weight: bold;
  }
  .error {
    color: #f55;
    font-weight: bold;
  }
  .prediction {
    font-size: 18px;
    margin-top: 10px;
  }
  .chart, .history, .report-area {
    font-size: 14px;
    white-space: pre-wrap;
    background: #2a2a2a;
    padding: 10px;
    border-radius: 5px;
    max-height: 200px;
    overflow-y: auto;
  }
  .dark-mode {
    background-color: #121212;
    color: #eee;
  }
  .light-mode {
    background-color: #eee;
    color: #121212;
  }
  .dark-mode textarea, .dark-mode input, .dark-mode button, .dark-mode select {
    background-color: #333;
    color: #eee;
  }
  .light-mode textarea, .light-mode input, .light-mode button, .light-mode select {
    background-color: #fff;
    color: #121212;
  }
</style>
</head>
<body class="dark-mode">
  <h1>Scofield Analista Completo</h1>

  <div class="section" id="modeToggleSection">
    <label for="modeToggle">Modo Visual:</label>
    <select id="modeToggle" onchange="toggleMode()">
      <option value="dark" selected>Dark Mode</option>
      <option value="light">Light Mode</option>
    </select>
  </div>

  <div class="section" id="studySection">
    <h2>üß† Hist√≥rico de Estudo</h2>
    <textarea id="studyInput" rows="10" placeholder="Cole aqui o hist√≥rico de estudo (valores + hor√°rios)..."></textarea>
    <button onclick="analyzeHistory()">Analisar Hist√≥rico</button>
    <button onclick="clearHistoryInput()">Limpar Hist√≥rico</button>
    <div id="historyStatus"></div>
    <div id="strategyCount" class="success"></div>
  </div>

  <div class="section" id="patternSection">
    <h2>üß™ An√°lise de Padr√£o Atual (Tempo Real)</h2>
    <textarea id="patternInput" rows="10" placeholder="Cole aqui o padr√£o atual com 3 brancos e pen√∫ltimo com 5 pedras antes..."></textarea>
    <button onclick="analyzePattern()">Analisar Padr√£o</button>
    <button onclick="clearPatternInput()">Limpar An√°lise</button>
    <div id="patternStatus"></div>
    <div class="prediction" id="nextPrediction"></div>
  </div>

  <div class="section" id="predictionHistorySection">
    <h2>üìà Hist√≥rico de Previs√µes</h2>
    <div id="predictionLog" class="chart"></div>
    <div id="accuracyRate" class="success"></div>
    <button onclick="markResult(true)">‚úÖ Acertou</button>
    <button onclick="markResult(false)">‚ùå Errou</button>
  </div>

  <div class="section" id="reportSection" style="display:none;">
    <h2>üìä Relat√≥rios e Gr√°ficos</h2>
    <button onclick="exportReportCSV()">Exportar CSV</button>
    <button onclick="exportReportPDF()">Exportar PDF</button>
    <div id="reportArea" class="report-area"></div>
  </div>

  <audio id="alertSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>

<script>
  // Vari√°veis globais
  let strategies = [];
  let predictionHistory = [];
  let hits = 0;
  let misses = 0;
  let learningMode = 'full'; // 'full' = an√°lise completa; 'simple' = ap√≥s primeira an√°lise
  let lastStrategyUsed = null;

  // Toggle modo dark/light
  function toggleMode() {
    const mode = document.getElementById('modeToggle').value;
    if (mode === 'dark') {
      document.body.classList.remove('light-mode');
      document.body.classList.add('dark-mode');
    } else {
      document.body.classList.remove('dark-mode');
      document.body.classList.add('light-mode');
    }
  }

  // Limpar textarea do hist√≥rico de estudo
  function clearHistoryInput() {
    document.getElementById('studyInput').value = '';
    document.getElementById('historyStatus').innerText = '';
    document.getElementById('strategyCount').innerText = '';
  }

  // Limpar textarea do padr√£o atual
  function clearPatternInput() {
    document.getElementById('patternInput').value = '';
    document.getElementById('patternStatus').innerText = '';
    document.getElementById('nextPrediction').innerText = '';
  }

  // Parse do hist√≥rico (valores e hor√°rios)
  function parseHistory(raw) {
    const lines = raw.trim().split('\\n');
    const entries = [];
    for (let i = 0; i < lines.length - 1; i += 2) {
      let value = lines[i].trim();
      let time = lines[i + 1].trim();
      if (value === '' || isNaN(Number(value))) {
        entries.push({ color: 'branco', time });
      } else {
        let num = Number(value);
        let color = num >= 1 && num <= 7 ? 'vermelho' : num >= 8 && num <= 14 ? 'preto' : 'desconhecido';
        entries.push({ number: num, color, time });
      }
    }
    return entries;
  }

  // An√°lise do hist√≥rico de estudo
  function analyzeHistory() {
    const raw = document.getElementById('studyInput').value;
    if (!raw.trim()) {
      document.getElementById('historyStatus').innerText = 'Por favor, cole o hist√≥rico para an√°lise.';
      document.getElementById('historyStatus').className = 'error';
      return;
    }
    const entries = parseHistory(raw);

    // Exemplo simples: resetar estrat√©gias e criar fict√≠cias para demonstra√ß√£o
    strategies = [];
    strategies.push({name: 'Soma Anterior+Posterior', weight: 0.8});
    strategies.push({name: 'Padr√£o Hor√°rio', weight: 0.7});
    strategies.push({name: 'Sequ√™ncia de Cores', weight: 0.6});

    // Atualizar interface com sucesso e quantidade de estrat√©gias
    document.getElementById('historyStatus').innerText = '‚úÖ Hist√≥rico analisado com sucesso';
    document.getElementById('historyStatus').className = 'success';
    document.getElementById('strategyCount').innerText = `${strategies.length} estrat√©gias criadas`;
    document.getElementById('strategyCount').className = 'success';
  }

  // Fun√ß√£o fict√≠cia para analisar o padr√£o atual (tempo real)
  function analyzePattern() {
    const raw = document.getElementById('patternInput').value;
    if (!raw.trim()) {
      document.getElementById('patternStatus').innerText = 'Por favor, cole o padr√£o para an√°lise.';
      document.getElementById('patternStatus').className = 'error';
      return;
    }

    // Aqui deve ter a l√≥gica real de an√°lise e previs√£o
    // Por enquanto, simulamos uma previs√£o aleat√≥ria
    document.getElementById('patternStatus').innerText = '‚úÖ An√°lise feita com sucesso';
    document.getElementById('patternStatus').className = 'success';

    const nextMinute = new Date();
    nextMinute.setMinutes(nextMinute.getMinutes() + Math.floor(Math.random() * 5) + 1);
    const hh = nextMinute.getHours().toString().padStart(2, '0');
    const mm = nextMinute.getMinutes().toString().padStart(2, '0');

    // Simular for√ßa e confian√ßa
    const strength = Math.random() > 0.5 ? 'Forte' : 'Arriscado';
    const confidence = Math.floor(Math.random() * 36) + 65; // 65% a 100%

    document.getElementById('nextPrediction').innerHTML =
      `Pr√≥ximo branco prov√°vel em <strong>${hh}:${mm}</strong> ‚Äî ` +
      `<span style="color:${strength === 'Forte' ? '#0f0' : '#ff0'}">${strength}</span> ‚Äî ` +
      `Confian√ßa: ${confidence}%`;

    // Salvar na hist√≥ria de previs√µes (status pendente)
    predictionHistory.push({
      time: `${hh}:${mm}`,
      strength,
      confidence,
      result: '‚è≥',
    });
    updatePredictionLog();
  }

  // Atualizar o hist√≥rico de previs√µes exibido
  function updatePredictionLog() {
    const logDiv = document.getElementById('predictionLog');
    logDiv.innerHTML = '';
    predictionHistory.forEach((item, idx) => {
      logDiv.innerHTML +=
        `${idx + 1}. ${item.time} ‚Äî ${item.strength} ‚Äî Confian√ßa: ${item.confidence}% ‚Äî Resultado: ${item.result}\n`;
    });
    updateAccuracyRate();
  }

  // Atualizar taxa de acerto
  function updateAccuracyRate() {
    const total = hits + misses;
    let rate = 0;
    if (total > 0) rate = Math.round((hits / total) * 100);
    document.getElementById('accuracyRate').innerText =
      `üéØ Taxa de acerto: ${rate}% (${hits} acertos / ${misses} erros)`;
  }

  // Marcar resultado da previs√£o: acertou ou errou
  function markResult(acertou) {
    if (predictionHistory.length === 0) {
      alert('N√£o h√° previs√£o para marcar resultado.');
      return;
    }
    const lastPrediction = predictionHistory[predictionHistory.length - 1];
    if (lastPrediction.result !== '‚è≥') {
      alert('Resultado j√° marcado para a √∫ltima previs√£o.');
      return;
    }
    if (acertou) {
      hits++;
      lastPrediction.result = '‚úÖ';
      reinforceStrategy();
    } else {
      misses++;
      lastPrediction.result = '‚ùå';
      adjustStrategy();
    }
    updatePredictionLog();
  }

  // Fun√ß√µes fict√≠cias para refor√ßar e ajustar estrat√©gias (a implementar)
  function reinforceStrategy() {
    // Aqui pode aumentar peso da estrat√©gia usada
    // Placeholder para futura l√≥gica
    console.log('Estrat√©gia refor√ßada.');
  }
  function adjustStrategy() {
    // Aqui pode reduzir peso da estrat√©gia usada ou ajustar
    // Placeholder para futura l√≥gica
    console.log('Estrat√©gia ajustada.');
  }

  // Exportar relat√≥rio CSV (simples)
  function exportReportCSV() {
    if (predictionHistory.length === 0) {
      alert('Nenhum dado para exportar.');
      return;
    }
    let csvContent = 'data:text/csv;charset=utf-8,';
    csvContent += 'N¬∫,Hor√°rio,For√ßa,Confian√ßa,Resultado\n';
    predictionHistory.forEach((item, idx) => {
      csvContent += `${idx + 1},${item.time},${item.strength},${item.confidence}%,${item.result}\n`;
    });
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement('a');
    link.setAttribute('href', encodedUri);
    link.setAttribute('download', 'scofield_analista_relatorio.csv');
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  // Exportar relat√≥rio PDF (simples usando jsPDF)
  function exportReportPDF() {
    if (typeof window.jsPDF === 'undefined') {
      alert('Biblioteca jsPDF n√£o carregada. Importe a biblioteca para usar essa fun√ß√£o.');
      return;
    }
    if (predictionHistory.length === 0) {
      alert('Nenhum dado para exportar.');
      return;
    }
    const doc = new jsPDF();
    doc.setFontSize(16);
    doc.text('Relat√≥rio Scofield Analista', 10, 10);
    doc.setFontSize(12);
    let y = 20;
    doc.text('N¬∫ Hor√°rio For√ßa Confian√ßa Resultado', 10, y);
    y += 10;
    predictionHistory.forEach((item, idx) => {
      doc.text(
        `${idx + 1} ${item.time} ${item.strength} ${item.confidence}% ${item.result}`,
        10,
        y
      );
      y += 10;
    });
    doc.save('scofield_analista_relatorio.pdf');
  }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>
</html>
