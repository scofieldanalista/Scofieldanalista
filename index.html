<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scofield Analista - Blaze Double</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      padding: 20px;
      user-select: none;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #f39c12;
      text-shadow: 0 0 5px #f39c12;
    }
    .container {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    .pedra {
      background: #222;
      padding: 15px;
      border-radius: 10px;
      width: 120px;
      text-align: center;
      box-shadow: 0 0 8px #555;
    }
    .cor-quadrado {
      font-size: 36px;
      cursor: pointer;
      margin-bottom: 8px;
      user-select: none;
    }
    input[type="number"], input[type="time"] {
      width: 100%;
      padding: 5px;
      border-radius: 6px;
      border: none;
      font-size: 16px;
      margin-bottom: 8px;
      box-sizing: border-box;
    }
    button {
      padding: 10px 18px;
      font-size: 16px;
      margin: 5px;
      border: none;
      border-radius: 8px;
      background: #f39c12;
      color: #111;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 0 6px #f39c12;
      user-select: none;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #d47f07;
    }
    #resultado, #confian√ßa, #avisos {
      margin-top: 15px;
      font-size: 18px;
      text-align: center;
      font-weight: bold;
    }
    #log {
      margin-top: 25px;
      font-size: 14px;
      max-height: 200px;
      overflow-y: auto;
      background: #222;
      padding: 10px;
      border-radius: 8px;
      box-shadow: inset 0 0 8px #555;
      user-select: text;
    }
  </style>
</head>
<body>
  <h2>Scofield Analista - Blaze Double</h2>
  <div id="app">Carregando aplica√ß√£o...</div>

<script>
  const app = document.getElementById('app');
  const resultados = JSON.parse(localStorage.getItem('resultados') || '[]');
  const feedbacks = JSON.parse(localStorage.getItem('feedbacks') || '{}');
  let brancosHistorico = JSON.parse(localStorage.getItem('brancosHistorico') || '[]');
  let ultimoPrevisto = null;

  function horaParaMinutos(hora) {
    const [h, m] = hora.split(':').map(Number);
    return h * 60 + m;
  }

  function minutosParaHora(minutos) {
    const h = String(Math.floor(minutos / 60)).padStart(2, '0');
    const m = String(minutos % 60).padStart(2, '0');
    return `${h}:${m}`;
  }

  function salvarResultado(esq, meio, dir) {
    if (!esq.numero || !esq.horario || !dir.numero || !dir.horario || !meio.horario) {
      alert('Preencha todos os n√∫meros e hor√°rios, exceto o branco que n√£o tem n√∫mero.');
      return;
    }
    resultados.push({ esq, meio, dir });
    localStorage.setItem('resultados', JSON.stringify(resultados));

    // Atualiza hist√≥rico de brancos
    if (!brancosHistorico.includes(meio.horario)) {
      brancosHistorico.push(meio.horario);
      localStorage.setItem('brancosHistorico', JSON.stringify(brancosHistorico));
    }

    atualizarLog();
    alert('Resultado salvo com sucesso!');
  }

  function atualizarLog() {
    const logDiv = document.getElementById('log');
    if (resultados.length === 0) {
      logDiv.innerHTML = 'Nenhum resultado salvo ainda.';
      return;
    }
    logDiv.innerHTML = resultados.map((r, i) => {
      let feedback = feedbacks[i];
      let emoji = feedback === 'acerto' ? '‚úÖ' : feedback === 'erro' ? '‚ùå' : '';
      return `${i + 1}. ${r.esq.cor} ${r.esq.numero} ${r.esq.horario} | üé≤ ${r.meio.horario} | ${r.dir.cor} ${r.dir.numero} ${r.dir.horario} ${emoji}`;
    }).join('<br>');
  }

  function calcularMediaIntervaloHistorico() {
    if (brancosHistorico.length < 2) return 6;
    const brancosMin = brancosHistorico.map(h => horaParaMinutos(h)).sort((a,b)=>a-b);
    const intervalos = [];
    for(let i=1; i<brancosMin.length; i++) {
      intervalos.push(brancosMin[i] - brancosMin[i-1]);
    }
    return intervalos.reduce((a,b) => a+b, 0) / intervalos.length;
  }

  function calcularConfian√ßa(media, brancos) {
    if (brancos.length < 2) {
      return { text: "‚ö†Ô∏è Poucos dados ‚Äî sinal arriscado", color: "#f39c12" };
    } else if (media <= 4) {
      return { text: "‚úÖ Sinal forte ‚Äî branco prov√°vel", color: "#2ecc71" };
    } else {
      return { text: "‚ö†Ô∏è Sinal moderado ‚Äî use cautela", color: "#f1c40f" };
    }
  }

  function analisar() {
    if (resultados.length < 1) {
      alert('Salve pelo menos 1 resultado para come√ßar a an√°lise.');
      return;
    }

    const brancosMin = brancosHistorico
      .map(h => horaParaMinutos(h))
      .filter(v => v !== null)
      .sort((a, b) => a - b);

    if (brancosMin.length === 0) {
      alert('Nenhum hor√°rio v√°lido do branco encontrado para an√°lise.');
      return;
    }

    const ultimoBranco = brancosMin[brancosMin.length - 1];
    const mediaIntervalo = calcularMediaIntervaloHistorico();

    const previsto = Math.round(ultimoBranco + mediaIntervalo);
    const previstoHora = minutosParaHora(previsto);
    ultimoPrevisto = previsto;

    document.getElementById('resultado').textContent = `üïì PR√ìXIMO BRANCO PROV√ÅVEL EM ${previstoHora} ‚Äî PREPARA!`;

    const conf = calcularConfian√ßa(mediaIntervalo, brancosMin);
    document.getElementById('confian√ßa').textContent = conf.text;
    document.getElementById('confian√ßa').style.color = conf.color;

    let chuvaCount = 0;
    for (let i = brancosMin.length - 1; i >= 0; i--) {
      if (ultimoBranco - brancosMin[i] <= 5) {
        chuvaCount++;
      } else {
        break;
      }
    }

    let avisosHTML = '';
    if (chuvaCount >= 2) {
      avisosHTML += `<span style="color: #3498db; font-weight:bold;">‚òîÔ∏è CHUVA DE BRANCOS DETECTADA: ${chuvaCount} brancos nos √∫ltimos 5 minutos!</span><br>`;
    }

    avisosHTML += `
      <button id="btnAcertou" style="margin-right:10px;">‚úÖ Acertou</button>
      <button id="btnErrou">‚ùå Errou</button>
    `;
    document.getElementById('avisos').innerHTML = avisosHTML;

    document.getElementById('btnAcertou').onclick = () => {
      feedbacks[resultados.length - 1] = 'acerto';
      localStorage.setItem('feedbacks', JSON.stringify(feedbacks));
      alert('Feedback de ACERTO registrado!');
      atualizarLog();
      document.getElementById('avisos').innerHTML = '';
    };

    document.getElementById('btnErrou').onclick = () => {
      feedbacks[resultados.length - 1] = 'erro';
      localStorage.setItem('feedbacks', JSON.stringify(feedbacks));
      alert('Feedback de ERRO registrado!');
      atualizarLog();
      document.getElementById('avisos').innerHTML = '';
    };
  }

  function limparHistorico() {
    if (!confirm('Tem certeza que deseja limpar todo o hist√≥rico?')) return;
    localStorage.removeItem('resultados');
    localStorage.removeItem('feedbacks');
    localStorage.removeItem('brancosHistorico');
    resultados.length = 0;
    for (const key in feedbacks) delete feedbacks[key];
    brancosHistorico.length = 0;
    atualizarLog();
    document.getElementById('resultado').textContent = '';
    document.getElementById('confian√ßa').textContent = '';
    document.getElementById('avisos').textContent = '';
  }

  function criarInterface() {
    app.innerHTML = `
      <div class="container">
        <div class="pedra">
          <div contenteditable class="cor-quadrado" id="corEsq" title="Clique para mudar cor">üî¥</div>
          <label>N√∫mero</label>
          <input type="number" id="numEsq" />
          <label>Hor√°rio</label>
          <input type="time" id="horaEsq" />
        </div>
        <div class="pedra">
          <div class="cor-quadrado" id="corMeio" title="Branco - n√£o tem n√∫mero">üé≤</div>
          <label>Hor√°rio</label>
          <input type="time" id="horaMeio" />
        </div>
        <div class="pedra">
          <div contenteditable class="cor-quadrado" id="corDir" title="Clique para mudar cor">‚ö´</div>
          <label>N√∫mero</label>
          <input type="number" id="numDir" />
          <label>Hor√°rio</label>
          <input type="time" id="horaDir" />
        </div>
      </div>
      <button onclick="salvarResultado(
        {cor: document.getElementById('corEsq').textContent.trim(), numero: document.getElementById('numEsq').value.trim(), horario: document.getElementById('horaEsq').value},
        {horario: document.getElementById('horaMeio').value},
        {cor: document.getElementById('corDir').textContent.trim(), numero: document.getElementById('numDir').value.trim(), horario: document.getElementById('horaDir').value}
      )">Salvar Resultado</button>
      <button onclick="analisar()">Analisar</button>
      <button onclick="limparHistorico()">Limpar Hist√≥rico</button>
      <div id="resultado"></div>
      <div id="confian√ßa"></div>
      <div id="avisos"></div>
      <div id="log"></div>
    `;

    function toggleCor(element) {
      const cores = ['üî¥', '‚ö´', '‚ö™'];
      let atual = element.textContent.trim();
      let index = cores.indexOf(atual);
      index = (index + 1) % cores.length;
      element.textContent = cores[index];
    }

    document.getElementById('corEsq').addEventListener('click', e => toggleCor(e.target));
    document.getElementById('corDir').addEventListener('click', e => toggleCor(e.target));

    atualizarLog();
  }

  criarInterface();
</script>
</body>
</html>
