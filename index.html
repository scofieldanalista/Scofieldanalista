<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Scofield Analista PRO</title>
  <style>
    body {
      background: #111; color: #eee; font-family: Arial, sans-serif;
      padding: 20px;
    }
    h1 { text-align: center; color: #ff4747; }
    textarea, button {
      width: 100%; margin: 10px 0; padding: 10px;
      border-radius: 5px; border: none;
      font-size: 16px; box-sizing: border-box;
    }
    textarea {
      background: #222; color: #eee; resize: vertical;
      border: 1px solid #444;
    }
    button {
      background: #ff4747; color: white;
      font-weight: bold; cursor: pointer;
    }
    button:hover { background: #e84118; }
    .sinal {
      background: #222; padding: 10px; margin: 5px 0;
      border-radius: 5px;
    }
    .estatisticas, #contadorEstrat {
      background: #1a1a1a; padding: 10px;
      border-radius: 5px; margin-top: 10px;
      white-space: pre-line;
    }
    #previsoes div {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<h1>‚ö™ Scofield Analista PRO</h1>

<!-- Hist√≥rico C√©rebro -->
<h3>üß† Hist√≥rico C√©rebro</h3>
<textarea id="historicoCerebro" rows="6" placeholder="Cole o hist√≥rico completo..."></textarea>
<button onclick="enviarCerebro()">üì§ Enviar Hist√≥rico</button>
<div id="mensagemCerebro"></div>
<div id="contadorEstrat">üß© Estrat√©gias criadas: 0</div>

<!-- Hist√≥rico Atual -->
<h3>üì° Come√ßar An√°lise</h3>
<textarea id="historicoAtual" rows="4" placeholder="Cole o padr√£o atual..."></textarea>
<button onclick="analisarAgora()">üîç Analisar</button>
<div id="previsoes"></div>

<!-- Estat√≠sticas -->
<h3>üìä Estat√≠sticas</h3>
<div id="estatisticas">Nenhuma estat√≠stica registrada ainda.</div>
<button onclick="limparEstatisticas()">üßπ Limpar Estat√≠sticas</button>

<!-- Limpar tudo -->
<h3>üßΩ Limpar Hist√≥ricos</h3>
<button onclick="limparHistorico()">üßº Limpar Campos</button>
<div id="mensagemHistorico" style="color:#8f8; margin-top: 5px;"></div>

<script>
let estrategias = JSON.parse(localStorage.getItem("estrategias") || "[]");
let estatisticas = JSON.parse(localStorage.getItem("estatisticas") || "[]");

function salvarDados() {
  localStorage.setItem("estrategias", JSON.stringify(estrategias));
  localStorage.setItem("estatisticas", JSON.stringify(estatisticas));
  atualizarEstatisticas();
  atualizarContador();
}

function atualizarContador() {
  document.getElementById("contadorEstrat").innerText =
    `üß© Estrat√©gias criadas: ${estrategias.length}`;
}

function parseHistorico(texto) {
  const linhas = texto.trim().split("\n");
  let blocos = [];
  for (let i = 0; i < linhas.length - 2; i += 3) {
    const anterior = linhas[i + 1];
    const branco = linhas[i + 2];
    const posterior = linhas[i + 3] || "";
    if (anterior && branco && posterior) {
      blocos.push({ anterior, branco, posterior });
    }
  }
  return blocos;
}

function enviarCerebro() {
  const txt = document.getElementById("historicoCerebro").value.trim();
  const blocos = parseHistorico(txt);
  if (blocos.length === 0) {
    alert("Hist√≥rico inv√°lido.");
    return;
  }

  let novas = 0;
  blocos.forEach(b => {
    const chave = b.anterior + "|" + b.posterior;
    if (!estrategias.find(e => e.chave === chave)) {
      estrategias.push({
        chave,
        branco: b.branco,
        peso: 1,
        horarios: [b.branco]
      });
      novas++;
    } else {
      const e = estrategias.find(e => e.chave === chave);
      if (!e.horarios.includes(b.branco)) e.horarios.push(b.branco);
    }
  });

  document.getElementById("mensagemCerebro").innerText = `‚úÖ Hist√≥rico enviado com sucesso! ${novas} nova(s) estrat√©gia(s) criada(s).`;
  salvarDados();
}

function analisarAgora() {
  const txt = document.getElementById("historicoAtual").value.trim();
  const blocos = parseHistorico(txt);
  const div = document.getElementById("previsoes");
  div.innerHTML = "";

  if (blocos.length === 0) {
    div.innerText = "‚ùå Hist√≥rico atual inv√°lido.";
    return;
  }

  let encontrados = [];
  blocos.forEach(b => {
    const chave = b.anterior + "|" + b.posterior;
    const e = estrategias.find(e => e.chave === chave);
    if (e) encontrados.push(e);
  });

  if (encontrados.length === 0) {
    div.innerHTML = "<p>‚ùå Nenhum padr√£o. Nenhuma estrat√©gia conhecida foi encontrada.</p>";
    return;
  }

  encontrados.forEach(e => {
    const nivel = e.peso >= 5 ? "Forte" : e.peso >= 3 ? "Moderado" : "Arriscado";
    e.horarios.forEach(horario => {
      const sinalDiv = document.createElement("div");
      sinalDiv.className = "sinal";
      sinalDiv.innerHTML = `
        <strong>${horario}</strong> (${nivel})<br>
        <button onclick="registrarResultado('${horario}','win','${e.chave}')">‚úÖ Acertou</button>
        <button onclick="registrarResultado('${horario}','loss','${e.chave}')">‚ùå Errou</button>
      `;
      div.appendChild(sinalDiv);
    });
  });

  detectarPadr√£oExtra(encontrados);
}

function detectarPadr√£oExtra(padroes) {
  const div = document.getElementById("previsoes");
  if (!padroes.length) return;

  let chuva = padroes.some(e => e.horarios.length >= 3);
  let rec = padroes.every(e => e.horarios.length === 1);

  if (chuva) {
    const alerta = document.createElement("div");
    alerta.innerHTML = "‚ö†Ô∏è Padr√£o de CHUVA detectado com base em estrat√©gias antigas.";
    alerta.style.color = "#0f0";
    div.appendChild(alerta);
  } else if (rec) {
    const alerta = document.createElement("div");
    alerta.innerHTML = "‚ö†Ô∏è REC detectado ‚Äî per√≠odo de poucos brancos.";
    alerta.style.color = "#f00";
    div.appendChild(alerta);
  }
}

function registrarResultado(horario, resultado, chave) {
  const idx = estrategias.findIndex(e => e.chave === chave);
  if (idx !== -1) {
    if (resultado === 'win') {
      estrategias[idx].peso += 1;
    } else {
      estrategias[idx].peso = Math.max(1, estrategias[idx].peso - 1);
    }
  }
  estatisticas.push({ horario, resultado: resultado === 'win' ? '‚úÖ' : '‚ùå' });
  salvarDados();
}

function atualizarEstatisticas() {
  const div = document.getElementById("estatisticas");
  if (estatisticas.length === 0) {
    div.innerText = "Nenhuma estat√≠stica registrada ainda.";
    return;
  }
  div.innerText = estatisticas.slice().reverse().map(e => `${e.horario} ${e.resultado}`).join("\n");
}

function limparEstatisticas() {
  if (confirm("Apagar todas as estat√≠sticas?")) {
    estatisticas = [];
    salvarDados();
  }
}

function limparHistorico() {
  document.getElementById("historicoCerebro").value = "";
  document.getElementById("historicoAtual").value = "";
  document.getElementById("mensagemCerebro").innerText = "";
  document.getElementById("mensagemHistorico").innerText = "‚úÖ Campos limpos. Estrat√©gias mantidas.";
  document.getElementById("previsoes").innerHTML = "";
}

atualizarEstatisticas();
atualizarContador();
</script>
</body>
</html>
