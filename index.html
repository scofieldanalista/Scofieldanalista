<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scofield Analista V3 PRO ‚ö™</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: 'Segoe UI', sans-serif;
      padding: 15px;
    }
    h1 {
      text-align: center;
      color: #ff4747;
    }
    textarea,
    input,
    button {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      box-sizing: border-box;
    }
    textarea,
    input {
      background: #222;
      color: #eee;
      border: 1px solid #555;
    }
    button {
      background: #ff4747;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background: #e53e3e;
    }
    .secao {
      margin-top: 25px;
    }
    .sinal {
      background: #222;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
    }
    .sinal button {
      width: 48%;
      margin: 2px 1%;
      font-weight: bold;
    }
    .estatisticas {
      white-space: pre-line;
      background: #222;
      padding: 10px;
      border-radius: 5px;
      margin-top: 15px;
      font-size: 1em;
    }
    #avisoRecChuva {
      background: #440000;
      color: #ff5555;
      padding: 10px;
      text-align: center;
      border-radius: 5px;
      font-weight: bold;
      margin-bottom: 15px;
    }
    #proximaPrevisao {
      background: #330000;
      color: #ff4747;
      padding: 10px;
      text-align: center;
      border-radius: 5px;
      font-weight: bold;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <h1>Scofield Analista V3 PRO ‚ö™</h1>

  <div id="proximaPrevisao">Pr√≥xima previs√£o forte: --:--:--</div>
  <div id="avisoRecChuva"></div>

  <div class="secao">
    <h3>üß† Hist√≥rico C√©rebro</h3>
    <textarea id="historicoCerebro" rows="8" placeholder="Cole aqui o hist√≥rico completo com hor√°rios, n√∫meros e cores..."></textarea>
    <button onclick="enviarCerebro()">üì§ Enviar Hist√≥rico</button>
    <div id="mensagemCerebro" style="color:#8f8; margin-top:6px;"></div>
    <div>Estrat√©gias criadas: <span id="numEstrategias">0</span></div>
  </div>

  <div class="secao">
    <h3>‚è±Ô∏è Come√ßar An√°lise</h3>
    <textarea id="historicoAtual" rows="6" placeholder="Cole aqui as √∫ltimas jogadas para prever os brancos..."></textarea>
    <button onclick="analisarAgora()">üîç Analisar</button>
    <div id="previsoes"></div>
    <button onclick="mostrarMinutosQuentes()" style="margin-top:10px;">üìà Ver Minutos Quentes</button>
    <div id="minutosQuentes" style="margin-top:10px; background:#222; padding:10px; border-radius:5px; max-height:150px; overflow:auto;"></div>
  </div>

  <div class="secao">
    <h3>üìä Estat√≠sticas</h3>
    <div id="estatisticas" class="estatisticas">Nenhuma estat√≠stica registrada.</div>
    <button onclick="limparEstatisticas()">üßπ Limpar Estat√≠sticas</button>
  </div>

  <div class="secao">
    <h3>üßπ Limpar Hist√≥rico</h3>
    <button onclick="limparHistorico()">üßº Limpar Campos de Hist√≥rico</button>
    <div id="mensagemHistorico" style="margin-top:10px;color:#8f8;"></div>
  </div>

  <script>
// Cores
const VERMELHAS = new Set(['1','2','3','4','5','6','7']);
const PRETAS = new Set(['8','9','10','11','12','13','14']);

// Dados persistentes
let estrategias = JSON.parse(localStorage.getItem("estrategias") || "[]");
let estatisticas = JSON.parse(localStorage.getItem("estatisticas") || "[]");
let historicosMemorizados = JSON.parse(localStorage.getItem("historicosMemorizados") || "[]");

// Atualiza contagem de estrat√©gias
function atualizarContadorEstrategias() {
  document.getElementById("numEstrategias").innerText = estrategias.length;
}

// Atualiza estat√≠sticas
function atualizarEstatisticas() {
  const div = document.getElementById("estatisticas");
  if (estatisticas.length === 0) {
    div.innerText = "Nenhuma estat√≠stica registrada.";
    return;
  }
  let linhas = estatisticas.map(e => {
    let status = e.acerto ? "‚úÖ" : "‚ùå";
    let d = new Date(e.data);
    return `${e.horario} ${status} - ${d.toLocaleString()}`;
  });
  div.innerText = linhas.join('\n');
}

// Salva no localStorage
function salvarDados() {
  localStorage.setItem("estrategias", JSON.stringify(estrategias));
  localStorage.setItem("estatisticas", JSON.stringify(estatisticas));
  localStorage.setItem("historicosMemorizados", JSON.stringify(historicosMemorizados));
  atualizarEstatisticas();
  atualizarContadorEstrategias();
}

// Parseia hist√≥rico para [{num, hora, cor}]
function parsearHistorico(texto) {
  let linhas = texto.trim().split(/\r?\n/).map(l => l.trim()).filter(l => l !== '');
  let resultado = [];
  for (let i = 0; i < linhas.length;) {
    let num = linhas[i];
    let proxLinha = linhas[i + 1] || '';
    if (/^\d{2}:\d{2}:\d{2}$/.test(proxLinha)) {
      let cor = 'branco';
      if (num === '0' || num === '') {
        cor = 'branco';
        num = null;
      } else if (VERMELHAS.has(num)) {
        cor = 'vermelha';
      } else if (PRETAS.has(num)) {
        cor = 'preta';
      } else {
        cor = 'desconhecida';
      }
      resultado.push({ num: num, hora: proxLinha, cor: cor });
      i += 2;
    } else {
      i++;
    }
  }
  return resultado;
}

// Cria nova estrat√©gia a partir de hist√≥rico parseado
function criarOuAtualizarEstrategias(historico) {
  let horariosBranco = historico.filter(e => e.cor === 'branco').map(e => e.hora);
  if (horariosBranco.length === 0) return 0;

  let nova = {
    id: Date.now(),
    horariosBrancos: horariosBranco,
    criadoEm: Date.now(),
    peso: 1
  };

  let existe = estrategias.some(est => {
    return JSON.stringify(est.horariosBrancos) === JSON.stringify(nova.horariosBrancos);
  });

  if (!existe) {
    estrategias.push(nova);
    return 1;
  }

  return 0;
}
