<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scofield Analista V4 PRO âšª</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: 'Segoe UI', sans-serif;
      padding: 15px;
    }
    h1 {
      text-align: center;
      color: #ff4747;
    }
    textarea,
    input,
    button {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      box-sizing: border-box;
    }
    textarea,
    input {
      background: #222;
      color: #eee;
      border: 1px solid #555;
    }
    button {
      background: #ff4747;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background: #e53e3e;
    }
    .secao {
      margin-top: 25px;
    }
    .sinal {
      background: #222;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
    }
    .sinal button {
      width: 48%;
      margin: 2px 1%;
      font-weight: bold;
    }
    .estatisticas {
      white-space: pre-line;
      background: #222;
      padding: 10px;
      border-radius: 5px;
      margin-top: 15px;
      font-size: 1em;
    }
    #avisoRecChuva {
      background: #440000;
      color: #ff5555;
      padding: 10px;
      text-align: center;
      border-radius: 5px;
      font-weight: bold;
      margin-bottom: 15px;
    }
    #proximaPrevisao {
      background: #330000;
      color: #ff4747;
      padding: 10px;
      text-align: center;
      border-radius: 5px;
      font-weight: bold;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <h1>Scofield Analista V4 PRO âšª</h1>

  <div id="proximaPrevisao">PrÃ³xima previsÃ£o forte: --:--:--</div>
  <div id="avisoRecChuva"></div>

  <div class="secao">
    <h3>ğŸ§  HistÃ³rico CÃ©rebro</h3>
    <textarea id="historicoCerebro" rows="8" placeholder="Cole aqui o histÃ³rico completo com horÃ¡rios, nÃºmeros e cores..."></textarea>
    <button onclick="enviarCerebro()">ğŸ“¤ Enviar HistÃ³rico</button>
    <div id="mensagemCerebro" style="color:#8f8; margin-top:6px;"></div>
    <div>EstratÃ©gias criadas: <span id="numEstrategias">0</span></div>
  </div>

  <div class="secao">
    <h3>â±ï¸ ComeÃ§ar AnÃ¡lise</h3>
    <textarea id="historicoAtual" rows="6" placeholder="Cole aqui as Ãºltimas jogadas para prever os brancos..."></textarea>
    <button onclick="analisarAgora()">ğŸ” Analisar</button>
    <div id="previsoes"></div>
    <button onclick="mostrarMinutosQuentes()" style="margin-top:10px;">ğŸ“ˆ Ver Minutos Quentes</button>
    <div id="minutosQuentes" style="margin-top:10px; background:#222; padding:10px; border-radius:5px; max-height:150px; overflow:auto;"></div>
  </div>

  <div class="secao">
    <h3>ğŸ“Š EstatÃ­sticas</h3>
    <div id="estatisticas" class="estatisticas">Nenhuma estatÃ­stica registrada.</div>
    <button onclick="limparEstatisticas()">ğŸ§¹ Limpar EstatÃ­sticas</button>
  </div>

  <div class="secao">
    <h3>ğŸ§¹ Limpar HistÃ³rico</h3>
    <button onclick="limparHistorico()">ğŸ§¼ Limpar Campos de HistÃ³rico</button>
    <div id="mensagemHistorico" style="margin-top:10px;color:#8f8;"></div>
  </div>
// Cores por faixa numÃ©rica
const VERMELHAS = new Set(['1','2','3','4','5','6','7']);
const PRETAS = new Set(['8','9','10','11','12','13','14']);

// MemÃ³ria local
let estrategias = JSON.parse(localStorage.getItem("estrategias") || "[]");
let estatisticas = JSON.parse(localStorage.getItem("estatisticas") || "[]");
let historicosMemorizados = JSON.parse(localStorage.getItem("historicosMemorizados") || "[]");

// Atualiza contador de estratÃ©gias
function atualizarContadorEstrategias() {
  document.getElementById("numEstrategias").innerText = estrategias.length;
}

// Atualiza estatÃ­sticas na tela
function atualizarEstatisticas() {
  const div = document.getElementById("estatisticas");
  if (estatisticas.length === 0) {
    div.innerText = "Nenhuma estatÃ­stica registrada.";
    return;
  }
  let linhas = estatisticas.map(e => {
    let status = e.acerto ? "âœ…" : "âŒ";
    let d = new Date(e.data);
    return `${e.horario} ${status} - ${d.toLocaleString()}`;
  });
  div.innerText = linhas.join('\n');
}

// Salvar memÃ³ria local
function salvarDados() {
  localStorage.setItem("estrategias", JSON.stringify(estrategias));
  localStorage.setItem("estatisticas", JSON.stringify(estatisticas));
  localStorage.setItem("historicosMemorizados", JSON.stringify(historicosMemorizados));
  atualizarEstatisticas();
  atualizarContadorEstrategias();
}

// ğŸ“Œ Parseia o histÃ³rico colado (cÃ©rebro e anÃ¡lise)
function parsearHistorico(texto) {
  let linhas = texto.trim().split(/\r?\n/).map(l => l.trim()).filter(l => l !== '');
  let resultado = [];
  for (let i = 0; i < linhas.length;) {
    let num = linhas[i];
    let hora = linhas[i + 1] || '';

    if (/^\d{2}:\d{2}:\d{2}$/.test(hora)) {
      let cor = 'branco';
      if (num === '0' || num === '') {
        cor = 'branco';
        num = null;
      } else if (VERMELHAS.has(num)) {
        cor = 'vermelha';
      } else if (PRETAS.has(num)) {
        cor = 'preta';
      } else {
        cor = 'desconhecida';
      }

      resultado.push({ num: num, hora: hora, cor: cor });
      i += 2;
    } else {
      i++;
    }
  }
  return resultado;
}
// Cria estratÃ©gias reais baseadas nos brancos do histÃ³rico
function criarOuAtualizarEstrategias(historico) {
  let brancos = historico.filter(e => e.cor === 'branco');

  if (brancos.length === 0) return 0;

  let novas = 0;

  brancos.forEach((branco, index) => {
    // Verifica se hÃ¡ anterior e posterior
    const anterior = historico[index - 1];
    const posterior = historico[index + 1];

    if (!anterior || !posterior || !anterior.num || !posterior.num) return;

    const soma = parseInt(anterior.num) + parseInt(posterior.num);
    const minuto = branco.hora.slice(3, 5);

    const padrao = {
      anterior: anterior.num,
      posterior: posterior.num,
      soma: soma,
      minuto: minuto,
      horaCompleta: branco.hora
    };

    const jaExiste = estrategias.some(est => {
      return (
        est.soma === padrao.soma &&
        est.minuto === padrao.minuto &&
        est.anterior === padrao.anterior &&
        est.posterior === padrao.posterior
      );
    });

    if (!jaExiste) {
      estrategias.push({
        ...padrao,
        peso: 1,
        aprendidoEm: Date.now()
      });
      novas++;
    }
  });

  return novas;
}

// FunÃ§Ã£o chamada ao clicar em "ğŸ“¤ Enviar HistÃ³rico"
function enviarCerebro() {
  const texto = document.getElementById("historicoCerebro").value;
  if (texto.trim().length < 10) {
    alert("HistÃ³rico muito curto.");
    return;
  }

  const parseado = parsearHistorico(texto);
  if (parseado.length === 0) {
    alert("NÃ£o foi possÃ­vel interpretar o histÃ³rico.");
    return;
  }

  historicosMemorizados.push({
    data: Date.now(),
    itens: parseado
  });

  const novas = criarOuAtualizarEstrategias(parseado);
  document.getElementById("mensagemCerebro").innerText =
    `âœ… HistÃ³rico enviado! ${novas} estratÃ©gia(s) criada(s).`;

  salvarDados();
}
// FunÃ§Ã£o chamada ao clicar no botÃ£o ğŸ” Analisar
function analisarAgora() {
  const textoAtual = document.getElementById("historicoAtual").value;

  if (textoAtual.trim().length < 5) {
    alert("Cole as Ãºltimas jogadas para analisar.");
    return;
  }

  const analisado = parsearHistorico(textoAtual);
  if (analisado.length === 0) {
    alert("NÃ£o foi possÃ­vel interpretar o histÃ³rico atual.");
    return;
  }

  const ultimos = analisado.slice(-3); // Pega as 3 Ãºltimas jogadas
  if (ultimos.length < 3) {
    alert("ForneÃ§a ao menos 3 resultados (anterior, branco, posterior).");
    return;
  }

  const anterior = ultimos[0];
  const branco = ultimos[1];
  const posterior = ultimos[2];

  if (!anterior.num || !posterior.num) {
    alert("Informe nÃºmeros vÃ¡lidos para anterior e posterior.");
    return;
  }

  const soma = parseInt(anterior.num) + parseInt(posterior.num);
  const minutoAtual = branco.hora.slice(3, 5);

  const correspondentes = estrategias.filter(est => {
    return (
      est.soma === soma &&
      est.anterior === anterior.num &&
      est.posterior === posterior.num
    );
  });

  const horariosPrevisao = correspondentes.map(est => est.horaCompleta);

  let aviso = "";
  if (correspondentes.length === 0) {
    aviso = "âš ï¸ Nenhum padrÃ£o semelhante encontrado. PossÃ­vel REC.";
  } else if (correspondentes.length >= 3) {
    aviso = "ğŸŒ§ï¸ CHUVA de padrÃµes semelhante detectada!";
  }

  mostrarPrevisoesInteligentes(horariosPrevisao, aviso);
}

// Mostra os horÃ¡rios previstos baseados em estratÃ©gias salvas
function mostrarPrevisoesInteligentes(horarios, aviso = "") {
  const div = document.getElementById("previsoes");
  div.innerHTML = "<h4>ğŸŸ¢ Brancos ProvÃ¡veis:</h4>";

  if (horarios.length === 0) {
    div.innerHTML += "<div>Nenhum horÃ¡rio previsto com base nos padrÃµes.</div>";
    document.getElementById("proximaPrevisao").innerText = "PrÃ³xima previsÃ£o forte: --:--:--";
    document.getElementById("avisoRecChuva").innerText = aviso;
    return;
  }

  horarios.sort();
  horarios.forEach(h => {
    let linha = document.createElement("div");
    linha.innerHTML = `
      ${h} (Forte)
      <button onclick="registrarAcerto('${h}')">âœ… Acertou</button>
      <button onclick="registrarErro('${h}')">âŒ Errou</button>
    `;
    div.appendChild(linha);
  });

  // Mostra no topo
  document.getElementById("proximaPrevisao").innerText = `PrÃ³xima previsÃ£o forte: ${horarios[0]}`;
  document.getElementById("avisoRecChuva").innerText = aviso;
}
// EstatÃ­sticas salvas (jÃ¡ inicializadas no topo)
function registrarAcerto(horario) {
  estatisticas.push({ horario: horario, acerto: true, data: Date.now() });
  ajustarPesoEstrategia(horario, true);
  salvarDados();
  atualizarEstatisticas();
}

function registrarErro(horario) {
  estatisticas.push({ horario: horario, acerto: false, data: Date.now() });
  ajustarPesoEstrategia(horario, false);
  salvarDados();
  atualizarEstatisticas();
}

// Ajusta peso das estratÃ©gias com base no feedback
function ajustarPesoEstrategia(horario, acertou) {
  estrategias.forEach(est => {
    if (est.horaCompleta === horario) {
      est.peso = acertou ? est.peso + 1 : Math.max(1, est.peso - 1);
    }
  });
}

// Atualiza estatÃ­sticas no painel
function atualizarEstatisticas() {
  const div = document.getElementById("estatisticas");
  if (estatisticas.length === 0) {
    div.innerText = "Nenhuma estatÃ­stica registrada.";
    return;
  }
  let linhas = estatisticas.map(e => {
    let status = e.acerto ? "âœ…" : "âŒ";
    let d = new Date(e.data);
    let dataStr = d.toLocaleString();
    return `${e.horario} ${status} - ${dataStr}`;
  });
  div.innerText = linhas.join('\n');
}

// Limpa estatÃ­sticas salvas
function limparEstatisticas() {
  if (confirm("Deseja apagar todas as estatÃ­sticas?")) {
    estatisticas = [];
    salvarDados();
    atualizarEstatisticas();
  }
}
