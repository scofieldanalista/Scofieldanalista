<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scofield Analista</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      margin: 0;
      padding: 20px;
    }
    h2 {
      text-align: center;
      color: #f5a623;
    }
    .container {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }
    .pedra {
      background: #222;
      border-radius: 12px;
      padding: 15px;
      width: 130px;
      text-align: center;
    }
    .cor-quadrado {
      font-size: 70px;
      cursor: pointer;
      margin-bottom: 10px;
    }
    label {
      font-size: 14px;
      margin-top: 5px;
      display: block;
    }
    input[type="number"],
    input[type="time"] {
      width: 100%;
      padding: 6px 8px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      margin-top: 4px;
    }
    button {
      margin: 10px 8px 0 0;
      padding: 12px 22px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: #f5a623;
      color: #111;
    }
    #resultado {
      margin-top: 20px;
      font-size: 20px;
      font-weight: 700;
      color: #f5a623;
      text-align: center;
      min-height: 50px;
    }
    #confian√ßa, #avisos {
      font-weight: 600;
      margin-top: 8px;
      text-align: center;
    }
    #log {
      margin-top: 20px;
      max-height: 230px;
      overflow-y: auto;
      background: #222;
      padding: 10px;
      border-radius: 10px;
      font-size: 14px;
      line-height: 1.3;
      color: #ccc;
    }
  </style>
</head>
<body>
  <h2>Scofield Analista - Blaze Double</h2>
  <div id="app">Carregando aplica√ß√£o...</div>
<script>
  const app = document.getElementById('app');
  const resultados = JSON.parse(localStorage.getItem('resultados') || '[]');
  let ultimoPrevisto = null;

  function horaParaMinutos(hora) {
    const [h, m] = hora.split(':').map(Number);
    return h * 60 + m;
  }

  function minutosParaHora(minutos) {
    const h = String(Math.floor(minutos / 60)).padStart(2, '0');
    const m = String(minutos % 60).padStart(2, '0');
    return `${h}:${m}`;
  }

  function salvarResultado(esq, meio, dir) {
    // Valida√ß√£o simples dos campos para evitar salvar vazio
    if (!esq.numero || !esq.horario || !dir.numero || !dir.horario || !meio.horario) {
      alert('Preencha todos os n√∫meros e hor√°rios, exceto o branco que n√£o tem n√∫mero.');
      return;
    }
    resultados.push({ esq, meio, dir });
    localStorage.setItem('resultados', JSON.stringify(resultados));
    atualizarLog();
    alert('Resultado salvo com sucesso!');
  }

  function atualizarLog() {
    const logDiv = document.getElementById('log');
    if (resultados.length === 0) {
      logDiv.innerHTML = 'Nenhum resultado salvo ainda.';
      return;
    }
    logDiv.innerHTML = resultados.map((r, i) => 
      `${i + 1}. ${r.esq.cor} ${r.esq.numero} ${r.esq.horario} | üé≤ ${r.meio.horario} | ${r.dir.cor} ${r.dir.numero} ${r.dir.horario}`
    ).join('<br>');
  }

  function calcularConfian√ßa(media, intervalos, brancos) {
    if (brancos.length < 2) {
      return { text: "‚ö†Ô∏è Poucos dados ‚Äî sinal arriscado", color: "#f39c12" };
    } else if (media <= 4) {
      return { text: "‚úÖ Sinal forte ‚Äî branco prov√°vel", color: "#2ecc71" };
    } else {
      return { text: "‚ö†Ô∏è Sinal moderado ‚Äî use cautela", color: "#f1c40f" };
    }
  }

  function analisar() {
    if (resultados.length < 1) {
      alert('Salve pelo menos 1 resultado para come√ßar a an√°lise.');
      return;
    }

    const brancos = resultados
      .map(r => horaParaMinutos(r.meio.horario))
      .filter(v => v !== null)
      .sort((a, b) => a - b);

    if (brancos.length === 0) {
      alert('Nenhum hor√°rio v√°lido do branco encontrado para an√°lise.');
      return;
    }

    const ultimoBranco = brancos[brancos.length - 1];
    let mediaIntervalo = 6; // padr√£o caso n√£o tenha intervalo para calcular

    if (brancos.length >= 2) {
      const intervalos = [];
      for (let i = 1; i < brancos.length; i++) {
        intervalos.push(brancos[i] - brancos[i - 1]);
      }
      mediaIntervalo = intervalos.reduce((a, b) => a + b, 0) / intervalos.length;
    }

    const previsto = Math.round(ultimoBranco + mediaIntervalo);
    const previstoHora = minutosParaHora(previsto);
    ultimoPrevisto = previsto;

    document.getElementById('resultado').textContent = `üïì PR√ìXIMO BRANCO PROV√ÅVEL EM ${previstoHora} ‚Äî PREPARA!`;

    const conf = calcularConfian√ßa(mediaIntervalo, [], brancos);
    document.getElementById('confian√ßa').textContent = conf.text;
    document.getElementById('confian√ßa').style.color = conf.color;

    document.getElementById('avisos').textContent = '';
  }

  function limparHistorico() {
    if (!confirm('Tem certeza que deseja limpar todo o hist√≥rico?')) return;
    localStorage.removeItem('resultados');
    resultados.length = 0;
    atualizarLog();
    document.getElementById('resultado').textContent = '';
    document.getElementById('confian√ßa').textContent = '';
    document.getElementById('avisos').textContent = '';
  }

  function criarInterface() {
    app.innerHTML = `
      <div class="container">
        <div class="pedra">
          <div contenteditable class="cor-quadrado" id="corEsq" title="Clique para mudar cor">üî¥</div>
          <label>N√∫mero</label>
          <input type="number" id="numEsq" />
          <label>Hor√°rio</label>
          <input type="time" id="horaEsq" />
        </div>
        <div class="pedra">
          <div class="cor-quadrado" id="corMeio" title="Branco - n√£o tem n√∫mero">üé≤</div>
          <label>Hor√°rio</label>
          <input type="time" id="horaMeio" />
        </div>
        <div class="pedra">
          <div contenteditable class="cor-quadrado" id="corDir" title="Clique para mudar cor">‚ö´</div>
          <label>N√∫mero</label>
          <input type="number" id="numDir" />
          <label>Hor√°rio</label>
          <input type="time" id="horaDir" />
        </div>
      </div>
      <button onclick="salvarResultado(
        {cor: document.getElementById('corEsq').textContent.trim(), numero: document.getElementById('numEsq').value.trim(), horario: document.getElementById('horaEsq').value},
        {horario: document.getElementById('horaMeio').value},
        {cor: document.getElementById('corDir').textContent.trim(), numero: document.getElementById('numDir').value.trim(), horario: document.getElementById('horaDir').value}
      )">Salvar Resultado</button>
      <button onclick="analisar()">Analisar</button>
      <button onclick="limparHistorico()">Limpar Hist√≥rico</button>
      <div id="resultado"></div>
      <div id="confian√ßa"></div>
      <div id="avisos"></div>
      <div id="log"></div>
    `;

    // Fun√ß√£o para alternar as cores quando clicar no quadrado (esquerda e direita)
    function toggleCor(element) {
      const cores = ['üî¥', '‚ö´', '‚ö™'];
      let atual = element.textContent.trim();
      let index = cores.indexOf(atual);
      index = (index + 1) % cores.length;
      element.textContent = cores[index];
    }

    document.getElementById('corEsq').addEventListener('click', e => toggleCor(e.target));
    document.getElementById('corDir').addEventListener('click', e => toggleCor(e.target));

    atualizarLog();
  }

  criarInterface();
</script>
</body>
</html>
